{"version":3,"file":"js/862.2b69e98b.js","mappings":"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","sources":["webpack://sugar-day/./src/views/ChatView.vue","webpack://sugar-day/../lib/bufferbuilder.ts","webpack://sugar-day/../lib/binarypack.ts","webpack://sugar-day/./node_modules/webrtc-adapter/src/js/utils.js","webpack://sugar-day/./node_modules/webrtc-adapter/src/js/chrome/getusermedia.js","webpack://sugar-day/./node_modules/webrtc-adapter/src/js/chrome/getdisplaymedia.js","webpack://sugar-day/./node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js","webpack://sugar-day/./node_modules/webrtc-adapter/src/js/firefox/getusermedia.js","webpack://sugar-day/./node_modules/webrtc-adapter/src/js/firefox/getdisplaymedia.js","webpack://sugar-day/./node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js","webpack://sugar-day/./node_modules/webrtc-adapter/src/js/safari/safari_shim.js","webpack://sugar-day/./node_modules/webrtc-adapter/src/js/common_shim.js","webpack://sugar-day/./node_modules/webrtc-adapter/src/js/adapter_factory.js","webpack://sugar-day/./node_modules/webrtc-adapter/src/js/adapter_core.js","webpack://sugar-day/./node_modules/cbor-x/decode.js","webpack://sugar-day/./node_modules/cbor-x/encode.js","webpack://sugar-day/lib/dataconnection/BufferedConnection/binaryPackChunker.ts","webpack://sugar-day/lib/supports.ts","webpack://sugar-day/lib/utils/validateId.ts","webpack://sugar-day/lib/utils/randomToken.ts","webpack://sugar-day/lib/util.ts","webpack://sugar-day/lib/logger.ts","webpack://sugar-day/node_modules/eventemitter3/index.js","webpack://sugar-day/lib/enums.ts","webpack://sugar-day/package.json","webpack://sugar-day/lib/socket.ts","webpack://sugar-day/lib/negotiator.ts","webpack://sugar-day/lib/peerError.ts","webpack://sugar-day/lib/baseconnection.ts","webpack://sugar-day/lib/mediaconnection.ts","webpack://sugar-day/lib/api.ts","webpack://sugar-day/lib/dataconnection/DataConnection.ts","webpack://sugar-day/lib/dataconnection/BufferedConnection/BufferedConnection.ts","webpack://sugar-day/lib/dataconnection/BufferedConnection/BinaryPack.ts","webpack://sugar-day/lib/dataconnection/BufferedConnection/Raw.ts","webpack://sugar-day/lib/dataconnection/BufferedConnection/Json.ts","webpack://sugar-day/lib/peer.ts","webpack://sugar-day/lib/dataconnection/StreamConnection/Cbor.ts","webpack://sugar-day/src/views/ChatView.vue","webpack://sugar-day/./src/views/ChatView.vue?9674","webpack://sugar-day/./src/views/ChatView.vue?8981","webpack://sugar-day/./node_modules/sdp/sdp.js","webpack://sugar-day/./node_modules/core-js/internals/regexp-flags.js","webpack://sugar-day/./node_modules/core-js/modules/es.regexp.flags.js"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"chat-page flex-column\"},[_c('div',{staticClass:\"chat-head align-center no-shrink no-grow\"},[_c('el-avatar',{staticClass:\"avatar\",attrs:{\"size\":\"small\",\"shape\":\"square\",\"icon\":\"el-icon-user-solid\"}}),_vm._v(\" \"+_vm._s(`${_vm.id}`)+\" \")],1),_c('div',{staticClass:\"padding-x-16 chat-body limit-with flex-1\"},[(_vm.calling)?_c('div',{staticClass:\"d-flex\"},[_c('PeerVideo',{ref:\"myVideo\"}),_c('PeerVideo',{ref:\"remoteVideo\"})],1):_c('div',_vm._l((_vm.currentMsgList),function(item,idx){return _c('ChatMessage',{key:idx,attrs:{\"message\":item}})}),1)]),_c('el-form',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],ref:\"dynamicValidateForm\",staticClass:\"demo-form-inline d-flex padding-x-16 limit-with no-shrink no-grow\",attrs:{\"inline\":true,\"model\":_vm.formInline}},[_c('el-form-item',{staticClass:\"input-list\",attrs:{\"prop\":\"text\",\"rules\":{\n        required: true,\n        trigger: 'blur',\n      }}},[_c('el-input',{attrs:{\"placeholder\":\"Type your message...\"},model:{value:(_vm.formInline.text),callback:function ($$v) {_vm.$set(_vm.formInline, \"text\", $$v)},expression:\"formInline.text\"}})],1),_c('el-form-item',[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){return _vm.onSubmit('dynamicValidateForm')}}},[_vm._v(\"SEND\")])],1)],1),_c('el-upload',{directives:[{name:\"show\",rawName:\"v-show\",value:(false),expression:\"false\"}],staticClass:\"avatar-uploader\",attrs:{\"accept\":\"image/*\",\"action\":\"#\",\"on-success\":_vm.handleAvatarSuccess,\"before-upload\":_vm.beforeAvatarUpload}},[_c('i',{ref:\"upload\",staticClass:\"el-icon-plus avatar-uploader-icon\",attrs:{\"slot\":\"trigger\"},slot:\"trigger\"})]),_c('p',{staticClass:\"tool\"},[_c('i',{staticClass:\"el-icon-picture\",on:{\"click\":_vm.uploadImg}})])],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","class BufferBuilder {\n\tprivate _pieces: number[];\n\tprivate readonly _parts: ArrayBufferView[];\n\n\tconstructor() {\n\t\tthis._pieces = [];\n\t\tthis._parts = [];\n\t}\n\n\tappend_buffer(data: ArrayBufferView) {\n\t\tthis.flush();\n\t\tthis._parts.push(data);\n\t}\n\n\tappend(data: number) {\n\t\tthis._pieces.push(data);\n\t}\n\n\tflush() {\n\t\tif (this._pieces.length > 0) {\n\t\t\tconst buf = new Uint8Array(this._pieces);\n\t\t\tthis._parts.push(buf);\n\t\t\tthis._pieces = [];\n\t\t}\n\t}\n\n\tprivate encoder = new TextEncoder();\n\n\tpublic toArrayBuffer() {\n\t\tconst buffer = [];\n\t\tfor (const part of this._parts) {\n\t\t\tbuffer.push(part);\n\t\t}\n\t\treturn concatArrayBuffers(buffer).buffer;\n\t}\n}\n\nexport { BufferBuilder };\n\nfunction concatArrayBuffers(bufs: ArrayBufferView[]) {\n\tlet size = 0;\n\tfor (const buf of bufs) {\n\t\tsize += buf.byteLength;\n\t}\n\tconst result = new Uint8Array(size);\n\tlet offset = 0;\n\tfor (const buf of bufs) {\n\t\tconst view = new Uint8Array(buf.buffer, buf.byteOffset, buf.byteLength);\n\t\tresult.set(view, offset);\n\t\toffset += buf.byteLength;\n\t}\n\treturn result;\n}\n","import { BufferBuilder } from \"./bufferbuilder\";\n\nexport type Packable =\n\t| null\n\t| undefined\n\t| string\n\t| number\n\t| boolean\n\t| Date\n\t| ArrayBuffer\n\t| Array<Packable>\n\t| { [key: string]: Packable }\n\t| ({ BYTES_PER_ELEMENT: number } & ArrayBufferView);\nexport type Unpackable =\n\t| null\n\t| undefined\n\t| string\n\t| number\n\t| boolean\n\t| ArrayBuffer\n\t| Array<Unpackable>\n\t| { [key: string]: Unpackable };\n\nexport function unpack<T extends Unpackable>(data: ArrayBuffer) {\n\tconst unpacker = new Unpacker(data);\n\treturn unpacker.unpack() as T;\n}\n\nexport function pack(data: Packable) {\n\tconst packer = new Packer();\n\tpacker.pack(data);\n\treturn packer.getBuffer();\n}\n\nclass Unpacker {\n\tprivate index: number;\n\tprivate readonly dataBuffer: ArrayBuffer;\n\tprivate readonly dataView: Uint8Array;\n\tprivate readonly length: number;\n\n\tconstructor(data: ArrayBuffer) {\n\t\tthis.index = 0;\n\t\tthis.dataBuffer = data;\n\t\tthis.dataView = new Uint8Array(this.dataBuffer);\n\t\tthis.length = this.dataBuffer.byteLength;\n\t}\n\n\tunpack(): Unpackable {\n\t\tconst type = this.unpack_uint8();\n\t\tif (type < 0x80) {\n\t\t\treturn type;\n\t\t} else if ((type ^ 0xe0) < 0x20) {\n\t\t\treturn (type ^ 0xe0) - 0x20;\n\t\t}\n\n\t\tlet size;\n\t\tif ((size = type ^ 0xa0) <= 0x0f) {\n\t\t\treturn this.unpack_raw(size);\n\t\t} else if ((size = type ^ 0xb0) <= 0x0f) {\n\t\t\treturn this.unpack_string(size);\n\t\t} else if ((size = type ^ 0x90) <= 0x0f) {\n\t\t\treturn this.unpack_array(size);\n\t\t} else if ((size = type ^ 0x80) <= 0x0f) {\n\t\t\treturn this.unpack_map(size);\n\t\t}\n\n\t\tswitch (type) {\n\t\t\tcase 0xc0:\n\t\t\t\treturn null;\n\t\t\tcase 0xc1:\n\t\t\t\treturn undefined;\n\t\t\tcase 0xc2:\n\t\t\t\treturn false;\n\t\t\tcase 0xc3:\n\t\t\t\treturn true;\n\t\t\tcase 0xca:\n\t\t\t\treturn this.unpack_float();\n\t\t\tcase 0xcb:\n\t\t\t\treturn this.unpack_double();\n\t\t\tcase 0xcc:\n\t\t\t\treturn this.unpack_uint8();\n\t\t\tcase 0xcd:\n\t\t\t\treturn this.unpack_uint16();\n\t\t\tcase 0xce:\n\t\t\t\treturn this.unpack_uint32();\n\t\t\tcase 0xcf:\n\t\t\t\treturn this.unpack_uint64();\n\t\t\tcase 0xd0:\n\t\t\t\treturn this.unpack_int8();\n\t\t\tcase 0xd1:\n\t\t\t\treturn this.unpack_int16();\n\t\t\tcase 0xd2:\n\t\t\t\treturn this.unpack_int32();\n\t\t\tcase 0xd3:\n\t\t\t\treturn this.unpack_int64();\n\t\t\tcase 0xd4:\n\t\t\t\treturn undefined;\n\t\t\tcase 0xd5:\n\t\t\t\treturn undefined;\n\t\t\tcase 0xd6:\n\t\t\t\treturn undefined;\n\t\t\tcase 0xd7:\n\t\t\t\treturn undefined;\n\t\t\tcase 0xd8:\n\t\t\t\tsize = this.unpack_uint16();\n\t\t\t\treturn this.unpack_string(size);\n\t\t\tcase 0xd9:\n\t\t\t\tsize = this.unpack_uint32();\n\t\t\t\treturn this.unpack_string(size);\n\t\t\tcase 0xda:\n\t\t\t\tsize = this.unpack_uint16();\n\t\t\t\treturn this.unpack_raw(size);\n\t\t\tcase 0xdb:\n\t\t\t\tsize = this.unpack_uint32();\n\t\t\t\treturn this.unpack_raw(size);\n\t\t\tcase 0xdc:\n\t\t\t\tsize = this.unpack_uint16();\n\t\t\t\treturn this.unpack_array(size);\n\t\t\tcase 0xdd:\n\t\t\t\tsize = this.unpack_uint32();\n\t\t\t\treturn this.unpack_array(size);\n\t\t\tcase 0xde:\n\t\t\t\tsize = this.unpack_uint16();\n\t\t\t\treturn this.unpack_map(size);\n\t\t\tcase 0xdf:\n\t\t\t\tsize = this.unpack_uint32();\n\t\t\t\treturn this.unpack_map(size);\n\t\t}\n\t}\n\n\tunpack_uint8() {\n\t\tconst byte = this.dataView[this.index] & 0xff;\n\t\tthis.index++;\n\t\treturn byte;\n\t}\n\n\tunpack_uint16() {\n\t\tconst bytes = this.read(2);\n\t\tconst uint16 = (bytes[0] & 0xff) * 256 + (bytes[1] & 0xff);\n\t\tthis.index += 2;\n\t\treturn uint16;\n\t}\n\n\tunpack_uint32() {\n\t\tconst bytes = this.read(4);\n\t\tconst uint32 =\n\t\t\t((bytes[0] * 256 + bytes[1]) * 256 + bytes[2]) * 256 + bytes[3];\n\t\tthis.index += 4;\n\t\treturn uint32;\n\t}\n\n\tunpack_uint64() {\n\t\tconst bytes = this.read(8);\n\t\tconst uint64 =\n\t\t\t((((((bytes[0] * 256 + bytes[1]) * 256 + bytes[2]) * 256 + bytes[3]) *\n\t\t\t\t256 +\n\t\t\t\tbytes[4]) *\n\t\t\t\t256 +\n\t\t\t\tbytes[5]) *\n\t\t\t\t256 +\n\t\t\t\tbytes[6]) *\n\t\t\t\t256 +\n\t\t\tbytes[7];\n\t\tthis.index += 8;\n\t\treturn uint64;\n\t}\n\n\tunpack_int8() {\n\t\tconst uint8 = this.unpack_uint8();\n\t\treturn uint8 < 0x80 ? uint8 : uint8 - (1 << 8);\n\t}\n\n\tunpack_int16() {\n\t\tconst uint16 = this.unpack_uint16();\n\t\treturn uint16 < 0x8000 ? uint16 : uint16 - (1 << 16);\n\t}\n\n\tunpack_int32() {\n\t\tconst uint32 = this.unpack_uint32();\n\t\treturn uint32 < 2 ** 31 ? uint32 : uint32 - 2 ** 32;\n\t}\n\n\tunpack_int64() {\n\t\tconst uint64 = this.unpack_uint64();\n\t\treturn uint64 < 2 ** 63 ? uint64 : uint64 - 2 ** 64;\n\t}\n\n\tunpack_raw(size: number) {\n\t\tif (this.length < this.index + size) {\n\t\t\tthrow new Error(\n\t\t\t\t`BinaryPackFailure: index is out of range ${this.index} ${size} ${this.length}`,\n\t\t\t);\n\t\t}\n\t\tconst buf = this.dataBuffer.slice(this.index, this.index + size);\n\t\tthis.index += size;\n\n\t\treturn buf;\n\t}\n\n\tunpack_string(size: number) {\n\t\tconst bytes = this.read(size);\n\t\tlet i = 0;\n\t\tlet str = \"\";\n\t\tlet c;\n\t\tlet code;\n\n\t\twhile (i < size) {\n\t\t\tc = bytes[i];\n\t\t\t// The length of a UTF-8 sequence is specified in the first byte:\n\t\t\t// 0xxxxxxx means length 1,\n\t\t\t// 110xxxxx means length 2,\n\t\t\t// 1110xxxx means length 3,\n\t\t\t// 11110xxx means length 4.\n\t\t\t// 10xxxxxx is for non-initial bytes.\n\t\t\tif (c < 0xa0) {\n\t\t\t\t// One-byte sequence: bits 0xxxxxxx\n\t\t\t\tcode = c;\n\t\t\t\ti++;\n\t\t\t} else if ((c ^ 0xc0) < 0x20) {\n\t\t\t\t// Two-byte sequence: bits 110xxxxx 10xxxxxx\n\t\t\t\tcode = ((c & 0x1f) << 6) | (bytes[i + 1] & 0x3f);\n\t\t\t\ti += 2;\n\t\t\t} else if ((c ^ 0xe0) < 0x10) {\n\t\t\t\t// Three-byte sequence: bits 1110xxxx 10xxxxxx 10xxxxxx\n\t\t\t\tcode =\n\t\t\t\t\t((c & 0x0f) << 12) |\n\t\t\t\t\t((bytes[i + 1] & 0x3f) << 6) |\n\t\t\t\t\t(bytes[i + 2] & 0x3f);\n\t\t\t\ti += 3;\n\t\t\t} else {\n\t\t\t\t// Four-byte sequence: bits 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\n\t\t\t\tcode =\n\t\t\t\t\t((c & 0x07) << 18) |\n\t\t\t\t\t((bytes[i + 1] & 0x3f) << 12) |\n\t\t\t\t\t((bytes[i + 2] & 0x3f) << 6) |\n\t\t\t\t\t(bytes[i + 3] & 0x3f);\n\t\t\t\ti += 4;\n\t\t\t}\n\t\t\tstr += String.fromCodePoint(code);\n\t\t}\n\n\t\tthis.index += size;\n\t\treturn str;\n\t}\n\n\tunpack_array(size: number) {\n\t\tconst objects = new Array<Unpackable>(size);\n\t\tfor (let i = 0; i < size; i++) {\n\t\t\tobjects[i] = this.unpack();\n\t\t}\n\t\treturn objects;\n\t}\n\n\tunpack_map(size: number) {\n\t\tconst map: { [key: string]: Unpackable } = {};\n\t\tfor (let i = 0; i < size; i++) {\n\t\t\tconst key = this.unpack() as string;\n\t\t\tmap[key] = this.unpack();\n\t\t}\n\t\treturn map;\n\t}\n\n\tunpack_float() {\n\t\tconst uint32 = this.unpack_uint32();\n\t\tconst sign = uint32 >> 31;\n\t\tconst exp = ((uint32 >> 23) & 0xff) - 127;\n\t\tconst fraction = (uint32 & 0x7fffff) | 0x800000;\n\t\treturn (sign === 0 ? 1 : -1) * fraction * 2 ** (exp - 23);\n\t}\n\n\tunpack_double() {\n\t\tconst h32 = this.unpack_uint32();\n\t\tconst l32 = this.unpack_uint32();\n\t\tconst sign = h32 >> 31;\n\t\tconst exp = ((h32 >> 20) & 0x7ff) - 1023;\n\t\tconst hfrac = (h32 & 0xfffff) | 0x100000;\n\t\tconst frac = hfrac * 2 ** (exp - 20) + l32 * 2 ** (exp - 52);\n\t\treturn (sign === 0 ? 1 : -1) * frac;\n\t}\n\n\tread(length: number) {\n\t\tconst j = this.index;\n\t\tif (j + length <= this.length) {\n\t\t\treturn this.dataView.subarray(j, j + length);\n\t\t} else {\n\t\t\tthrow new Error(\"BinaryPackFailure: read index out of range\");\n\t\t}\n\t}\n}\n\nexport class Packer {\n\tprivate _bufferBuilder = new BufferBuilder();\n\tprivate _textEncoder = new TextEncoder();\n\n\tgetBuffer() {\n\t\treturn this._bufferBuilder.toArrayBuffer();\n\t}\n\n\tpack(value: Packable) {\n\t\tif (typeof value === \"string\") {\n\t\t\tthis.pack_string(value);\n\t\t} else if (typeof value === \"number\") {\n\t\t\tif (Math.floor(value) === value) {\n\t\t\t\tthis.pack_integer(value);\n\t\t\t} else {\n\t\t\t\tthis.pack_double(value);\n\t\t\t}\n\t\t} else if (typeof value === \"boolean\") {\n\t\t\tif (value === true) {\n\t\t\t\tthis._bufferBuilder.append(0xc3);\n\t\t\t} else if (value === false) {\n\t\t\t\tthis._bufferBuilder.append(0xc2);\n\t\t\t}\n\t\t} else if (value === undefined) {\n\t\t\tthis._bufferBuilder.append(0xc0);\n\t\t} else if (typeof value === \"object\") {\n\t\t\tif (value === null) {\n\t\t\t\tthis._bufferBuilder.append(0xc0);\n\t\t\t} else {\n\t\t\t\tconst constructor = value.constructor;\n\t\t\t\tif (value instanceof Array) {\n\t\t\t\t\tthis.pack_array(value);\n\t\t\t\t} else if (value instanceof ArrayBuffer) {\n\t\t\t\t\tthis.pack_bin(new Uint8Array(value));\n\t\t\t\t} else if (\"BYTES_PER_ELEMENT\" in value) {\n\t\t\t\t\tconst v = value as unknown as DataView;\n\t\t\t\t\tthis.pack_bin(new Uint8Array(v.buffer, v.byteOffset, v.byteLength));\n\t\t\t\t} else if (value instanceof Date) {\n\t\t\t\t\tthis.pack_string(value.toString());\n\t\t\t\t} else if (\n\t\t\t\t\tconstructor == Object ||\n\t\t\t\t\tconstructor.toString().startsWith(\"class\")\n\t\t\t\t) {\n\t\t\t\t\tthis.pack_object(value);\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(`Type \"${constructor.toString()}\" not yet supported`);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthrow new Error(`Type \"${typeof value}\" not yet supported`);\n\t\t}\n\t\tthis._bufferBuilder.flush();\n\t}\n\n\tpack_bin(blob: Uint8Array) {\n\t\tconst length = blob.length;\n\n\t\tif (length <= 0x0f) {\n\t\t\tthis.pack_uint8(0xa0 + length);\n\t\t} else if (length <= 0xffff) {\n\t\t\tthis._bufferBuilder.append(0xda);\n\t\t\tthis.pack_uint16(length);\n\t\t} else if (length <= 0xffffffff) {\n\t\t\tthis._bufferBuilder.append(0xdb);\n\t\t\tthis.pack_uint32(length);\n\t\t} else {\n\t\t\tthrow new Error(\"Invalid length\");\n\t\t}\n\t\tthis._bufferBuilder.append_buffer(blob);\n\t}\n\n\tpack_string(str: string) {\n\t\tconst encoded = this._textEncoder.encode(str);\n\t\tconst length = encoded.length;\n\n\t\tif (length <= 0x0f) {\n\t\t\tthis.pack_uint8(0xb0 + length);\n\t\t} else if (length <= 0xffff) {\n\t\t\tthis._bufferBuilder.append(0xd8);\n\t\t\tthis.pack_uint16(length);\n\t\t} else if (length <= 0xffffffff) {\n\t\t\tthis._bufferBuilder.append(0xd9);\n\t\t\tthis.pack_uint32(length);\n\t\t} else {\n\t\t\tthrow new Error(\"Invalid length\");\n\t\t}\n\t\tthis._bufferBuilder.append_buffer(encoded);\n\t}\n\n\tpack_array(ary: Packable[]) {\n\t\tconst length = ary.length;\n\t\tif (length <= 0x0f) {\n\t\t\tthis.pack_uint8(0x90 + length);\n\t\t} else if (length <= 0xffff) {\n\t\t\tthis._bufferBuilder.append(0xdc);\n\t\t\tthis.pack_uint16(length);\n\t\t} else if (length <= 0xffffffff) {\n\t\t\tthis._bufferBuilder.append(0xdd);\n\t\t\tthis.pack_uint32(length);\n\t\t} else {\n\t\t\tthrow new Error(\"Invalid length\");\n\t\t}\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tthis.pack(ary[i]);\n\t\t}\n\t}\n\n\tpack_integer(num: number) {\n\t\tif (num >= -0x20 && num <= 0x7f) {\n\t\t\tthis._bufferBuilder.append(num & 0xff);\n\t\t} else if (num >= 0x00 && num <= 0xff) {\n\t\t\tthis._bufferBuilder.append(0xcc);\n\t\t\tthis.pack_uint8(num);\n\t\t} else if (num >= -0x80 && num <= 0x7f) {\n\t\t\tthis._bufferBuilder.append(0xd0);\n\t\t\tthis.pack_int8(num);\n\t\t} else if (num >= 0x0000 && num <= 0xffff) {\n\t\t\tthis._bufferBuilder.append(0xcd);\n\t\t\tthis.pack_uint16(num);\n\t\t} else if (num >= -0x8000 && num <= 0x7fff) {\n\t\t\tthis._bufferBuilder.append(0xd1);\n\t\t\tthis.pack_int16(num);\n\t\t} else if (num >= 0x00000000 && num <= 0xffffffff) {\n\t\t\tthis._bufferBuilder.append(0xce);\n\t\t\tthis.pack_uint32(num);\n\t\t} else if (num >= -0x80000000 && num <= 0x7fffffff) {\n\t\t\tthis._bufferBuilder.append(0xd2);\n\t\t\tthis.pack_int32(num);\n\t\t} else if (num >= -0x8000000000000000 && num <= 0x7fffffffffffffff) {\n\t\t\tthis._bufferBuilder.append(0xd3);\n\t\t\tthis.pack_int64(num);\n\t\t} else if (num >= 0x0000000000000000 && num <= 0xffffffffffffffff) {\n\t\t\tthis._bufferBuilder.append(0xcf);\n\t\t\tthis.pack_uint64(num);\n\t\t} else {\n\t\t\tthrow new Error(\"Invalid integer\");\n\t\t}\n\t}\n\n\tpack_double(num: number) {\n\t\tlet sign = 0;\n\t\tif (num < 0) {\n\t\t\tsign = 1;\n\t\t\tnum = -num;\n\t\t}\n\t\tconst exp = Math.floor(Math.log(num) / Math.LN2);\n\t\tconst frac0 = num / 2 ** exp - 1;\n\t\tconst frac1 = Math.floor(frac0 * 2 ** 52);\n\t\tconst b32 = 2 ** 32;\n\t\tconst h32 =\n\t\t\t(sign << 31) | ((exp + 1023) << 20) | ((frac1 / b32) & 0x0fffff);\n\t\tconst l32 = frac1 % b32;\n\t\tthis._bufferBuilder.append(0xcb);\n\t\tthis.pack_int32(h32);\n\t\tthis.pack_int32(l32);\n\t}\n\n\tpack_object(obj: { [key: string]: Packable }) {\n\t\tconst keys = Object.keys(obj);\n\t\tconst length = keys.length;\n\t\tif (length <= 0x0f) {\n\t\t\tthis.pack_uint8(0x80 + length);\n\t\t} else if (length <= 0xffff) {\n\t\t\tthis._bufferBuilder.append(0xde);\n\t\t\tthis.pack_uint16(length);\n\t\t} else if (length <= 0xffffffff) {\n\t\t\tthis._bufferBuilder.append(0xdf);\n\t\t\tthis.pack_uint32(length);\n\t\t} else {\n\t\t\tthrow new Error(\"Invalid length\");\n\t\t}\n\t\tfor (const prop in obj) {\n\t\t\t// eslint-disable-next-line no-prototype-builtins\n\t\t\tif (obj.hasOwnProperty(prop)) {\n\t\t\t\tthis.pack(prop);\n\t\t\t\tthis.pack(obj[prop]);\n\t\t\t}\n\t\t}\n\t}\n\n\tpack_uint8(num: number) {\n\t\tthis._bufferBuilder.append(num);\n\t}\n\n\tpack_uint16(num: number) {\n\t\tthis._bufferBuilder.append(num >> 8);\n\t\tthis._bufferBuilder.append(num & 0xff);\n\t}\n\n\tpack_uint32(num: number) {\n\t\tconst n = num & 0xffffffff;\n\t\tthis._bufferBuilder.append((n & 0xff000000) >>> 24);\n\t\tthis._bufferBuilder.append((n & 0x00ff0000) >>> 16);\n\t\tthis._bufferBuilder.append((n & 0x0000ff00) >>> 8);\n\t\tthis._bufferBuilder.append(n & 0x000000ff);\n\t}\n\n\tpack_uint64(num: number) {\n\t\tconst high = num / 2 ** 32;\n\t\tconst low = num % 2 ** 32;\n\t\tthis._bufferBuilder.append((high & 0xff000000) >>> 24);\n\t\tthis._bufferBuilder.append((high & 0x00ff0000) >>> 16);\n\t\tthis._bufferBuilder.append((high & 0x0000ff00) >>> 8);\n\t\tthis._bufferBuilder.append(high & 0x000000ff);\n\t\tthis._bufferBuilder.append((low & 0xff000000) >>> 24);\n\t\tthis._bufferBuilder.append((low & 0x00ff0000) >>> 16);\n\t\tthis._bufferBuilder.append((low & 0x0000ff00) >>> 8);\n\t\tthis._bufferBuilder.append(low & 0x000000ff);\n\t}\n\n\tpack_int8(num: number) {\n\t\tthis._bufferBuilder.append(num & 0xff);\n\t}\n\n\tpack_int16(num: number) {\n\t\tthis._bufferBuilder.append((num & 0xff00) >> 8);\n\t\tthis._bufferBuilder.append(num & 0xff);\n\t}\n\n\tpack_int32(num: number) {\n\t\tthis._bufferBuilder.append((num >>> 24) & 0xff);\n\t\tthis._bufferBuilder.append((num & 0x00ff0000) >>> 16);\n\t\tthis._bufferBuilder.append((num & 0x0000ff00) >>> 8);\n\t\tthis._bufferBuilder.append(num & 0x000000ff);\n\t}\n\n\tpack_int64(num: number) {\n\t\tconst high = Math.floor(num / 2 ** 32);\n\t\tconst low = num % 2 ** 32;\n\t\tthis._bufferBuilder.append((high & 0xff000000) >>> 24);\n\t\tthis._bufferBuilder.append((high & 0x00ff0000) >>> 16);\n\t\tthis._bufferBuilder.append((high & 0x0000ff00) >>> 8);\n\t\tthis._bufferBuilder.append(high & 0x000000ff);\n\t\tthis._bufferBuilder.append((low & 0xff000000) >>> 24);\n\t\tthis._bufferBuilder.append((low & 0x00ff0000) >>> 16);\n\t\tthis._bufferBuilder.append((low & 0x0000ff00) >>> 8);\n\t\tthis._bufferBuilder.append(low & 0x000000ff);\n\t}\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nlet logDisabled_ = true;\nlet deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nexport function extractVersion(uastring, expr, pos) {\n  const match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object (or false to prevent\n// the event).\nexport function wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  const nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    const wrappedCallback = (e) => {\n      const modifiedEvent = wrapper(e);\n      if (modifiedEvent) {\n        if (cb.handleEvent) {\n          cb.handleEvent(modifiedEvent);\n        } else {\n          cb(modifiedEvent);\n        }\n      }\n    };\n    this._eventMap = this._eventMap || {};\n    if (!this._eventMap[eventNameToWrap]) {\n      this._eventMap[eventNameToWrap] = new Map();\n    }\n    this._eventMap[eventNameToWrap].set(cb, wrappedCallback);\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  const nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[eventNameToWrap]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    if (!this._eventMap[eventNameToWrap].has(cb)) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    const unwrappedCb = this._eventMap[eventNameToWrap].get(cb);\n    this._eventMap[eventNameToWrap].delete(cb);\n    if (this._eventMap[eventNameToWrap].size === 0) {\n      delete this._eventMap[eventNameToWrap];\n    }\n    if (Object.keys(this._eventMap).length === 0) {\n      delete this._eventMap;\n    }\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get() {\n      return this['_on' + eventNameToWrap];\n    },\n    set(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n          this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n          this['_on' + eventNameToWrap] = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n}\n\nexport function disableLog(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  logDisabled_ = bool;\n  return (bool) ? 'adapter.js logging disabled' :\n    'adapter.js logging enabled';\n}\n\n/**\n * Disable or enable deprecation warnings\n * @param {!boolean} bool set to true to disable warnings.\n */\nexport function disableWarnings(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  deprecationWarnings_ = !bool;\n  return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n}\n\nexport function log() {\n  if (typeof window === 'object') {\n    if (logDisabled_) {\n      return;\n    }\n    if (typeof console !== 'undefined' && typeof console.log === 'function') {\n      console.log.apply(console, arguments);\n    }\n  }\n}\n\n/**\n * Shows a deprecation warning suggesting the modern and spec-compatible API.\n */\nexport function deprecated(oldMethod, newMethod) {\n  if (!deprecationWarnings_) {\n    return;\n  }\n  console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n      ' instead.');\n}\n\n/**\n * Browser detector.\n *\n * @return {object} result containing browser and version\n *     properties.\n */\nexport function detectBrowser(window) {\n  // Returned result object.\n  const result = {browser: null, version: null};\n\n  // Fail early if it's not a browser\n  if (typeof window === 'undefined' || !window.navigator ||\n      !window.navigator.userAgent) {\n    result.browser = 'Not a browser.';\n    return result;\n  }\n\n  const {navigator} = window;\n\n  if (navigator.mozGetUserMedia) { // Firefox.\n    result.browser = 'firefox';\n    result.version = extractVersion(navigator.userAgent,\n      /Firefox\\/(\\d+)\\./, 1);\n  } else if (navigator.webkitGetUserMedia ||\n      (window.isSecureContext === false && window.webkitRTCPeerConnection)) {\n    // Chrome, Chromium, Webview, Opera.\n    // Version matches Chrome/WebRTC version.\n    // Chrome 74 removed webkitGetUserMedia on http as well so we need the\n    // more complicated fallback to webkitRTCPeerConnection.\n    result.browser = 'chrome';\n    result.version = extractVersion(navigator.userAgent,\n      /Chrom(e|ium)\\/(\\d+)\\./, 2);\n  } else if (window.RTCPeerConnection &&\n      navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) { // Safari.\n    result.browser = 'safari';\n    result.version = extractVersion(navigator.userAgent,\n      /AppleWebKit\\/(\\d+)\\./, 1);\n    result.supportsUnifiedPlan = window.RTCRtpTransceiver &&\n        'currentDirection' in window.RTCRtpTransceiver.prototype;\n  } else { // Default fallthrough: not supported.\n    result.browser = 'Not a supported browser.';\n    return result;\n  }\n\n  return result;\n}\n\n/**\n * Checks if something is an object.\n *\n * @param {*} val The something you want to check.\n * @return true if val is an object, false otherwise.\n */\nfunction isObject(val) {\n  return Object.prototype.toString.call(val) === '[object Object]';\n}\n\n/**\n * Remove all empty objects and undefined values\n * from a nested object -- an enhanced and vanilla version\n * of Lodash's `compact`.\n */\nexport function compactObject(data) {\n  if (!isObject(data)) {\n    return data;\n  }\n\n  return Object.keys(data).reduce(function(accumulator, key) {\n    const isObj = isObject(data[key]);\n    const value = isObj ? compactObject(data[key]) : data[key];\n    const isEmptyObject = isObj && !Object.keys(value).length;\n    if (value === undefined || isEmptyObject) {\n      return accumulator;\n    }\n    return Object.assign(accumulator, {[key]: value});\n  }, {});\n}\n\n/* iterates the stats graph recursively. */\nexport function walkStats(stats, base, resultSet) {\n  if (!base || resultSet.has(base.id)) {\n    return;\n  }\n  resultSet.set(base.id, base);\n  Object.keys(base).forEach(name => {\n    if (name.endsWith('Id')) {\n      walkStats(stats, stats.get(base[name]), resultSet);\n    } else if (name.endsWith('Ids')) {\n      base[name].forEach(id => {\n        walkStats(stats, stats.get(id), resultSet);\n      });\n    }\n  });\n}\n\n/* filter getStats for a sender/receiver track. */\nexport function filterStats(result, track, outbound) {\n  const streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\n  const filteredResult = new Map();\n  if (track === null) {\n    return filteredResult;\n  }\n  const trackStats = [];\n  result.forEach(value => {\n    if (value.type === 'track' &&\n        value.trackIdentifier === track.id) {\n      trackStats.push(value);\n    }\n  });\n  trackStats.forEach(trackStat => {\n    result.forEach(stats => {\n      if (stats.type === streamStatsType && stats.trackId === trackStat.id) {\n        walkStats(result, stats, filteredResult);\n      }\n    });\n  });\n  return filteredResult;\n}\n\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\nconst logging = utils.log;\n\nexport function shimGetUserMedia(window, browserDetails) {\n  const navigator = window && window.navigator;\n\n  if (!navigator.mediaDevices) {\n    return;\n  }\n\n  const constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    const cc = {};\n    Object.keys(c).forEach(key => {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      const r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      const oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        let oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(mix => {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  const shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      const remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      let face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      const getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        let matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n            .then(devices => {\n              devices = devices.filter(d => d.kind === 'videoinput');\n              let dev = devices.find(d => matches.some(match =>\n                d.label.toLowerCase().includes(match)));\n              if (!dev && devices.length && matches.includes('back')) {\n                dev = devices[devices.length - 1]; // more likely the back cam\n              }\n              if (dev) {\n                constraints.video.deviceId = face.exact\n                  ? {exact: dev.deviceId}\n                  : {ideal: dev.deviceId};\n              }\n              constraints.video = constraintsToChrome_(constraints.video);\n              logging('chrome: ' + JSON.stringify(constraints));\n              return func(constraints);\n            });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  const shimError_ = function(e) {\n    if (browserDetails.version >= 64) {\n      return e;\n    }\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        PermissionDismissedError: 'NotAllowedError',\n        InvalidStateError: 'NotAllowedError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotAllowedError',\n        MediaDeviceKillSwitchOn: 'NotAllowedError',\n        TabCaptureError: 'AbortError',\n        ScreenCaptureError: 'AbortError',\n        DeviceCaptureError: 'AbortError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint || e.constraintName,\n      toString() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  const getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, c => {\n      navigator.webkitGetUserMedia(c, onSuccess, e => {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n  navigator.getUserMedia = getUserMedia_.bind(navigator);\n\n  // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n  // function which returns a Promise, it does not accept spec-style\n  // constraints.\n  if (navigator.mediaDevices.getUserMedia) {\n    const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, c => origGetUserMedia(c).then(stream => {\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(track => {\n            track.stop();\n          });\n          throw new DOMException('', 'NotFoundError');\n        }\n        return stream;\n      }, e => Promise.reject(shimError_(e))));\n    };\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nexport function shimGetDisplayMedia(window, getSourceId) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  // getSourceId is a function that returns a promise resolving with\n  // the sourceId of the screen/window/tab to be shared.\n  if (typeof getSourceId !== 'function') {\n    console.error('shimGetDisplayMedia: getSourceId argument is not ' +\n        'a function');\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      return getSourceId(constraints)\n        .then(sourceId => {\n          const widthSpecified = constraints.video && constraints.video.width;\n          const heightSpecified = constraints.video &&\n            constraints.video.height;\n          const frameRateSpecified = constraints.video &&\n            constraints.video.frameRate;\n          constraints.video = {\n            mandatory: {\n              chromeMediaSource: 'desktop',\n              chromeMediaSourceId: sourceId,\n              maxFrameRate: frameRateSpecified || 3\n            }\n          };\n          if (widthSpecified) {\n            constraints.video.mandatory.maxWidth = widthSpecified;\n          }\n          if (heightSpecified) {\n            constraints.video.mandatory.maxHeight = heightSpecified;\n          }\n          return window.navigator.mediaDevices.getUserMedia(constraints);\n        });\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\n\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimMediaStream(window) {\n  window.MediaStream = window.MediaStream || window.webkitMediaStream;\n}\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n      window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n      get() {\n        return this._ontrack;\n      },\n      set(f) {\n        if (this._ontrack) {\n          this.removeEventListener('track', this._ontrack);\n        }\n        this.addEventListener('track', this._ontrack = f);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    const origSetRemoteDescription =\n        window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        if (!this._ontrackpoly) {\n          this._ontrackpoly = (e) => {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', te => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === te.track.id);\n              } else {\n                receiver = {track: te.track};\n              }\n\n              const event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(track => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === track.id);\n              } else {\n                receiver = {track};\n              }\n              const event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n          };\n          this.addEventListener('addstream', this._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(this, arguments);\n      };\n  } else {\n    // even if RTCRtpTransceiver is in window, it is only used and\n    // emitted in unified-plan. Unfortunately this means we need\n    // to unconditionally wrap the event.\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      if (!e.transceiver) {\n        Object.defineProperty(e, 'transceiver',\n          {value: {receiver: e.receiver}});\n      }\n      return e;\n    });\n  }\n}\n\nexport function shimGetSendersWithDtmf(window) {\n  // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n  if (typeof window === 'object' && window.RTCPeerConnection &&\n      !('getSenders' in window.RTCPeerConnection.prototype) &&\n      'createDTMFSender' in window.RTCPeerConnection.prototype) {\n    const shimSenderWithDtmf = function(pc, track) {\n      return {\n        track,\n        get dtmf() {\n          if (this._dtmf === undefined) {\n            if (track.kind === 'audio') {\n              this._dtmf = pc.createDTMFSender(track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        },\n        _pc: pc\n      };\n    };\n\n    // augment addTrack when getSenders is not available.\n    if (!window.RTCPeerConnection.prototype.getSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        this._senders = this._senders || [];\n        return this._senders.slice(); // return a copy of the internal state.\n      };\n      const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addTrack =\n        function addTrack(track, stream) {\n          let sender = origAddTrack.apply(this, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(this, track);\n            this._senders.push(sender);\n          }\n          return sender;\n        };\n\n      const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n      window.RTCPeerConnection.prototype.removeTrack =\n        function removeTrack(sender) {\n          origRemoveTrack.apply(this, arguments);\n          const idx = this._senders.indexOf(sender);\n          if (idx !== -1) {\n            this._senders.splice(idx, 1);\n          }\n        };\n    }\n    const origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      this._senders = this._senders || [];\n      origAddStream.apply(this, [stream]);\n      stream.getTracks().forEach(track => {\n        this._senders.push(shimSenderWithDtmf(this, track));\n      });\n    };\n\n    const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        this._senders = this._senders || [];\n        origRemoveStream.apply(this, [stream]);\n\n        stream.getTracks().forEach(track => {\n          const sender = this._senders.find(s => s.track === track);\n          if (sender) { // remove sender\n            this._senders.splice(this._senders.indexOf(sender), 1);\n          }\n        });\n      };\n  } else if (typeof window === 'object' && window.RTCPeerConnection &&\n             'getSenders' in window.RTCPeerConnection.prototype &&\n             'createDTMFSender' in window.RTCPeerConnection.prototype &&\n             window.RTCRtpSender &&\n             !('dtmf' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = this._pc.createDTMFSender(this.track);\n          } else {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n}\n\nexport function shimGetStats(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n\n    // If selector is a function then we are in the old style stats so just\n    // pass back the original getStats format to avoid breaking old users.\n    if (arguments.length > 0 && typeof selector === 'function') {\n      return origGetStats.apply(this, arguments);\n    }\n\n    // When spec-style getStats is supported, return those when called with\n    // either no arguments or the selector argument is null.\n    if (origGetStats.length === 0 && (arguments.length === 0 ||\n        typeof selector !== 'function')) {\n      return origGetStats.apply(this, []);\n    }\n\n    const fixChromeStats_ = function(response) {\n      const standardReport = {};\n      const reports = response.result();\n      reports.forEach(report => {\n        const standardStats = {\n          id: report.id,\n          timestamp: report.timestamp,\n          type: {\n            localcandidate: 'local-candidate',\n            remotecandidate: 'remote-candidate'\n          }[report.type] || report.type\n        };\n        report.names().forEach(name => {\n          standardStats[name] = report.stat(name);\n        });\n        standardReport[standardStats.id] = standardStats;\n      });\n\n      return standardReport;\n    };\n\n    // shim getStats with maplike support\n    const makeMapStats = function(stats) {\n      return new Map(Object.keys(stats).map(key => [key, stats[key]]));\n    };\n\n    if (arguments.length >= 2) {\n      const successCallbackWrapper_ = function(response) {\n        onSucc(makeMapStats(fixChromeStats_(response)));\n      };\n\n      return origGetStats.apply(this, [successCallbackWrapper_,\n        selector]);\n    }\n\n    // promise-support\n    return new Promise((resolve, reject) => {\n      origGetStats.apply(this, [\n        function(response) {\n          resolve(makeMapStats(fixChromeStats_(response)));\n        }, reject]);\n    }).then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender && window.RTCRtpReceiver)) {\n    return;\n  }\n\n  // shim sender stats.\n  if (!('getStats' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        const senders = origGetSenders.apply(this, []);\n        senders.forEach(sender => sender._pc = this);\n        return senders;\n      };\n    }\n\n    const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n        const sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function getStats() {\n      const sender = this;\n      return this._pc.getStats().then(result =>\n        /* Note: this will include stats of all senders that\n         *   send a track with the same id as sender.track as\n         *   it is not possible to identify the RTCRtpSender.\n         */\n        utils.filterStats(result, sender.track, true));\n    };\n  }\n\n  // shim receiver stats.\n  if (!('getStats' in window.RTCRtpReceiver.prototype)) {\n    const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers =\n        function getReceivers() {\n          const receivers = origGetReceivers.apply(this, []);\n          receivers.forEach(receiver => receiver._pc = this);\n          return receivers;\n        };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function getStats() {\n      const receiver = this;\n      return this._pc.getStats().then(result =>\n        utils.filterStats(result, receiver.track, false));\n    };\n  }\n\n  if (!('getStats' in window.RTCRtpSender.prototype &&\n      'getStats' in window.RTCRtpReceiver.prototype)) {\n    return;\n  }\n\n  // shim RTCPeerConnection.getStats(track).\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    if (arguments.length > 0 &&\n        arguments[0] instanceof window.MediaStreamTrack) {\n      const track = arguments[0];\n      let sender;\n      let receiver;\n      let err;\n      this.getSenders().forEach(s => {\n        if (s.track === track) {\n          if (sender) {\n            err = true;\n          } else {\n            sender = s;\n          }\n        }\n      });\n      this.getReceivers().forEach(r => {\n        if (r.track === track) {\n          if (receiver) {\n            err = true;\n          } else {\n            receiver = r;\n          }\n        }\n        return r.track === track;\n      });\n      if (err || (sender && receiver)) {\n        return Promise.reject(new DOMException(\n          'There are more than one sender or receiver for the track.',\n          'InvalidAccessError'));\n      } else if (sender) {\n        return sender.getStats();\n      } else if (receiver) {\n        return receiver.getStats();\n      }\n      return Promise.reject(new DOMException(\n        'There is no sender or receiver for the track.',\n        'InvalidAccessError'));\n    }\n    return origGetStats.apply(this, arguments);\n  };\n}\n\nexport function shimAddTrackRemoveTrackWithNative(window) {\n  // shim addTrack/removeTrack with native variants in order to make\n  // the interactions with legacy getLocalStreams behave as in other browsers.\n  // Keeps a mapping stream.id => [stream, rtpsenders...]\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams)\n        .map(streamId => this._shimmedLocalStreams[streamId][0]);\n    };\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      const sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n          'InvalidAccessError');\n      }\n    });\n    const existingSenders = this.getSenders();\n    origAddStream.apply(this, arguments);\n    const newSenders = this.getSenders()\n      .filter(newSender => existingSenders.indexOf(newSender) === -1);\n    this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n  const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(streamId => {\n          const idx = this._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            this._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (this._shimmedLocalStreams[streamId].length === 1) {\n            delete this._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n}\n\nexport function shimAddTrackRemoveTrack(window, browserDetails) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // shim addTrack and removeTrack.\n  if (window.RTCPeerConnection.prototype.addTrack &&\n      browserDetails.version >= 65) {\n    return shimAddTrackRemoveTrackWithNative(window);\n  }\n\n  // also shim pc.getLocalStreams when addTrack is shimmed\n  // to return the original streams.\n  const origGetLocalStreams = window.RTCPeerConnection.prototype\n    .getLocalStreams;\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      const nativeStreams = origGetLocalStreams.apply(this);\n      this._reverseStreams = this._reverseStreams || {};\n      return nativeStreams.map(stream => this._reverseStreams[stream.id]);\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n          'InvalidAccessError');\n      }\n    });\n    // Add identity mapping for consistency with addTrack.\n    // Unless this is being used with a stream from addTrack.\n    if (!this._reverseStreams[stream.id]) {\n      const newStream = new window.MediaStream(stream.getTracks());\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      stream = newStream;\n    }\n    origAddStream.apply(this, [stream]);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n\n      origRemoveStream.apply(this, [(this._streams[stream.id] || stream)]);\n      delete this._reverseStreams[(this._streams[stream.id] ?\n        this._streams[stream.id].id : stream.id)];\n      delete this._streams[stream.id];\n    };\n\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      const streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(t => t === track)) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n          'InvalidAccessError');\n      }\n\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n      const oldStream = this._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(() => {\n          this.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        const newStream = new window.MediaStream([track]);\n        this._streams[stream.id] = newStream;\n        this._reverseStreams[newStream.id] = stream;\n        this.addStream(newStream);\n      }\n      return this.getSenders().find(s => s.track === track);\n    };\n\n  // replace the internal stream id with the external one and\n  // vice versa.\n  function replaceInternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n        externalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  function replaceExternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n        internalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  ['createOffer', 'createAnswer'].forEach(function(method) {\n    const nativeMethod = window.RTCPeerConnection.prototype[method];\n    const methodObj = {[method]() {\n      const args = arguments;\n      const isLegacyCall = arguments.length &&\n          typeof arguments[0] === 'function';\n      if (isLegacyCall) {\n        return nativeMethod.apply(this, [\n          (description) => {\n            const desc = replaceInternalStreamId(this, description);\n            args[0].apply(null, [desc]);\n          },\n          (err) => {\n            if (args[1]) {\n              args[1].apply(null, err);\n            }\n          }, arguments[2]\n        ]);\n      }\n      return nativeMethod.apply(this, arguments)\n        .then(description => replaceInternalStreamId(this, description));\n    }};\n    window.RTCPeerConnection.prototype[method] = methodObj[method];\n  });\n\n  const origSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(this, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(this, arguments[0]);\n      return origSetLocalDescription.apply(this, arguments);\n    };\n\n  // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n  const origLocalDescription = Object.getOwnPropertyDescriptor(\n    window.RTCPeerConnection.prototype, 'localDescription');\n  Object.defineProperty(window.RTCPeerConnection.prototype,\n    'localDescription', {\n      get() {\n        const description = origLocalDescription.get.apply(this);\n        if (description.type === '') {\n          return description;\n        }\n        return replaceInternalStreamId(this, description);\n      }\n    });\n\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      const isLocal = sender._pc === this;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n          'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      this._streams = this._streams || {};\n      let stream;\n      Object.keys(this._streams).forEach(streamid => {\n        const hasTrack = this._streams[streamid].getTracks()\n          .find(track => sender.track === track);\n        if (hasTrack) {\n          stream = this._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          this.removeStream(this._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        this.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n}\n\nexport function shimPeerConnection(window, browserDetails) {\n  if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.webkitRTCPeerConnection;\n  }\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n  if (browserDetails.version < 53) {\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n      .forEach(function(method) {\n        const nativeMethod = window.RTCPeerConnection.prototype[method];\n        const methodObj = {[method]() {\n          arguments[0] = new ((method === 'addIceCandidate') ?\n            window.RTCIceCandidate :\n            window.RTCSessionDescription)(arguments[0]);\n          return nativeMethod.apply(this, arguments);\n        }};\n        window.RTCPeerConnection.prototype[method] = methodObj[method];\n      });\n  }\n}\n\n// Attempt to fix ONN in plan-b mode.\nexport function fixNegotiationNeeded(window, browserDetails) {\n  utils.wrapPeerConnectionEvent(window, 'negotiationneeded', e => {\n    const pc = e.target;\n    if (browserDetails.version < 72 || (pc.getConfiguration &&\n        pc.getConfiguration().sdpSemantics === 'plan-b')) {\n      if (pc.signalingState !== 'stable') {\n        return;\n      }\n    }\n    return e;\n  });\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n\nexport function shimGetUserMedia(window, browserDetails) {\n  const navigator = window && window.navigator;\n  const MediaStreamTrack = window && window.MediaStreamTrack;\n\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n      'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    const remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    const nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      const nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        const obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      const nativeApplyConstraints =\n        MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window, preferredMediaSource) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      if (!(constraints && constraints.video)) {\n        const err = new DOMException('getDisplayMedia without video ' +\n            'constraints is undefined');\n        err.name = 'NotFoundError';\n        // from https://heycam.github.io/webidl/#idl-DOMException-error-names\n        err.code = 8;\n        return Promise.reject(err);\n      }\n      if (constraints.video === true) {\n        constraints.video = {mediaSource: preferredMediaSource};\n      } else {\n        constraints.video.mediaSource = preferredMediaSource;\n      }\n      return window.navigator.mediaDevices.getUserMedia(constraints);\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      ('receiver' in window.RTCTrackEvent.prototype) &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimPeerConnection(window, browserDetails) {\n  if (typeof window !== 'object' ||\n      !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\n    return; // probably media.peerconnection.enabled=false in about:config\n  }\n  if (!window.RTCPeerConnection && window.mozRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.mozRTCPeerConnection;\n  }\n\n  if (browserDetails.version < 53) {\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n      .forEach(function(method) {\n        const nativeMethod = window.RTCPeerConnection.prototype[method];\n        const methodObj = {[method]() {\n          arguments[0] = new ((method === 'addIceCandidate') ?\n            window.RTCIceCandidate :\n            window.RTCSessionDescription)(arguments[0]);\n          return nativeMethod.apply(this, arguments);\n        }};\n        window.RTCPeerConnection.prototype[method] = methodObj[method];\n      });\n  }\n\n  const modernStatsTypes = {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  };\n\n  const nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n    return nativeGetStats.apply(this, [selector || null])\n      .then(stats => {\n        if (browserDetails.version < 53 && !onSucc) {\n          // Shim only promise getStats with spec-hyphens in type names\n          // Leave callback version alone; misc old uses of forEach before Map\n          try {\n            stats.forEach(stat => {\n              stat.type = modernStatsTypes[stat.type] || stat.type;\n            });\n          } catch (e) {\n            if (e.name !== 'TypeError') {\n              throw e;\n            }\n            // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n            stats.forEach((stat, i) => {\n              stats.set(i, Object.assign({}, stat, {\n                type: modernStatsTypes[stat.type] || stat.type\n              }));\n            });\n          }\n        }\n        return stats;\n      })\n      .then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\n    return;\n  }\n  const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n  if (origGetSenders) {\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n  }\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  if (origAddTrack) {\n    window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n      const sender = origAddTrack.apply(this, arguments);\n      sender._pc = this;\n      return sender;\n    };\n  }\n  window.RTCRtpSender.prototype.getStats = function getStats() {\n    return this.track ? this._pc.getStats(this.track) :\n      Promise.resolve(new Map());\n  };\n}\n\nexport function shimReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\n    return;\n  }\n  const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n  if (origGetReceivers) {\n    window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\n      const receivers = origGetReceivers.apply(this, []);\n      receivers.forEach(receiver => receiver._pc = this);\n      return receivers;\n    };\n  }\n  utils.wrapPeerConnectionEvent(window, 'track', e => {\n    e.receiver._pc = e.srcElement;\n    return e;\n  });\n  window.RTCRtpReceiver.prototype.getStats = function getStats() {\n    return this._pc.getStats(this.track);\n  };\n}\n\nexport function shimRemoveStream(window) {\n  if (!window.RTCPeerConnection ||\n      'removeStream' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(sender => {\n        if (sender.track && stream.getTracks().includes(sender.track)) {\n          this.removeTrack(sender);\n        }\n      });\n    };\n}\n\nexport function shimRTCDataChannel(window) {\n  // rename DataChannel to RTCDataChannel (native fix in FF60):\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\n  if (window.DataChannel && !window.RTCDataChannel) {\n    window.RTCDataChannel = window.DataChannel;\n  }\n}\n\nexport function shimAddTransceiver(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origAddTransceiver = window.RTCPeerConnection.prototype.addTransceiver;\n  if (origAddTransceiver) {\n    window.RTCPeerConnection.prototype.addTransceiver =\n      function addTransceiver() {\n        this.setParametersPromises = [];\n        // WebIDL input coercion and validation\n        let sendEncodings = arguments[1] && arguments[1].sendEncodings;\n        if (sendEncodings === undefined) {\n          sendEncodings = [];\n        }\n        sendEncodings = [...sendEncodings];\n        const shouldPerformCheck = sendEncodings.length > 0;\n        if (shouldPerformCheck) {\n          // If sendEncodings params are provided, validate grammar\n          sendEncodings.forEach((encodingParam) => {\n            if ('rid' in encodingParam) {\n              const ridRegex = /^[a-z0-9]{0,16}$/i;\n              if (!ridRegex.test(encodingParam.rid)) {\n                throw new TypeError('Invalid RID value provided.');\n              }\n            }\n            if ('scaleResolutionDownBy' in encodingParam) {\n              if (!(parseFloat(encodingParam.scaleResolutionDownBy) >= 1.0)) {\n                throw new RangeError('scale_resolution_down_by must be >= 1.0');\n              }\n            }\n            if ('maxFramerate' in encodingParam) {\n              if (!(parseFloat(encodingParam.maxFramerate) >= 0)) {\n                throw new RangeError('max_framerate must be >= 0.0');\n              }\n            }\n          });\n        }\n        const transceiver = origAddTransceiver.apply(this, arguments);\n        if (shouldPerformCheck) {\n          // Check if the init options were applied. If not we do this in an\n          // asynchronous way and save the promise reference in a global object.\n          // This is an ugly hack, but at the same time is way more robust than\n          // checking the sender parameters before and after the createOffer\n          // Also note that after the createoffer we are not 100% sure that\n          // the params were asynchronously applied so we might miss the\n          // opportunity to recreate offer.\n          const {sender} = transceiver;\n          const params = sender.getParameters();\n          if (!('encodings' in params) ||\n              // Avoid being fooled by patched getParameters() below.\n              (params.encodings.length === 1 &&\n               Object.keys(params.encodings[0]).length === 0)) {\n            params.encodings = sendEncodings;\n            sender.sendEncodings = sendEncodings;\n            this.setParametersPromises.push(sender.setParameters(params)\n              .then(() => {\n                delete sender.sendEncodings;\n              }).catch(() => {\n                delete sender.sendEncodings;\n              })\n            );\n          }\n        }\n        return transceiver;\n      };\n  }\n}\n\nexport function shimGetParameters(window) {\n  if (!(typeof window === 'object' && window.RTCRtpSender)) {\n    return;\n  }\n  const origGetParameters = window.RTCRtpSender.prototype.getParameters;\n  if (origGetParameters) {\n    window.RTCRtpSender.prototype.getParameters =\n      function getParameters() {\n        const params = origGetParameters.apply(this, arguments);\n        if (!('encodings' in params)) {\n          params.encodings = [].concat(this.sendEncodings || [{}]);\n        }\n        return params;\n      };\n  }\n}\n\nexport function shimCreateOffer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer = function createOffer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n        .then(() => {\n          return origCreateOffer.apply(this, arguments);\n        })\n        .finally(() => {\n          this.setParametersPromises = [];\n        });\n    }\n    return origCreateOffer.apply(this, arguments);\n  };\n}\n\nexport function shimCreateAnswer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateAnswer = window.RTCPeerConnection.prototype.createAnswer;\n  window.RTCPeerConnection.prototype.createAnswer = function createAnswer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n        .then(() => {\n          return origCreateAnswer.apply(this, arguments);\n        })\n        .finally(() => {\n          this.setParametersPromises = [];\n        });\n    }\n    return origCreateAnswer.apply(this, arguments);\n  };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nimport * as utils from '../utils';\n\nexport function shimLocalStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getLocalStreams =\n      function getLocalStreams() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n  }\n  if (!('addStream' in window.RTCPeerConnection.prototype)) {\n    const _addTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n      if (!this._localStreams.includes(stream)) {\n        this._localStreams.push(stream);\n      }\n      // Try to emulate Chrome's behaviour of adding in audio-video order.\n      // Safari orders by track id.\n      stream.getAudioTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n      stream.getVideoTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n    };\n\n    window.RTCPeerConnection.prototype.addTrack =\n      function addTrack(track, ...streams) {\n        if (streams) {\n          streams.forEach((stream) => {\n            if (!this._localStreams) {\n              this._localStreams = [stream];\n            } else if (!this._localStreams.includes(stream)) {\n              this._localStreams.push(stream);\n            }\n          });\n        }\n        return _addTrack.apply(this, arguments);\n      };\n  }\n  if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        const index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        const tracks = stream.getTracks();\n        this.getSenders().forEach(sender => {\n          if (tracks.includes(sender.track)) {\n            this.removeTrack(sender);\n          }\n        });\n      };\n  }\n}\n\nexport function shimRemoteStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getRemoteStreams =\n      function getRemoteStreams() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n  }\n  if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n      get() {\n        return this._onaddstream;\n      },\n      set(f) {\n        if (this._onaddstream) {\n          this.removeEventListener('addstream', this._onaddstream);\n          this.removeEventListener('track', this._onaddstreampoly);\n        }\n        this.addEventListener('addstream', this._onaddstream = f);\n        this.addEventListener('track', this._onaddstreampoly = (e) => {\n          e.streams.forEach(stream => {\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.includes(stream)) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            const event = new Event('addstream');\n            event.stream = stream;\n            this.dispatchEvent(event);\n          });\n        });\n      }\n    });\n    const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        const pc = this;\n        if (!this._onaddstreampoly) {\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            e.streams.forEach(stream => {\n              if (!pc._remoteStreams) {\n                pc._remoteStreams = [];\n              }\n              if (pc._remoteStreams.indexOf(stream) >= 0) {\n                return;\n              }\n              pc._remoteStreams.push(stream);\n              const event = new Event('addstream');\n              event.stream = stream;\n              pc.dispatchEvent(event);\n            });\n          });\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n  }\n}\n\nexport function shimCallbacksAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  const prototype = window.RTCPeerConnection.prototype;\n  const origCreateOffer = prototype.createOffer;\n  const origCreateAnswer = prototype.createAnswer;\n  const setLocalDescription = prototype.setLocalDescription;\n  const setRemoteDescription = prototype.setRemoteDescription;\n  const addIceCandidate = prototype.addIceCandidate;\n\n  prototype.createOffer =\n    function createOffer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  prototype.createAnswer =\n    function createAnswer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  let withCallback = function(description, successCallback, failureCallback) {\n    const promise = setLocalDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setLocalDescription = withCallback;\n\n  withCallback = function(description, successCallback, failureCallback) {\n    const promise = setRemoteDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setRemoteDescription = withCallback;\n\n  withCallback = function(candidate, successCallback, failureCallback) {\n    const promise = addIceCandidate.apply(this, [candidate]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.addIceCandidate = withCallback;\n}\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    // shim not needed in Safari 12.1\n    const mediaDevices = navigator.mediaDevices;\n    const _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\n    navigator.mediaDevices.getUserMedia = (constraints) => {\n      return _getUserMedia(shimConstraints(constraints));\n    };\n  }\n\n  if (!navigator.getUserMedia && navigator.mediaDevices &&\n    navigator.mediaDevices.getUserMedia) {\n    navigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\n      navigator.mediaDevices.getUserMedia(constraints)\n        .then(cb, errcb);\n    }.bind(navigator);\n  }\n}\n\nexport function shimConstraints(constraints) {\n  if (constraints && constraints.video !== undefined) {\n    return Object.assign({},\n      constraints,\n      {video: utils.compactObject(constraints.video)}\n    );\n  }\n\n  return constraints;\n}\n\nexport function shimRTCIceServerUrls(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n  const OrigPeerConnection = window.RTCPeerConnection;\n  window.RTCPeerConnection =\n    function RTCPeerConnection(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        const newIceServers = [];\n        for (let i = 0; i < pcConfig.iceServers.length; i++) {\n          let server = pcConfig.iceServers[i];\n          if (server.urls === undefined && server.url) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n  window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n  // wrap static methods. Currently just generateCertificate.\n  if ('generateCertificate' in OrigPeerConnection) {\n    Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n      get() {\n        return OrigPeerConnection.generateCertificate;\n      }\n    });\n  }\n}\n\nexport function shimTrackEventTransceiver(window) {\n  // Add event.transceiver member over deprecated event.receiver\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      'receiver' in window.RTCTrackEvent.prototype &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimCreateOfferLegacy(window) {\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer =\n    function createOffer(offerOptions) {\n      if (offerOptions) {\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveAudio =\n            !!offerOptions.offerToReceiveAudio;\n        }\n        const audioTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'audio');\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('sendonly');\n            } else {\n              audioTransceiver.direction = 'sendonly';\n            }\n          } else if (audioTransceiver.direction === 'recvonly') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('inactive');\n            } else {\n              audioTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          this.addTransceiver('audio', {direction: 'recvonly'});\n        }\n\n        if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveVideo =\n            !!offerOptions.offerToReceiveVideo;\n        }\n        const videoTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'video');\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('sendonly');\n            } else {\n              videoTransceiver.direction = 'sendonly';\n            }\n          } else if (videoTransceiver.direction === 'recvonly') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('inactive');\n            } else {\n              videoTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          this.addTransceiver('video', {direction: 'recvonly'});\n        }\n      }\n      return origCreateOffer.apply(this, arguments);\n    };\n}\n\nexport function shimAudioContext(window) {\n  if (typeof window !== 'object' || window.AudioContext) {\n    return;\n  }\n  window.AudioContext = window.webkitAudioContext;\n}\n\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport SDPUtils from 'sdp';\nimport * as utils from './utils';\n\nexport function shimRTCIceCandidate(window) {\n  // foundation is arbitrarily chosen as an indicator for full support for\n  // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n  if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'foundation' in\n      window.RTCIceCandidate.prototype)) {\n    return;\n  }\n\n  const NativeRTCIceCandidate = window.RTCIceCandidate;\n  window.RTCIceCandidate = function RTCIceCandidate(args) {\n    // Remove the a= which shouldn't be part of the candidate string.\n    if (typeof args === 'object' && args.candidate &&\n        args.candidate.indexOf('a=') === 0) {\n      args = JSON.parse(JSON.stringify(args));\n      args.candidate = args.candidate.substring(2);\n    }\n\n    if (args.candidate && args.candidate.length) {\n      // Augment the native candidate with the parsed fields.\n      const nativeCandidate = new NativeRTCIceCandidate(args);\n      const parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      for (const key in parsedCandidate) {\n        if (!(key in nativeCandidate)) {\n          Object.defineProperty(nativeCandidate, key,\n            {value: parsedCandidate[key]});\n        }\n      }\n\n      // Override serializer to not serialize the extra attributes.\n      nativeCandidate.toJSON = function toJSON() {\n        return {\n          candidate: nativeCandidate.candidate,\n          sdpMid: nativeCandidate.sdpMid,\n          sdpMLineIndex: nativeCandidate.sdpMLineIndex,\n          usernameFragment: nativeCandidate.usernameFragment,\n        };\n      };\n      return nativeCandidate;\n    }\n    return new NativeRTCIceCandidate(args);\n  };\n  window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', e => {\n    if (e.candidate) {\n      Object.defineProperty(e, 'candidate', {\n        value: new window.RTCIceCandidate(e.candidate),\n        writable: 'false'\n      });\n    }\n    return e;\n  });\n}\n\nexport function shimRTCIceCandidateRelayProtocol(window) {\n  if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'relayProtocol' in\n      window.RTCIceCandidate.prototype)) {\n    return;\n  }\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', e => {\n    if (e.candidate) {\n      const parsedCandidate = SDPUtils.parseCandidate(e.candidate.candidate);\n      if (parsedCandidate.type === 'relay') {\n        // This is a libwebrtc-specific mapping of local type preference\n        // to relayProtocol.\n        e.candidate.relayProtocol = {\n          0: 'tls',\n          1: 'tcp',\n          2: 'udp',\n        }[parsedCandidate.priority >> 24];\n      }\n    }\n    return e;\n  });\n}\n\nexport function shimMaxMessageSize(window, browserDetails) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  if (!('sctp' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\n      get() {\n        return typeof this._sctp === 'undefined' ? null : this._sctp;\n      }\n    });\n  }\n\n  const sctpInDescription = function(description) {\n    if (!description || !description.sdp) {\n      return false;\n    }\n    const sections = SDPUtils.splitSections(description.sdp);\n    sections.shift();\n    return sections.some(mediaSection => {\n      const mLine = SDPUtils.parseMLine(mediaSection);\n      return mLine && mLine.kind === 'application'\n          && mLine.protocol.indexOf('SCTP') !== -1;\n    });\n  };\n\n  const getRemoteFirefoxVersion = function(description) {\n    // TODO: Is there a better solution for detecting Firefox?\n    const match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\n    if (match === null || match.length < 2) {\n      return -1;\n    }\n    const version = parseInt(match[1], 10);\n    // Test for NaN (yes, this is ugly)\n    return version !== version ? -1 : version;\n  };\n\n  const getCanSendMaxMessageSize = function(remoteIsFirefox) {\n    // Every implementation we know can send at least 64 KiB.\n    // Note: Although Chrome is technically able to send up to 256 KiB, the\n    //       data does not reach the other peer reliably.\n    //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\n    let canSendMaxMessageSize = 65536;\n    if (browserDetails.browser === 'firefox') {\n      if (browserDetails.version < 57) {\n        if (remoteIsFirefox === -1) {\n          // FF < 57 will send in 16 KiB chunks using the deprecated PPID\n          // fragmentation.\n          canSendMaxMessageSize = 16384;\n        } else {\n          // However, other FF (and RAWRTC) can reassemble PPID-fragmented\n          // messages. Thus, supporting ~2 GiB when sending.\n          canSendMaxMessageSize = 2147483637;\n        }\n      } else if (browserDetails.version < 60) {\n        // Currently, all FF >= 57 will reset the remote maximum message size\n        // to the default value when a data channel is created at a later\n        // stage. :(\n        // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n        canSendMaxMessageSize =\n          browserDetails.version === 57 ? 65535 : 65536;\n      } else {\n        // FF >= 60 supports sending ~2 GiB\n        canSendMaxMessageSize = 2147483637;\n      }\n    }\n    return canSendMaxMessageSize;\n  };\n\n  const getMaxMessageSize = function(description, remoteIsFirefox) {\n    // Note: 65536 bytes is the default value from the SDP spec. Also,\n    //       every implementation we know supports receiving 65536 bytes.\n    let maxMessageSize = 65536;\n\n    // FF 57 has a slightly incorrect default remote max message size, so\n    // we need to adjust it here to avoid a failure when sending.\n    // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\n    if (browserDetails.browser === 'firefox'\n         && browserDetails.version === 57) {\n      maxMessageSize = 65535;\n    }\n\n    const match = SDPUtils.matchPrefix(description.sdp,\n      'a=max-message-size:');\n    if (match.length > 0) {\n      maxMessageSize = parseInt(match[0].substring(19), 10);\n    } else if (browserDetails.browser === 'firefox' &&\n                remoteIsFirefox !== -1) {\n      // If the maximum message size is not present in the remote SDP and\n      // both local and remote are Firefox, the remote peer can receive\n      // ~2 GiB.\n      maxMessageSize = 2147483637;\n    }\n    return maxMessageSize;\n  };\n\n  const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n    function setRemoteDescription() {\n      this._sctp = null;\n      // Chrome decided to not expose .sctp in plan-b mode.\n      // As usual, adapter.js has to do an 'ugly worakaround'\n      // to cover up the mess.\n      if (browserDetails.browser === 'chrome' && browserDetails.version >= 76) {\n        const {sdpSemantics} = this.getConfiguration();\n        if (sdpSemantics === 'plan-b') {\n          Object.defineProperty(this, 'sctp', {\n            get() {\n              return typeof this._sctp === 'undefined' ? null : this._sctp;\n            },\n            enumerable: true,\n            configurable: true,\n          });\n        }\n      }\n\n      if (sctpInDescription(arguments[0])) {\n        // Check if the remote is FF.\n        const isFirefox = getRemoteFirefoxVersion(arguments[0]);\n\n        // Get the maximum message size the local peer is capable of sending\n        const canSendMMS = getCanSendMaxMessageSize(isFirefox);\n\n        // Get the maximum message size of the remote peer.\n        const remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\n\n        // Determine final maximum message size\n        let maxMessageSize;\n        if (canSendMMS === 0 && remoteMMS === 0) {\n          maxMessageSize = Number.POSITIVE_INFINITY;\n        } else if (canSendMMS === 0 || remoteMMS === 0) {\n          maxMessageSize = Math.max(canSendMMS, remoteMMS);\n        } else {\n          maxMessageSize = Math.min(canSendMMS, remoteMMS);\n        }\n\n        // Create a dummy RTCSctpTransport object and the 'maxMessageSize'\n        // attribute.\n        const sctp = {};\n        Object.defineProperty(sctp, 'maxMessageSize', {\n          get() {\n            return maxMessageSize;\n          }\n        });\n        this._sctp = sctp;\n      }\n\n      return origSetRemoteDescription.apply(this, arguments);\n    };\n}\n\nexport function shimSendThrowTypeError(window) {\n  if (!(window.RTCPeerConnection &&\n      'createDataChannel' in window.RTCPeerConnection.prototype)) {\n    return;\n  }\n\n  // Note: Although Firefox >= 57 has a native implementation, the maximum\n  //       message size can be reset for all data channels at a later stage.\n  //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n\n  function wrapDcSend(dc, pc) {\n    const origDataChannelSend = dc.send;\n    dc.send = function send() {\n      const data = arguments[0];\n      const length = data.length || data.size || data.byteLength;\n      if (dc.readyState === 'open' &&\n          pc.sctp && length > pc.sctp.maxMessageSize) {\n        throw new TypeError('Message too large (can send a maximum of ' +\n          pc.sctp.maxMessageSize + ' bytes)');\n      }\n      return origDataChannelSend.apply(dc, arguments);\n    };\n  }\n  const origCreateDataChannel =\n    window.RTCPeerConnection.prototype.createDataChannel;\n  window.RTCPeerConnection.prototype.createDataChannel =\n    function createDataChannel() {\n      const dataChannel = origCreateDataChannel.apply(this, arguments);\n      wrapDcSend(dataChannel, this);\n      return dataChannel;\n    };\n  utils.wrapPeerConnectionEvent(window, 'datachannel', e => {\n    wrapDcSend(e.channel, e.target);\n    return e;\n  });\n}\n\n\n/* shims RTCConnectionState by pretending it is the same as iceConnectionState.\n * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12\n * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect\n * since DTLS failures would be hidden. See\n * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827\n * for the Firefox tracking bug.\n */\nexport function shimConnectionState(window) {\n  if (!window.RTCPeerConnection ||\n      'connectionState' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  Object.defineProperty(proto, 'connectionState', {\n    get() {\n      return {\n        completed: 'connected',\n        checking: 'connecting'\n      }[this.iceConnectionState] || this.iceConnectionState;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(proto, 'onconnectionstatechange', {\n    get() {\n      return this._onconnectionstatechange || null;\n    },\n    set(cb) {\n      if (this._onconnectionstatechange) {\n        this.removeEventListener('connectionstatechange',\n          this._onconnectionstatechange);\n        delete this._onconnectionstatechange;\n      }\n      if (cb) {\n        this.addEventListener('connectionstatechange',\n          this._onconnectionstatechange = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ['setLocalDescription', 'setRemoteDescription'].forEach((method) => {\n    const origMethod = proto[method];\n    proto[method] = function() {\n      if (!this._connectionstatechangepoly) {\n        this._connectionstatechangepoly = e => {\n          const pc = e.target;\n          if (pc._lastConnectionState !== pc.connectionState) {\n            pc._lastConnectionState = pc.connectionState;\n            const newEvent = new Event('connectionstatechange', e);\n            pc.dispatchEvent(newEvent);\n          }\n          return e;\n        };\n        this.addEventListener('iceconnectionstatechange',\n          this._connectionstatechangepoly);\n      }\n      return origMethod.apply(this, arguments);\n    };\n  });\n}\n\nexport function removeExtmapAllowMixed(window, browserDetails) {\n  /* remove a=extmap-allow-mixed for webrtc.org < M71 */\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  if (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {\n    return;\n  }\n  if (browserDetails.browser === 'safari' && browserDetails.version >= 605) {\n    return;\n  }\n  const nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n  function setRemoteDescription(desc) {\n    if (desc && desc.sdp && desc.sdp.indexOf('\\na=extmap-allow-mixed') !== -1) {\n      const sdp = desc.sdp.split('\\n').filter((line) => {\n        return line.trim() !== 'a=extmap-allow-mixed';\n      }).join('\\n');\n      // Safari enforces read-only-ness of RTCSessionDescription fields.\n      if (window.RTCSessionDescription &&\n          desc instanceof window.RTCSessionDescription) {\n        arguments[0] = new window.RTCSessionDescription({\n          type: desc.type,\n          sdp,\n        });\n      } else {\n        desc.sdp = sdp;\n      }\n    }\n    return nativeSRD.apply(this, arguments);\n  };\n}\n\nexport function shimAddIceCandidateNullOrEmpty(window, browserDetails) {\n  // Support for addIceCandidate(null or undefined)\n  // as well as addIceCandidate({candidate: \"\", ...})\n  // https://bugs.chromium.org/p/chromium/issues/detail?id=978582\n  // Note: must be called before other polyfills which change the signature.\n  if (!(window.RTCPeerConnection && window.RTCPeerConnection.prototype)) {\n    return;\n  }\n  const nativeAddIceCandidate =\n      window.RTCPeerConnection.prototype.addIceCandidate;\n  if (!nativeAddIceCandidate || nativeAddIceCandidate.length === 0) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions.\n      // Native support for ignoring exists for Chrome M77+.\n      // Safari ignores as well, exact version unknown but works in the same\n      // version that also ignores addIceCandidate(null).\n      if (((browserDetails.browser === 'chrome' && browserDetails.version < 78)\n           || (browserDetails.browser === 'firefox'\n               && browserDetails.version < 68)\n           || (browserDetails.browser === 'safari'))\n          && arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n}\n\n// Note: Make sure to call this ahead of APIs that modify\n// setLocalDescription.length\nexport function shimParameterlessSetLocalDescription(window, browserDetails) {\n  if (!(window.RTCPeerConnection && window.RTCPeerConnection.prototype)) {\n    return;\n  }\n  const nativeSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  if (!nativeSetLocalDescription || nativeSetLocalDescription.length === 0) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      let desc = arguments[0] || {};\n      if (typeof desc !== 'object' || (desc.type && desc.sdp)) {\n        return nativeSetLocalDescription.apply(this, arguments);\n      }\n      // The remaining steps should technically happen when SLD comes off the\n      // RTCPeerConnection's operations chain (not ahead of going on it), but\n      // this is too difficult to shim. Instead, this shim only covers the\n      // common case where the operations chain is empty. This is imperfect, but\n      // should cover many cases. Rationale: Even if we can't reduce the glare\n      // window to zero on imperfect implementations, there's value in tapping\n      // into the perfect negotiation pattern that several browsers support.\n      desc = {type: desc.type, sdp: desc.sdp};\n      if (!desc.type) {\n        switch (this.signalingState) {\n          case 'stable':\n          case 'have-local-offer':\n          case 'have-remote-pranswer':\n            desc.type = 'offer';\n            break;\n          default:\n            desc.type = 'answer';\n            break;\n        }\n      }\n      if (desc.sdp || (desc.type !== 'offer' && desc.type !== 'answer')) {\n        return nativeSetLocalDescription.apply(this, [desc]);\n      }\n      const func = desc.type === 'offer' ? this.createOffer : this.createAnswer;\n      return func.apply(this)\n        .then(d => nativeSetLocalDescription.apply(this, [d]));\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\nimport * as utils from './utils';\n\n// Browser shims.\nimport * as chromeShim from './chrome/chrome_shim';\nimport * as firefoxShim from './firefox/firefox_shim';\nimport * as safariShim from './safari/safari_shim';\nimport * as commonShim from './common_shim';\nimport * as sdp from 'sdp';\n\n// Shimming starts here.\nexport function adapterFactory({window} = {}, options = {\n  shimChrome: true,\n  shimFirefox: true,\n  shimSafari: true,\n}) {\n  // Utils.\n  const logging = utils.log;\n  const browserDetails = utils.detectBrowser(window);\n\n  const adapter = {\n    browserDetails,\n    commonShim,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings,\n    // Expose sdp as a convenience. For production apps include directly.\n    sdp,\n  };\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      if (browserDetails.version === null) {\n        logging('Chrome shim can not determine version, not shimming.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n\n      // Must be called before shimPeerConnection.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      chromeShim.shimGetUserMedia(window, browserDetails);\n      chromeShim.shimMediaStream(window, browserDetails);\n      chromeShim.shimPeerConnection(window, browserDetails);\n      chromeShim.shimOnTrack(window, browserDetails);\n      chromeShim.shimAddTrackRemoveTrack(window, browserDetails);\n      chromeShim.shimGetSendersWithDtmf(window, browserDetails);\n      chromeShim.shimGetStats(window, browserDetails);\n      chromeShim.shimSenderReceiverGetStats(window, browserDetails);\n      chromeShim.fixNegotiationNeeded(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimRTCIceCandidateRelayProtocol(window, browserDetails);\n      commonShim.shimConnectionState(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      commonShim.removeExtmapAllowMixed(window, browserDetails);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n\n      // Must be called before shimPeerConnection.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      firefoxShim.shimGetUserMedia(window, browserDetails);\n      firefoxShim.shimPeerConnection(window, browserDetails);\n      firefoxShim.shimOnTrack(window, browserDetails);\n      firefoxShim.shimRemoveStream(window, browserDetails);\n      firefoxShim.shimSenderGetStats(window, browserDetails);\n      firefoxShim.shimReceiverGetStats(window, browserDetails);\n      firefoxShim.shimRTCDataChannel(window, browserDetails);\n      firefoxShim.shimAddTransceiver(window, browserDetails);\n      firefoxShim.shimGetParameters(window, browserDetails);\n      firefoxShim.shimCreateOffer(window, browserDetails);\n      firefoxShim.shimCreateAnswer(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimConnectionState(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n\n      // Must be called before shimCallbackAPI.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      safariShim.shimRTCIceServerUrls(window, browserDetails);\n      safariShim.shimCreateOfferLegacy(window, browserDetails);\n      safariShim.shimCallbacksAPI(window, browserDetails);\n      safariShim.shimLocalStreamsAPI(window, browserDetails);\n      safariShim.shimRemoteStreamsAPI(window, browserDetails);\n      safariShim.shimTrackEventTransceiver(window, browserDetails);\n      safariShim.shimGetUserMedia(window, browserDetails);\n      safariShim.shimAudioContext(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimRTCIceCandidateRelayProtocol(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      commonShim.removeExtmapAllowMixed(window, browserDetails);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n\n'use strict';\n\nimport {adapterFactory} from './adapter_factory.js';\n\nconst adapter =\n  adapterFactory({window: typeof window === 'undefined' ? undefined : window});\nexport default adapter;\n","let decoder\ntry {\n\tdecoder = new TextDecoder()\n} catch(error) {}\nlet src\nlet srcEnd\nlet position = 0\nlet alreadySet\nconst EMPTY_ARRAY = []\nconst LEGACY_RECORD_INLINE_ID = 105\nconst RECORD_DEFINITIONS_ID = 0xdffe\nconst RECORD_INLINE_ID = 0xdfff // temporary first-come first-serve tag // proposed tag: 0x7265 // 're'\nconst BUNDLED_STRINGS_ID = 0xdff9\nconst PACKED_TABLE_TAG_ID = 51\nconst PACKED_REFERENCE_TAG_ID = 6\nconst STOP_CODE = {}\nlet strings = EMPTY_ARRAY\nlet stringPosition = 0\nlet currentDecoder = {}\nlet currentStructures\nlet srcString\nlet srcStringStart = 0\nlet srcStringEnd = 0\nlet bundledStrings\nlet referenceMap\nlet currentExtensions = []\nlet currentExtensionRanges = []\nlet packedValues\nlet dataView\nlet restoreMapsAsObject\nlet defaultOptions = {\n\tuseRecords: false,\n\tmapsAsObjects: true\n}\nlet sequentialMode = false\nlet inlineObjectReadThreshold = 2;\nvar BlockedFunction // we use search and replace to change the next call to BlockedFunction to avoid CSP issues for\n// no-eval build\ntry {\n\tnew Function('')\n} catch(error) {\n\t// if eval variants are not supported, do not create inline object readers ever\n\tinlineObjectReadThreshold = Infinity\n}\n\n\n\nexport class Decoder {\n\tconstructor(options) {\n\t\tif (options) {\n\t\t\tif ((options.keyMap || options._keyMap) && !options.useRecords) {\n\t\t\t\toptions.useRecords = false\n\t\t\t\toptions.mapsAsObjects = true\n\t\t\t}\n\t\t\tif (options.useRecords === false && options.mapsAsObjects === undefined)\n\t\t\t\toptions.mapsAsObjects = true\n\t\t\tif (options.getStructures)\n\t\t\t\toptions.getShared = options.getStructures\n\t\t\tif (options.getShared && !options.structures)\n\t\t\t\t(options.structures = []).uninitialized = true // this is what we use to denote an uninitialized structures\n\t\t\tif (options.keyMap) {\n\t\t\t\tthis.mapKey = new Map()\n\t\t\t\tfor (let [k,v] of Object.entries(options.keyMap)) this.mapKey.set(v,k)\n\t\t\t}\n\t\t}\n\t\tObject.assign(this, options)\n\t}\n\t/*\n\tdecodeKey(key) {\n\t\treturn this.keyMap\n\t\t\t? Object.keys(this.keyMap)[Object.values(this.keyMap).indexOf(key)] || key\n\t\t\t: key\n\t}\n\t*/\n\tdecodeKey(key) {\n\t\treturn this.keyMap ? this.mapKey.get(key) || key : key\n\t}\n\t\n\tencodeKey(key) {\n\t\treturn this.keyMap && this.keyMap.hasOwnProperty(key) ? this.keyMap[key] : key\n\t}\n\n\tencodeKeys(rec) {\n\t\tif (!this._keyMap) return rec\n\t\tlet map = new Map()\n\t\tfor (let [k,v] of Object.entries(rec)) map.set((this._keyMap.hasOwnProperty(k) ? this._keyMap[k] : k), v)\n\t\treturn map\n\t}\n\n\tdecodeKeys(map) {\n\t\tif (!this._keyMap || map.constructor.name != 'Map') return map\n\t\tif (!this._mapKey) {\n\t\t\tthis._mapKey = new Map()\n\t\t\tfor (let [k,v] of Object.entries(this._keyMap)) this._mapKey.set(v,k)\n\t\t}\n\t\tlet res = {}\n\t\t//map.forEach((v,k) => res[Object.keys(this._keyMap)[Object.values(this._keyMap).indexOf(k)] || k] = v)\n\t\tmap.forEach((v,k) => res[safeKey(this._mapKey.has(k) ? this._mapKey.get(k) : k)] =  v)\n\t\treturn res\n\t}\n\t\n\tmapDecode(source, end) {\n\t\n\t\tlet res = this.decode(source)\n\t\tif (this._keyMap) { \n\t\t\t//Experiemntal support for Optimised KeyMap  decoding \n\t\t\tswitch (res.constructor.name) {\n\t\t\t\tcase 'Array': return res.map(r => this.decodeKeys(r))\n\t\t\t\t//case 'Map': return this.decodeKeys(res)\n\t\t\t}\n\t\t}\n\t\treturn res\n\t}\n\n\tdecode(source, end) {\n\t\tif (src) {\n\t\t\t// re-entrant execution, save the state and restore it after we do this decode\n\t\t\treturn saveState(() => {\n\t\t\t\tclearSource()\n\t\t\t\treturn this ? this.decode(source, end) : Decoder.prototype.decode.call(defaultOptions, source, end)\n\t\t\t})\n\t\t}\n\t\tsrcEnd = end > -1 ? end : source.length\n\t\tposition = 0\n\t\tstringPosition = 0\n\t\tsrcStringEnd = 0\n\t\tsrcString = null\n\t\tstrings = EMPTY_ARRAY\n\t\tbundledStrings = null\n\t\tsrc = source\n\t\t// this provides cached access to the data view for a buffer if it is getting reused, which is a recommend\n\t\t// technique for getting data from a database where it can be copied into an existing buffer instead of creating\n\t\t// new ones\n\t\ttry {\n\t\t\tdataView = source.dataView || (source.dataView = new DataView(source.buffer, source.byteOffset, source.byteLength))\n\t\t} catch(error) {\n\t\t\t// if it doesn't have a buffer, maybe it is the wrong type of object\n\t\t\tsrc = null\n\t\t\tif (source instanceof Uint8Array)\n\t\t\t\tthrow error\n\t\t\tthrow new Error('Source must be a Uint8Array or Buffer but was a ' + ((source && typeof source == 'object') ? source.constructor.name : typeof source))\n\t\t}\n\t\tif (this instanceof Decoder) {\n\t\t\tcurrentDecoder = this\n\t\t\tpackedValues = this.sharedValues &&\n\t\t\t\t(this.pack ? new Array(this.maxPrivatePackedValues || 16).concat(this.sharedValues) :\n\t\t\t\tthis.sharedValues)\n\t\t\tif (this.structures) {\n\t\t\t\tcurrentStructures = this.structures\n\t\t\t\treturn checkedRead()\n\t\t\t} else if (!currentStructures || currentStructures.length > 0) {\n\t\t\t\tcurrentStructures = []\n\t\t\t}\n\t\t} else {\n\t\t\tcurrentDecoder = defaultOptions\n\t\t\tif (!currentStructures || currentStructures.length > 0)\n\t\t\t\tcurrentStructures = []\n\t\t\tpackedValues = null\n\t\t}\n\t\treturn checkedRead()\n\t}\n\tdecodeMultiple(source, forEach) {\n\t\tlet values, lastPosition = 0\n\t\ttry {\n\t\t\tlet size = source.length\n\t\t\tsequentialMode = true\n\t\t\tlet value = this ? this.decode(source, size) : defaultDecoder.decode(source, size)\n\t\t\tif (forEach) {\n\t\t\t\tif (forEach(value) === false) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\twhile(position < size) {\n\t\t\t\t\tlastPosition = position\n\t\t\t\t\tif (forEach(checkedRead()) === false) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvalues = [ value ]\n\t\t\t\twhile(position < size) {\n\t\t\t\t\tlastPosition = position\n\t\t\t\t\tvalues.push(checkedRead())\n\t\t\t\t}\n\t\t\t\treturn values\n\t\t\t}\n\t\t} catch(error) {\n\t\t\terror.lastPosition = lastPosition\n\t\t\terror.values = values\n\t\t\tthrow error\n\t\t} finally {\n\t\t\tsequentialMode = false\n\t\t\tclearSource()\n\t\t}\n\t}\n}\nexport function getPosition() {\n\treturn position\n}\nexport function checkedRead() {\n\ttry {\n\t\tlet result = read()\n\t\tif (bundledStrings) {\n\t\t\tif (position >= bundledStrings.postBundlePosition) {\n\t\t\t\tlet error = new Error('Unexpected bundle position');\n\t\t\t\terror.incomplete = true;\n\t\t\t\tthrow error\n\t\t\t}\n\t\t\t// bundled strings to skip past\n\t\t\tposition = bundledStrings.postBundlePosition;\n\t\t\tbundledStrings = null;\n\t\t}\n\n\t\tif (position == srcEnd) {\n\t\t\t// finished reading this source, cleanup references\n\t\t\tcurrentStructures = null\n\t\t\tsrc = null\n\t\t\tif (referenceMap)\n\t\t\t\treferenceMap = null\n\t\t} else if (position > srcEnd) {\n\t\t\t// over read\n\t\t\tlet error = new Error('Unexpected end of CBOR data')\n\t\t\terror.incomplete = true\n\t\t\tthrow error\n\t\t} else if (!sequentialMode) {\n\t\t\tthrow new Error('Data read, but end of buffer not reached')\n\t\t}\n\t\t// else more to read, but we are reading sequentially, so don't clear source yet\n\t\treturn result\n\t} catch(error) {\n\t\tclearSource()\n\t\tif (error instanceof RangeError || error.message.startsWith('Unexpected end of buffer')) {\n\t\t\terror.incomplete = true\n\t\t}\n\t\tthrow error\n\t}\n}\n\nexport function read() {\n\tlet token = src[position++]\n\tlet majorType = token >> 5\n\ttoken = token & 0x1f\n\tif (token > 0x17) {\n\t\tswitch (token) {\n\t\t\tcase 0x18:\n\t\t\t\ttoken = src[position++]\n\t\t\t\tbreak\n\t\t\tcase 0x19:\n\t\t\t\tif (majorType == 7) {\n\t\t\t\t\treturn getFloat16()\n\t\t\t\t}\n\t\t\t\ttoken = dataView.getUint16(position)\n\t\t\t\tposition += 2\n\t\t\t\tbreak\n\t\t\tcase 0x1a:\n\t\t\t\tif (majorType == 7) {\n\t\t\t\t\tlet value = dataView.getFloat32(position)\n\t\t\t\t\tif (currentDecoder.useFloat32 > 2) {\n\t\t\t\t\t\t// this does rounding of numbers that were encoded in 32-bit float to nearest significant decimal digit that could be preserved\n\t\t\t\t\t\tlet multiplier = mult10[((src[position] & 0x7f) << 1) | (src[position + 1] >> 7)]\n\t\t\t\t\t\tposition += 4\n\t\t\t\t\t\treturn ((multiplier * value + (value > 0 ? 0.5 : -0.5)) >> 0) / multiplier\n\t\t\t\t\t}\n\t\t\t\t\tposition += 4\n\t\t\t\t\treturn value\n\t\t\t\t}\n\t\t\t\ttoken = dataView.getUint32(position)\n\t\t\t\tposition += 4\n\t\t\t\tbreak\n\t\t\tcase 0x1b:\n\t\t\t\tif (majorType == 7) {\n\t\t\t\t\tlet value = dataView.getFloat64(position)\n\t\t\t\t\tposition += 8\n\t\t\t\t\treturn value\n\t\t\t\t}\n\t\t\t\tif (majorType > 1) {\n\t\t\t\t\tif (dataView.getUint32(position) > 0)\n\t\t\t\t\t\tthrow new Error('JavaScript does not support arrays, maps, or strings with length over 4294967295')\n\t\t\t\t\ttoken = dataView.getUint32(position + 4)\n\t\t\t\t} else if (currentDecoder.int64AsNumber) {\n\t\t\t\t\ttoken = dataView.getUint32(position) * 0x100000000\n\t\t\t\t\ttoken += dataView.getUint32(position + 4)\n\t\t\t\t} else\n\t\t\t\t\ttoken = dataView.getBigUint64(position)\n\t\t\t\tposition += 8\n\t\t\t\tbreak\n\t\t\tcase 0x1f: \n\t\t\t\t// indefinite length\n\t\t\t\tswitch(majorType) {\n\t\t\t\t\tcase 2: // byte string\n\t\t\t\t\tcase 3: // text string\n\t\t\t\t\t\tthrow new Error('Indefinite length not supported for byte or text strings')\n\t\t\t\t\tcase 4: // array\n\t\t\t\t\t\tlet array = []\n\t\t\t\t\t\tlet value, i = 0\n\t\t\t\t\t\twhile ((value = read()) != STOP_CODE) {\n\t\t\t\t\t\t\tarray[i++] = value\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn majorType == 4 ? array : majorType == 3 ? array.join('') : Buffer.concat(array)\n\t\t\t\t\tcase 5: // map\n\t\t\t\t\t\tlet key\n\t\t\t\t\t\tif (currentDecoder.mapsAsObjects) {\n\t\t\t\t\t\t\tlet object = {}\n\t\t\t\t\t\t\tif (currentDecoder.keyMap) while((key = read()) != STOP_CODE) object[safeKey(currentDecoder.decodeKey(key))] = read()\n\t\t\t\t\t\t\telse while ((key = read()) != STOP_CODE) object[safeKey(key)] = read()\n\t\t\t\t\t\t\treturn object\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (restoreMapsAsObject) {\n\t\t\t\t\t\t\t\tcurrentDecoder.mapsAsObjects = true\n\t\t\t\t\t\t\t\trestoreMapsAsObject = false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlet map = new Map()\n\t\t\t\t\t\t\tif (currentDecoder.keyMap) while((key = read()) != STOP_CODE) map.set(currentDecoder.decodeKey(key), read())\n\t\t\t\t\t\t\telse while ((key = read()) != STOP_CODE) map.set(key, read())\n\t\t\t\t\t\t\treturn map\n\t\t\t\t\t\t}\n\t\t\t\t\tcase 7:\n\t\t\t\t\t\treturn STOP_CODE\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error('Invalid major type for indefinite length ' + majorType)\n\t\t\t\t}\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Unknown token ' + token)\n\t\t}\n\t}\n\tswitch (majorType) {\n\t\tcase 0: // positive int\n\t\t\treturn token\n\t\tcase 1: // negative int\n\t\t\treturn ~token\n\t\tcase 2: // buffer\n\t\t\treturn readBin(token)\n\t\tcase 3: // string\n\t\t\tif (srcStringEnd >= position) {\n\t\t\t\treturn srcString.slice(position - srcStringStart, (position += token) - srcStringStart)\n\t\t\t}\n\t\t\tif (srcStringEnd == 0 && srcEnd < 140 && token < 32) {\n\t\t\t\t// for small blocks, avoiding the overhead of the extract call is helpful\n\t\t\t\tlet string = token < 16 ? shortStringInJS(token) : longStringInJS(token)\n\t\t\t\tif (string != null)\n\t\t\t\t\treturn string\n\t\t\t}\n\t\t\treturn readFixedString(token)\n\t\tcase 4: // array\n\t\t\tlet array = new Array(token)\n\t\t  //if (currentDecoder.keyMap) for (let i = 0; i < token; i++) array[i] = currentDecoder.decodeKey(read())\t\n\t\t\t//else \n\t\t\tfor (let i = 0; i < token; i++) array[i] = read()\n\t\t\treturn array\n\t\tcase 5: // map\n\t\t\tif (currentDecoder.mapsAsObjects) {\n\t\t\t\tlet object = {}\n\t\t\t\tif (currentDecoder.keyMap) for (let i = 0; i < token; i++) object[safeKey(currentDecoder.decodeKey(read()))] = read()\n\t\t\t\telse for (let i = 0; i < token; i++) object[safeKey(read())] = read()\n\t\t\t\treturn object\n\t\t\t} else {\n\t\t\t\tif (restoreMapsAsObject) {\n\t\t\t\t\tcurrentDecoder.mapsAsObjects = true\n\t\t\t\t\trestoreMapsAsObject = false\n\t\t\t\t}\n\t\t\t\tlet map = new Map()\n\t\t\t\tif (currentDecoder.keyMap) for (let i = 0; i < token; i++) map.set(currentDecoder.decodeKey(read()),read())\n\t\t\t\telse for (let i = 0; i < token; i++) map.set(read(), read())\n\t\t\t\treturn map\n\t\t\t}\n\t\tcase 6: // extension\n\t\t\tif (token >= BUNDLED_STRINGS_ID) {\n\t\t\t\tlet structure = currentStructures[token & 0x1fff] // check record structures first\n\t\t\t\t// At some point we may provide an option for dynamic tag assignment with a range like token >= 8 && (token < 16 || (token > 0x80 && token < 0xc0) || (token > 0x130 && token < 0x4000))\n\t\t\t\tif (structure) {\n\t\t\t\t\tif (!structure.read) structure.read = createStructureReader(structure)\n\t\t\t\t\treturn structure.read()\n\t\t\t\t}\n\t\t\t\tif (token < 0x10000) {\n\t\t\t\t\tif (token == RECORD_INLINE_ID) { // we do a special check for this so that we can keep the\n\t\t\t\t\t\t// currentExtensions as densely stored array (v8 stores arrays densely under about 3000 elements)\n\t\t\t\t\t\tlet length = readJustLength()\n\t\t\t\t\t\tlet id = read()\n\t\t\t\t\t\tlet structure = read()\n\t\t\t\t\t\trecordDefinition(id, structure)\n\t\t\t\t\t\tlet object = {}\n\t\t\t\t\t\tif (currentDecoder.keyMap) for (let i = 2; i < length; i++) {\n\t\t\t\t\t\t\tlet key = currentDecoder.decodeKey(structure[i - 2])\n\t\t\t\t\t\t\tobject[safeKey(key)] = read()\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse for (let i = 2; i < length; i++) {\n\t\t\t\t\t\t\tlet key = structure[i - 2]\n\t\t\t\t\t\t\tobject[safeKey(key)] = read()\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn object\n\t\t\t\t\t}\n\t\t\t\t\telse if (token == RECORD_DEFINITIONS_ID) {\n\t\t\t\t\t\tlet length = readJustLength()\n\t\t\t\t\t\tlet id = read()\n\t\t\t\t\t\tfor (let i = 2; i < length; i++) {\n\t\t\t\t\t\t\trecordDefinition(id++, read())\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn read()\n\t\t\t\t\t} else if (token == BUNDLED_STRINGS_ID) {\n\t\t\t\t\t\treturn readBundleExt()\n\t\t\t\t\t}\n\t\t\t\t\tif (currentDecoder.getShared) {\n\t\t\t\t\t\tloadShared()\n\t\t\t\t\t\tstructure = currentStructures[token & 0x1fff]\n\t\t\t\t\t\tif (structure) {\n\t\t\t\t\t\t\tif (!structure.read)\n\t\t\t\t\t\t\t\tstructure.read = createStructureReader(structure)\n\t\t\t\t\t\t\treturn structure.read()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet extension = currentExtensions[token]\n\t\t\tif (extension) {\n\t\t\t\tif (extension.handlesRead)\n\t\t\t\t\treturn extension(read)\n\t\t\t\telse\n\t\t\t\t\treturn extension(read())\n\t\t\t} else {\n\t\t\t\tlet input = read()\n\t\t\t\tfor (let i = 0; i < currentExtensionRanges.length; i++) {\n\t\t\t\t\tlet value = currentExtensionRanges[i](token, input)\n\t\t\t\t\tif (value !== undefined)\n\t\t\t\t\t\treturn value\n\t\t\t\t}\n\t\t\t\treturn new Tag(input, token)\n\t\t\t}\n\t\tcase 7: // fixed value\n\t\t\tswitch (token) {\n\t\t\t\tcase 0x14: return false\n\t\t\t\tcase 0x15: return true\n\t\t\t\tcase 0x16: return null\n\t\t\t\tcase 0x17: return; // undefined\n\t\t\t\tcase 0x1f:\n\t\t\t\tdefault:\n\t\t\t\t\tlet packedValue = (packedValues || getPackedValues())[token]\n\t\t\t\t\tif (packedValue !== undefined)\n\t\t\t\t\t\treturn packedValue\n\t\t\t\t\tthrow new Error('Unknown token ' + token)\n\t\t\t}\n\t\tdefault: // negative int\n\t\t\tif (isNaN(token)) {\n\t\t\t\tlet error = new Error('Unexpected end of CBOR data')\n\t\t\t\terror.incomplete = true\n\t\t\t\tthrow error\n\t\t\t}\n\t\t\tthrow new Error('Unknown CBOR token ' + token)\n\t}\n}\nconst validName = /^[a-zA-Z_$][a-zA-Z\\d_$]*$/\nfunction createStructureReader(structure) {\n\tfunction readObject() {\n\t\t// get the array size from the header\n\t\tlet length = src[position++]\n\t\t//let majorType = token >> 5\n\t\tlength = length & 0x1f\n\t\tif (length > 0x17) {\n\t\t\tswitch (length) {\n\t\t\t\tcase 0x18:\n\t\t\t\t\tlength = src[position++]\n\t\t\t\t\tbreak\n\t\t\t\tcase 0x19:\n\t\t\t\t\tlength = dataView.getUint16(position)\n\t\t\t\t\tposition += 2\n\t\t\t\t\tbreak\n\t\t\t\tcase 0x1a:\n\t\t\t\t\tlength = dataView.getUint32(position)\n\t\t\t\t\tposition += 4\n\t\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error('Expected array header, but got ' + src[position - 1])\n\t\t\t}\n\t\t}\n\t\t// This initial function is quick to instantiate, but runs slower. After several iterations pay the cost to build the faster function\n\t\tlet compiledReader = this.compiledReader // first look to see if we have the fast compiled function\n\t\twhile(compiledReader) {\n\t\t\t// we have a fast compiled object literal reader\n\t\t\tif (compiledReader.propertyCount === length)\n\t\t\t\treturn compiledReader(read) // with the right length, so we use it\n\t\t\tcompiledReader = compiledReader.next // see if there is another reader with the right length\n\t\t}\n\t\tif (this.slowReads++ >= inlineObjectReadThreshold) { // create a fast compiled reader\n\t\t\tlet array = this.length == length ? this : this.slice(0, length)\n\t\t\tcompiledReader = currentDecoder.keyMap \n\t\t\t? new Function('r', 'return {' + array.map(k => currentDecoder.decodeKey(k)).map(k => validName.test(k) ? safeKey(k) + ':r()' : ('[' + JSON.stringify(k) + ']:r()')).join(',') + '}')\n\t\t\t: new Function('r', 'return {' + array.map(key => validName.test(key) ? safeKey(key) + ':r()' : ('[' + JSON.stringify(key) + ']:r()')).join(',') + '}')\n\t\t\tif (this.compiledReader)\n\t\t\t\tcompiledReader.next = this.compiledReader // if there is an existing one, we store multiple readers as a linked list because it is usually pretty rare to have multiple readers (of different length) for the same structure\n\t\t\tcompiledReader.propertyCount = length\n\t\t\tthis.compiledReader = compiledReader\n\t\t\treturn compiledReader(read)\n\t\t}\n\t\tlet object = {}\n\t\tif (currentDecoder.keyMap) for (let i = 0; i < length; i++) object[safeKey(currentDecoder.decodeKey(this[i]))] = read()\n\t\telse for (let i = 0; i < length; i++) {\n\t\t\tobject[safeKey(this[i])] = read();\n\t\t}\n\t\treturn object\n\t}\n\tstructure.slowReads = 0\n\treturn readObject\n}\n\nfunction safeKey(key) {\n\treturn key === '__proto__' ? '__proto_' : key\n}\n\nlet readFixedString = readStringJS\nlet readString8 = readStringJS\nlet readString16 = readStringJS\nlet readString32 = readStringJS\n\nexport let isNativeAccelerationEnabled = false\nexport function setExtractor(extractStrings) {\n\tisNativeAccelerationEnabled = true\n\treadFixedString = readString(1)\n\treadString8 = readString(2)\n\treadString16 = readString(3)\n\treadString32 = readString(5)\n\tfunction readString(headerLength) {\n\t\treturn function readString(length) {\n\t\t\tlet string = strings[stringPosition++]\n\t\t\tif (string == null) {\n\t\t\t\tif (bundledStrings)\n\t\t\t\t\treturn readStringJS(length)\n\t\t\t\tlet extraction = extractStrings(position, srcEnd, length, src)\n\t\t\t\tif (typeof extraction == 'string') {\n\t\t\t\t\tstring = extraction\n\t\t\t\t\tstrings = EMPTY_ARRAY\n\t\t\t\t} else {\n\t\t\t\t\tstrings = extraction\n\t\t\t\t\tstringPosition = 1\n\t\t\t\t\tsrcStringEnd = 1 // even if a utf-8 string was decoded, must indicate we are in the midst of extracted strings and can't skip strings\n\t\t\t\t\tstring = strings[0]\n\t\t\t\t\tif (string === undefined)\n\t\t\t\t\t\tthrow new Error('Unexpected end of buffer')\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet srcStringLength = string.length\n\t\t\tif (srcStringLength <= length) {\n\t\t\t\tposition += length\n\t\t\t\treturn string\n\t\t\t}\n\t\t\tsrcString = string\n\t\t\tsrcStringStart = position\n\t\t\tsrcStringEnd = position + srcStringLength\n\t\t\tposition += length\n\t\t\treturn string.slice(0, length) // we know we just want the beginning\n\t\t}\n\t}\n}\nfunction readStringJS(length) {\n\tlet result\n\tif (length < 16) {\n\t\tif (result = shortStringInJS(length))\n\t\t\treturn result\n\t}\n\tif (length > 64 && decoder)\n\t\treturn decoder.decode(src.subarray(position, position += length))\n\tconst end = position + length\n\tconst units = []\n\tresult = ''\n\twhile (position < end) {\n\t\tconst byte1 = src[position++]\n\t\tif ((byte1 & 0x80) === 0) {\n\t\t\t// 1 byte\n\t\t\tunits.push(byte1)\n\t\t} else if ((byte1 & 0xe0) === 0xc0) {\n\t\t\t// 2 bytes\n\t\t\tconst byte2 = src[position++] & 0x3f\n\t\t\tunits.push(((byte1 & 0x1f) << 6) | byte2)\n\t\t} else if ((byte1 & 0xf0) === 0xe0) {\n\t\t\t// 3 bytes\n\t\t\tconst byte2 = src[position++] & 0x3f\n\t\t\tconst byte3 = src[position++] & 0x3f\n\t\t\tunits.push(((byte1 & 0x1f) << 12) | (byte2 << 6) | byte3)\n\t\t} else if ((byte1 & 0xf8) === 0xf0) {\n\t\t\t// 4 bytes\n\t\t\tconst byte2 = src[position++] & 0x3f\n\t\t\tconst byte3 = src[position++] & 0x3f\n\t\t\tconst byte4 = src[position++] & 0x3f\n\t\t\tlet unit = ((byte1 & 0x07) << 0x12) | (byte2 << 0x0c) | (byte3 << 0x06) | byte4\n\t\t\tif (unit > 0xffff) {\n\t\t\t\tunit -= 0x10000\n\t\t\t\tunits.push(((unit >>> 10) & 0x3ff) | 0xd800)\n\t\t\t\tunit = 0xdc00 | (unit & 0x3ff)\n\t\t\t}\n\t\t\tunits.push(unit)\n\t\t} else {\n\t\t\tunits.push(byte1)\n\t\t}\n\n\t\tif (units.length >= 0x1000) {\n\t\t\tresult += fromCharCode.apply(String, units)\n\t\t\tunits.length = 0\n\t\t}\n\t}\n\n\tif (units.length > 0) {\n\t\tresult += fromCharCode.apply(String, units)\n\t}\n\n\treturn result\n}\nlet fromCharCode = String.fromCharCode\nfunction longStringInJS(length) {\n\tlet start = position\n\tlet bytes = new Array(length)\n\tfor (let i = 0; i < length; i++) {\n\t\tconst byte = src[position++];\n\t\tif ((byte & 0x80) > 0) {\n\t\t\tposition = start\n    \t\t\treturn\n    \t\t}\n    \t\tbytes[i] = byte\n    \t}\n    \treturn fromCharCode.apply(String, bytes)\n}\nfunction shortStringInJS(length) {\n\tif (length < 4) {\n\t\tif (length < 2) {\n\t\t\tif (length === 0)\n\t\t\t\treturn ''\n\t\t\telse {\n\t\t\t\tlet a = src[position++]\n\t\t\t\tif ((a & 0x80) > 1) {\n\t\t\t\t\tposition -= 1\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\treturn fromCharCode(a)\n\t\t\t}\n\t\t} else {\n\t\t\tlet a = src[position++]\n\t\t\tlet b = src[position++]\n\t\t\tif ((a & 0x80) > 0 || (b & 0x80) > 0) {\n\t\t\t\tposition -= 2\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (length < 3)\n\t\t\t\treturn fromCharCode(a, b)\n\t\t\tlet c = src[position++]\n\t\t\tif ((c & 0x80) > 0) {\n\t\t\t\tposition -= 3\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn fromCharCode(a, b, c)\n\t\t}\n\t} else {\n\t\tlet a = src[position++]\n\t\tlet b = src[position++]\n\t\tlet c = src[position++]\n\t\tlet d = src[position++]\n\t\tif ((a & 0x80) > 0 || (b & 0x80) > 0 || (c & 0x80) > 0 || (d & 0x80) > 0) {\n\t\t\tposition -= 4\n\t\t\treturn\n\t\t}\n\t\tif (length < 6) {\n\t\t\tif (length === 4)\n\t\t\t\treturn fromCharCode(a, b, c, d)\n\t\t\telse {\n\t\t\t\tlet e = src[position++]\n\t\t\t\tif ((e & 0x80) > 0) {\n\t\t\t\t\tposition -= 5\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\treturn fromCharCode(a, b, c, d, e)\n\t\t\t}\n\t\t} else if (length < 8) {\n\t\t\tlet e = src[position++]\n\t\t\tlet f = src[position++]\n\t\t\tif ((e & 0x80) > 0 || (f & 0x80) > 0) {\n\t\t\t\tposition -= 6\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (length < 7)\n\t\t\t\treturn fromCharCode(a, b, c, d, e, f)\n\t\t\tlet g = src[position++]\n\t\t\tif ((g & 0x80) > 0) {\n\t\t\t\tposition -= 7\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn fromCharCode(a, b, c, d, e, f, g)\n\t\t} else {\n\t\t\tlet e = src[position++]\n\t\t\tlet f = src[position++]\n\t\t\tlet g = src[position++]\n\t\t\tlet h = src[position++]\n\t\t\tif ((e & 0x80) > 0 || (f & 0x80) > 0 || (g & 0x80) > 0 || (h & 0x80) > 0) {\n\t\t\t\tposition -= 8\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (length < 10) {\n\t\t\t\tif (length === 8)\n\t\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h)\n\t\t\t\telse {\n\t\t\t\t\tlet i = src[position++]\n\t\t\t\t\tif ((i & 0x80) > 0) {\n\t\t\t\t\t\tposition -= 9\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h, i)\n\t\t\t\t}\n\t\t\t} else if (length < 12) {\n\t\t\t\tlet i = src[position++]\n\t\t\t\tlet j = src[position++]\n\t\t\t\tif ((i & 0x80) > 0 || (j & 0x80) > 0) {\n\t\t\t\t\tposition -= 10\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (length < 11)\n\t\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h, i, j)\n\t\t\t\tlet k = src[position++]\n\t\t\t\tif ((k & 0x80) > 0) {\n\t\t\t\t\tposition -= 11\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h, i, j, k)\n\t\t\t} else {\n\t\t\t\tlet i = src[position++]\n\t\t\t\tlet j = src[position++]\n\t\t\t\tlet k = src[position++]\n\t\t\t\tlet l = src[position++]\n\t\t\t\tif ((i & 0x80) > 0 || (j & 0x80) > 0 || (k & 0x80) > 0 || (l & 0x80) > 0) {\n\t\t\t\t\tposition -= 12\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (length < 14) {\n\t\t\t\t\tif (length === 12)\n\t\t\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h, i, j, k, l)\n\t\t\t\t\telse {\n\t\t\t\t\t\tlet m = src[position++]\n\t\t\t\t\t\tif ((m & 0x80) > 0) {\n\t\t\t\t\t\t\tposition -= 13\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h, i, j, k, l, m)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet m = src[position++]\n\t\t\t\t\tlet n = src[position++]\n\t\t\t\t\tif ((m & 0x80) > 0 || (n & 0x80) > 0) {\n\t\t\t\t\t\tposition -= 14\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tif (length < 15)\n\t\t\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h, i, j, k, l, m, n)\n\t\t\t\t\tlet o = src[position++]\n\t\t\t\t\tif ((o & 0x80) > 0) {\n\t\t\t\t\t\tposition -= 15\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h, i, j, k, l, m, n, o)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction readBin(length) {\n\treturn currentDecoder.copyBuffers ?\n\t\t// specifically use the copying slice (not the node one)\n\t\tUint8Array.prototype.slice.call(src, position, position += length) :\n\t\tsrc.subarray(position, position += length)\n}\nfunction readExt(length) {\n\tlet type = src[position++]\n\tif (currentExtensions[type]) {\n\t\treturn currentExtensions[type](src.subarray(position, position += length))\n\t}\n\telse\n\t\tthrow new Error('Unknown extension type ' + type)\n}\nlet f32Array = new Float32Array(1)\nlet u8Array = new Uint8Array(f32Array.buffer, 0, 4)\nfunction getFloat16() {\n\tlet byte0 = src[position++]\n\tlet byte1 = src[position++]\n\tlet exponent = (byte0 & 0x7f) >> 2;\n\tif (exponent === 0x1f) { // specials\n\t\tif (byte1 || (byte0 & 3))\n\t\t\treturn NaN;\n\t\treturn (byte0 & 0x80) ? -Infinity : Infinity;\n\t}\n\tif (exponent === 0) { // sub-normals\n\t\t// significand with 10 fractional bits and divided by 2^14\n\t\tlet abs = (((byte0 & 3) << 8) | byte1) / (1 << 24)\n\t\treturn (byte0 & 0x80) ? -abs : abs\n\t}\n\n\tu8Array[3] = (byte0 & 0x80) | // sign bit\n\t\t((exponent >> 1) + 56) // 4 of 5 of the exponent bits, re-offset-ed\n\tu8Array[2] = ((byte0 & 7) << 5) | // last exponent bit and first two mantissa bits\n\t\t(byte1 >> 3) // next 5 bits of mantissa\n\tu8Array[1] = byte1 << 5; // last three bits of mantissa\n\tu8Array[0] = 0;\n\treturn f32Array[0];\n}\n\nlet keyCache = new Array(4096)\nfunction readKey() {\n\tlet length = src[position++]\n\tif (length >= 0x60 && length < 0x78) {\n\t\t// fixstr, potentially use key cache\n\t\tlength = length - 0x60\n\t\tif (srcStringEnd >= position) // if it has been extracted, must use it (and faster anyway)\n\t\t\treturn srcString.slice(position - srcStringStart, (position += length) - srcStringStart)\n\t\telse if (!(srcStringEnd == 0 && srcEnd < 180))\n\t\t\treturn readFixedString(length)\n\t} else { // not cacheable, go back and do a standard read\n\t\tposition--\n\t\treturn read()\n\t}\n\tlet key = ((length << 5) ^ (length > 1 ? dataView.getUint16(position) : length > 0 ? src[position] : 0)) & 0xfff\n\tlet entry = keyCache[key]\n\tlet checkPosition = position\n\tlet end = position + length - 3\n\tlet chunk\n\tlet i = 0\n\tif (entry && entry.bytes == length) {\n\t\twhile (checkPosition < end) {\n\t\t\tchunk = dataView.getUint32(checkPosition)\n\t\t\tif (chunk != entry[i++]) {\n\t\t\t\tcheckPosition = 0x70000000\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcheckPosition += 4\n\t\t}\n\t\tend += 3\n\t\twhile (checkPosition < end) {\n\t\t\tchunk = src[checkPosition++]\n\t\t\tif (chunk != entry[i++]) {\n\t\t\t\tcheckPosition = 0x70000000\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tif (checkPosition === end) {\n\t\t\tposition = checkPosition\n\t\t\treturn entry.string\n\t\t}\n\t\tend -= 3\n\t\tcheckPosition = position\n\t}\n\tentry = []\n\tkeyCache[key] = entry\n\tentry.bytes = length\n\twhile (checkPosition < end) {\n\t\tchunk = dataView.getUint32(checkPosition)\n\t\tentry.push(chunk)\n\t\tcheckPosition += 4\n\t}\n\tend += 3\n\twhile (checkPosition < end) {\n\t\tchunk = src[checkPosition++]\n\t\tentry.push(chunk)\n\t}\n\t// for small blocks, avoiding the overhead of the extract call is helpful\n\tlet string = length < 16 ? shortStringInJS(length) : longStringInJS(length)\n\tif (string != null)\n\t\treturn entry.string = string\n\treturn entry.string = readFixedString(length)\n}\n\nexport class Tag {\n\tconstructor(value, tag) {\n\t\tthis.value = value\n\t\tthis.tag = tag\n\t}\n}\n\ncurrentExtensions[0] = (dateString) => {\n\t// string date extension\n\treturn new Date(dateString)\n}\n\ncurrentExtensions[1] = (epochSec) => {\n\t// numeric date extension\n\treturn new Date(Math.round(epochSec * 1000))\n}\n\ncurrentExtensions[2] = (buffer) => {\n\t// bigint extension\n\tlet value = BigInt(0)\n\tfor (let i = 0, l = buffer.byteLength; i < l; i++) {\n\t\tvalue = BigInt(buffer[i]) + value << BigInt(8)\n\t}\n\treturn value\n}\n\ncurrentExtensions[3] = (buffer) => {\n\t// negative bigint extension\n\treturn BigInt(-1) - currentExtensions[2](buffer)\n}\ncurrentExtensions[4] = (fraction) => {\n\t// best to reparse to maintain accuracy\n\treturn +(fraction[1] + 'e' + fraction[0])\n}\n\ncurrentExtensions[5] = (fraction) => {\n\t// probably not sufficiently accurate\n\treturn fraction[1] * Math.exp(fraction[0] * Math.log(2))\n}\n\n// the registration of the record definition extension\nconst recordDefinition = (id, structure) => {\n\tid = id - 0xe000\n\tlet existingStructure = currentStructures[id]\n\tif (existingStructure && existingStructure.isShared) {\n\t\t(currentStructures.restoreStructures || (currentStructures.restoreStructures = []))[id] = existingStructure\n\t}\n\tcurrentStructures[id] = structure\n\n\tstructure.read = createStructureReader(structure)\n}\ncurrentExtensions[LEGACY_RECORD_INLINE_ID] = (data) => {\n\tlet length = data.length\n\tlet structure = data[1]\n\trecordDefinition(data[0], structure)\n\tlet object = {}\n\tfor (let i = 2; i < length; i++) {\n\t\tlet key = structure[i - 2]\n\t\tobject[safeKey(key)] = data[i]\n\t}\n\treturn object\n}\ncurrentExtensions[14] = (value) => {\n\tif (bundledStrings)\n\t\treturn bundledStrings[0].slice(bundledStrings.position0, bundledStrings.position0 += value)\n\treturn new Tag(value, 14)\n}\ncurrentExtensions[15] = (value) => {\n\tif (bundledStrings)\n\t\treturn bundledStrings[1].slice(bundledStrings.position1, bundledStrings.position1 += value)\n\treturn new Tag(value, 15)\n}\nlet glbl = { Error, RegExp }\ncurrentExtensions[27] = (data) => { // http://cbor.schmorp.de/generic-object\n\treturn (glbl[data[0]] || Error)(data[1], data[2])\n}\nconst packedTable = (read) => {\n\tif (src[position++] != 0x84)\n\t\tthrow new Error('Packed values structure must be followed by a 4 element array')\n\tlet newPackedValues = read() // packed values\n\tpackedValues = packedValues ? newPackedValues.concat(packedValues.slice(newPackedValues.length)) : newPackedValues\n\tpackedValues.prefixes = read()\n\tpackedValues.suffixes = read()\n\treturn read() // read the rump\n}\npackedTable.handlesRead = true\ncurrentExtensions[51] = packedTable\n\ncurrentExtensions[PACKED_REFERENCE_TAG_ID] = (data) => { // packed reference\n\tif (!packedValues) {\n\t\tif (currentDecoder.getShared)\n\t\t\tloadShared()\n\t\telse\n\t\t\treturn new Tag(data, PACKED_REFERENCE_TAG_ID)\n\t}\n\tif (typeof data == 'number')\n\t\treturn packedValues[16 + (data >= 0 ? 2 * data : (-2 * data - 1))]\n\tthrow new Error('No support for non-integer packed references yet')\n}\n\n// The following code is an incomplete implementation of http://cbor.schmorp.de/stringref\n// the real thing would need to implemennt more logic to populate the stringRefs table and\n// maintain a stack of stringRef \"namespaces\".\n//\n// currentExtensions[25] = (id) => {\n// \treturn stringRefs[id]\n// }\n// currentExtensions[256] = (read) => {\n// \tstringRefs = []\n// \ttry {\n// \t\treturn read()\n// \t} finally {\n// \t\tstringRefs = null\n// \t}\n// }\n// currentExtensions[256].handlesRead = true\n\ncurrentExtensions[28] = (read) => { \n\t// shareable http://cbor.schmorp.de/value-sharing (for structured clones)\n\tif (!referenceMap) {\n\t\treferenceMap = new Map()\n\t\treferenceMap.id = 0\n\t}\n\tlet id = referenceMap.id++\n\tlet token = src[position]\n\tlet target\n\t// TODO: handle Maps, Sets, and other types that can cycle; this is complicated, because you potentially need to read\n\t// ahead past references to record structure definitions\n\tif ((token >> 5) == 4)\n\t\ttarget = []\n\telse\n\t\ttarget = {}\n\n\tlet refEntry = { target } // a placeholder object\n\treferenceMap.set(id, refEntry)\n\tlet targetProperties = read() // read the next value as the target object to id\n\tif (refEntry.used) // there is a cycle, so we have to assign properties to original target\n\t\treturn Object.assign(target, targetProperties)\n\trefEntry.target = targetProperties // the placeholder wasn't used, replace with the deserialized one\n\treturn targetProperties // no cycle, can just use the returned read object\n}\ncurrentExtensions[28].handlesRead = true\n\ncurrentExtensions[29] = (id) => {\n\t// sharedref http://cbor.schmorp.de/value-sharing (for structured clones)\n\tlet refEntry = referenceMap.get(id)\n\trefEntry.used = true\n\treturn refEntry.target\n}\n\ncurrentExtensions[258] = (array) => new Set(array); // https://github.com/input-output-hk/cbor-sets-spec/blob/master/CBOR_SETS.md\n(currentExtensions[259] = (read) => {\n\t// https://github.com/shanewholloway/js-cbor-codec/blob/master/docs/CBOR-259-spec\n\t// for decoding as a standard Map\n\tif (currentDecoder.mapsAsObjects) {\n\t\tcurrentDecoder.mapsAsObjects = false\n\t\trestoreMapsAsObject = true\n\t}\n\treturn read()\n}).handlesRead = true\nfunction combine(a, b) {\n\tif (typeof a === 'string')\n\t\treturn a + b\n\tif (a instanceof Array)\n\t\treturn a.concat(b)\n\treturn Object.assign({}, a, b)\n}\nfunction getPackedValues() {\n\tif (!packedValues) {\n\t\tif (currentDecoder.getShared)\n\t\t\tloadShared()\n\t\telse\n\t\t\tthrow new Error('No packed values available')\n\t}\n\treturn packedValues\n}\nconst SHARED_DATA_TAG_ID = 0x53687264 // ascii 'Shrd'\ncurrentExtensionRanges.push((tag, input) => {\n\tif (tag >= 225 && tag <= 255)\n\t\treturn combine(getPackedValues().prefixes[tag - 224], input)\n\tif (tag >= 28704 && tag <= 32767)\n\t\treturn combine(getPackedValues().prefixes[tag - 28672], input)\n\tif (tag >= 1879052288 && tag <= 2147483647)\n\t\treturn combine(getPackedValues().prefixes[tag - 1879048192], input)\n\tif (tag >= 216 && tag <= 223)\n\t\treturn combine(input, getPackedValues().suffixes[tag - 216])\n\tif (tag >= 27647 && tag <= 28671)\n\t\treturn combine(input, getPackedValues().suffixes[tag - 27639])\n\tif (tag >= 1811940352 && tag <= 1879048191)\n\t\treturn combine(input, getPackedValues().suffixes[tag - 1811939328])\n\tif (tag == SHARED_DATA_TAG_ID) {// we do a special check for this so that we can keep the currentExtensions as densely stored array (v8 stores arrays densely under about 3000 elements)\n\t\treturn {\n\t\t\tpackedValues: packedValues,\n\t\t\tstructures: currentStructures.slice(0),\n\t\t\tversion: input,\n\t\t}\n\t}\n\tif (tag == 55799) // self-descriptive CBOR tag, just return input value\n\t\treturn input\n})\n\nconst isLittleEndianMachine = new Uint8Array(new Uint16Array([1]).buffer)[0] == 1\nexport const typedArrays = [Uint8Array, Uint8ClampedArray, Uint16Array, Uint32Array,\n\ttypeof BigUint64Array == 'undefined' ? { name:'BigUint64Array' } : BigUint64Array, Int8Array, Int16Array, Int32Array,\n\ttypeof BigInt64Array == 'undefined' ? { name:'BigInt64Array' } : BigInt64Array, Float32Array, Float64Array]\nconst typedArrayTags = [64, 68, 69, 70, 71, 72, 77, 78, 79, 85, 86]\nfor (let i = 0; i < typedArrays.length; i++) {\n\tregisterTypedArray(typedArrays[i], typedArrayTags[i])\n}\nfunction registerTypedArray(TypedArray, tag) {\n\tlet dvMethod = 'get' + TypedArray.name.slice(0, -5)\n\tlet bytesPerElement;\n\tif (typeof TypedArray === 'function')\n\t\tbytesPerElement = TypedArray.BYTES_PER_ELEMENT;\n\telse\n\t\tTypedArray = null;\n\tfor (let littleEndian = 0; littleEndian < 2; littleEndian++) {\n\t\tif (!littleEndian && bytesPerElement == 1)\n\t\t\tcontinue\n\t\tlet sizeShift = bytesPerElement == 2 ? 1 : bytesPerElement == 4 ? 2 : 3\n\t\tcurrentExtensions[littleEndian ? tag : (tag - 4)] = (bytesPerElement == 1 || littleEndian == isLittleEndianMachine) ? (buffer) => {\n\t\t\tif (!TypedArray)\n\t\t\t\tthrow new Error('Could not find typed array for code ' + tag)\n\t\t\t// we have to always slice/copy here to get a new ArrayBuffer that is word/byte aligned\n\t\t\treturn new TypedArray(Uint8Array.prototype.slice.call(buffer, 0).buffer)\n\t\t} : buffer => {\n\t\t\tif (!TypedArray)\n\t\t\t\tthrow new Error('Could not find typed array for code ' + tag)\n\t\t\tlet dv = new DataView(buffer.buffer, buffer.byteOffset, buffer.byteLength)\n\t\t\tlet elements = buffer.length >> sizeShift\n\t\t\tlet ta = new TypedArray(elements)\n\t\t\tlet method = dv[dvMethod]\n\t\t\tfor (let i = 0; i < elements; i++) {\n\t\t\t\tta[i] = method.call(dv, i << sizeShift, littleEndian)\n\t\t\t}\n\t\t\treturn ta\n\t\t}\n\t}\n}\n\nfunction readBundleExt() {\n\tlet length = readJustLength()\n\tlet bundlePosition = position + read()\n\tfor (let i = 2; i < length; i++) {\n\t\t// skip past bundles that were already read\n\t\tlet bundleLength = readJustLength() // this will increment position, so must add to position afterwards\n\t\tposition += bundleLength\n\t}\n\tlet dataPosition = position\n\tposition = bundlePosition\n\tbundledStrings = [readStringJS(readJustLength()), readStringJS(readJustLength())]\n\tbundledStrings.position0 = 0\n\tbundledStrings.position1 = 0\n\tbundledStrings.postBundlePosition = position\n\tposition = dataPosition\n\treturn read()\n}\n\nfunction readJustLength() {\n\tlet token = src[position++] & 0x1f\n\tif (token > 0x17) {\n\t\tswitch (token) {\n\t\t\tcase 0x18:\n\t\t\t\ttoken = src[position++]\n\t\t\t\tbreak\n\t\t\tcase 0x19:\n\t\t\t\ttoken = dataView.getUint16(position)\n\t\t\t\tposition += 2\n\t\t\t\tbreak\n\t\t\tcase 0x1a:\n\t\t\t\ttoken = dataView.getUint32(position)\n\t\t\t\tposition += 4\n\t\t\t\tbreak\n\t\t}\n\t}\n\treturn token\n}\n\nfunction loadShared() {\n\tif (currentDecoder.getShared) {\n\t\tlet sharedData = saveState(() => {\n\t\t\t// save the state in case getShared modifies our buffer\n\t\t\tsrc = null\n\t\t\treturn currentDecoder.getShared()\n\t\t}) || {}\n\t\tlet updatedStructures = sharedData.structures || []\n\t\tcurrentDecoder.sharedVersion = sharedData.version\n\t\tpackedValues = currentDecoder.sharedValues = sharedData.packedValues\n\t\tif (currentStructures === true)\n\t\t\tcurrentDecoder.structures = currentStructures = updatedStructures\n\t\telse\n\t\t\tcurrentStructures.splice.apply(currentStructures, [0, updatedStructures.length].concat(updatedStructures))\n\t}\n}\n\nfunction saveState(callback) {\n\tlet savedSrcEnd = srcEnd\n\tlet savedPosition = position\n\tlet savedStringPosition = stringPosition\n\tlet savedSrcStringStart = srcStringStart\n\tlet savedSrcStringEnd = srcStringEnd\n\tlet savedSrcString = srcString\n\tlet savedStrings = strings\n\tlet savedReferenceMap = referenceMap\n\tlet savedBundledStrings = bundledStrings\n\n\t// TODO: We may need to revisit this if we do more external calls to user code (since it could be slow)\n\tlet savedSrc = new Uint8Array(src.slice(0, srcEnd)) // we copy the data in case it changes while external data is processed\n\tlet savedStructures = currentStructures\n\tlet savedDecoder = currentDecoder\n\tlet savedSequentialMode = sequentialMode\n\tlet value = callback()\n\tsrcEnd = savedSrcEnd\n\tposition = savedPosition\n\tstringPosition = savedStringPosition\n\tsrcStringStart = savedSrcStringStart\n\tsrcStringEnd = savedSrcStringEnd\n\tsrcString = savedSrcString\n\tstrings = savedStrings\n\treferenceMap = savedReferenceMap\n\tbundledStrings = savedBundledStrings\n\tsrc = savedSrc\n\tsequentialMode = savedSequentialMode\n\tcurrentStructures = savedStructures\n\tcurrentDecoder = savedDecoder\n\tdataView = new DataView(src.buffer, src.byteOffset, src.byteLength)\n\treturn value\n}\nexport function clearSource() {\n\tsrc = null\n\treferenceMap = null\n\tcurrentStructures = null\n}\n\nexport function addExtension(extension) {\n\tcurrentExtensions[extension.tag] = extension.decode\n}\n\nexport const mult10 = new Array(147) // this is a table matching binary exponents to the multiplier to determine significant digit rounding\nfor (let i = 0; i < 256; i++) {\n\tmult10[i] = +('1e' + Math.floor(45.15 - i * 0.30103))\n}\nlet defaultDecoder = new Decoder({ useRecords: false })\nexport const decode = defaultDecoder.decode\nexport const decodeMultiple = defaultDecoder.decodeMultiple\nexport const FLOAT32_OPTIONS = {\n\tNEVER: 0,\n\tALWAYS: 1,\n\tDECIMAL_ROUND: 3,\n\tDECIMAL_FIT: 4\n}\nexport function roundFloat32(float32Number) {\n\tf32Array[0] = float32Number\n\tlet multiplier = mult10[((u8Array[3] & 0x7f) << 1) | (u8Array[2] >> 7)]\n\treturn ((multiplier * float32Number + (float32Number > 0 ? 0.5 : -0.5)) >> 0) / multiplier\n}\n","import { Decoder, mult10, Tag, typedArrays, addExtension as decodeAddExtension } from './decode.js'\nlet textEncoder\ntry {\n\ttextEncoder = new TextEncoder()\n} catch (error) {}\nlet extensions, extensionClasses\nconst Buffer = typeof globalThis === 'object' && globalThis.Buffer;\nconst hasNodeBuffer = typeof Buffer !== 'undefined'\nconst ByteArrayAllocate = hasNodeBuffer ? Buffer.allocUnsafeSlow : Uint8Array\nconst ByteArray = hasNodeBuffer ? Buffer : Uint8Array\nconst MAX_STRUCTURES = 0x100\nconst MAX_BUFFER_SIZE = hasNodeBuffer ? 0x100000000 : 0x7fd00000\nlet serializationId = 1\nlet throwOnIterable\nlet target\nlet targetView\nlet position = 0\nlet safeEnd\nlet bundledStrings = null\nconst MAX_BUNDLE_SIZE = 0xf000\nconst hasNonLatin = /[\\u0080-\\uFFFF]/\nconst RECORD_SYMBOL = Symbol('record-id')\nexport class Encoder extends Decoder {\n\tconstructor(options) {\n\t\tsuper(options)\n\t\tthis.offset = 0\n\t\tlet typeBuffer\n\t\tlet start\n\t\tlet sharedStructures\n\t\tlet hasSharedUpdate\n\t\tlet structures\n\t\tlet referenceMap\n\t\toptions = options || {}\n\t\tlet encodeUtf8 = ByteArray.prototype.utf8Write ? function(string, position, maxBytes) {\n\t\t\treturn target.utf8Write(string, position, maxBytes)\n\t\t} : (textEncoder && textEncoder.encodeInto) ?\n\t\t\tfunction(string, position) {\n\t\t\t\treturn textEncoder.encodeInto(string, target.subarray(position)).written\n\t\t\t} : false\n\n\t\tlet encoder = this\n\t\tlet hasSharedStructures = options.structures || options.saveStructures\n\t\tlet maxSharedStructures = options.maxSharedStructures\n\t\tif (maxSharedStructures == null)\n\t\t\tmaxSharedStructures = hasSharedStructures ? 128 : 0\n\t\tif (maxSharedStructures > 8190)\n\t\t\tthrow new Error('Maximum maxSharedStructure is 8190')\n\t\tlet isSequential = options.sequential\n\t\tif (isSequential) {\n\t\t\tmaxSharedStructures = 0\n\t\t}\n\t\tif (!this.structures)\n\t\t\tthis.structures = []\n\t\tif (this.saveStructures)\n\t\t\tthis.saveShared = this.saveStructures\n\t\tlet samplingPackedValues, packedObjectMap, sharedValues = options.sharedValues\n\t\tlet sharedPackedObjectMap\n\t\tif (sharedValues) {\n\t\t\tsharedPackedObjectMap = Object.create(null)\n\t\t\tfor (let i = 0, l = sharedValues.length; i < l; i++) {\n\t\t\t\tsharedPackedObjectMap[sharedValues[i]] = i\n\t\t\t}\n\t\t}\n\t\tlet recordIdsToRemove = []\n\t\tlet transitionsCount = 0\n\t\tlet serializationsSinceTransitionRebuild = 0\n\t\t\n\t\tthis.mapEncode = function(value, encodeOptions) {\n\t\t\t// Experimental support for premapping keys using _keyMap instad of keyMap - not optiimised yet)\n\t\t\tif (this._keyMap && !this._mapped) {\n\t\t\t\t//console.log('encoding ', value)\n\t\t\t\tswitch (value.constructor.name) {\n\t\t\t\t\tcase 'Array': \n\t\t\t\t\t\tvalue = value.map(r => this.encodeKeys(r))\n\t\t\t\t\t\tbreak\n\t\t\t\t\t//case 'Map': \n\t\t\t\t\t//\tvalue = this.encodeKeys(value)\n\t\t\t\t\t//\tbreak\n\t\t\t\t}\n\t\t\t\t//this._mapped = true\n\t\t\t}\n\t\t\treturn this.encode(value, encodeOptions)\n\t\t}\n\t\t\n\t\tthis.encode = function(value, encodeOptions)\t{\n\t\t\tif (!target) {\n\t\t\t\ttarget = new ByteArrayAllocate(8192)\n\t\t\t\ttargetView = new DataView(target.buffer, 0, 8192)\n\t\t\t\tposition = 0\n\t\t\t}\n\t\t\tsafeEnd = target.length - 10\n\t\t\tif (safeEnd - position < 0x800) {\n\t\t\t\t// don't start too close to the end, \n\t\t\t\ttarget = new ByteArrayAllocate(target.length)\n\t\t\t\ttargetView = new DataView(target.buffer, 0, target.length)\n\t\t\t\tsafeEnd = target.length - 10\n\t\t\t\tposition = 0\n\t\t\t} else if (encodeOptions === REUSE_BUFFER_MODE)\n\t\t\t\tposition = (position + 7) & 0x7ffffff8 // Word align to make any future copying of this buffer faster\n\t\t\tstart = position\n\t\t\tif (encoder.useSelfDescribedHeader) {\n\t\t\t\ttargetView.setUint32(position, 0xd9d9f700) // tag two byte, then self-descriptive tag\n\t\t\t\tposition += 3\n\t\t\t}\n\t\t\treferenceMap = encoder.structuredClone ? new Map() : null\n\t\t\tif (encoder.bundleStrings && typeof value !== 'string') {\n\t\t\t\tbundledStrings = []\n\t\t\t\tbundledStrings.size = Infinity // force a new bundle start on first string\n\t\t\t} else\n\t\t\t\tbundledStrings = null\n\n\t\t\tsharedStructures = encoder.structures\n\t\t\tif (sharedStructures) {\n\t\t\t\tif (sharedStructures.uninitialized) {\n\t\t\t\t\tlet sharedData = encoder.getShared() || {}\n\t\t\t\t\tencoder.structures = sharedStructures = sharedData.structures || []\n\t\t\t\t\tencoder.sharedVersion = sharedData.version\n\t\t\t\t\tlet sharedValues = encoder.sharedValues = sharedData.packedValues\n\t\t\t\t\tif (sharedValues) {\n\t\t\t\t\t\tsharedPackedObjectMap = {}\n\t\t\t\t\t\tfor (let i = 0, l = sharedValues.length; i < l; i++)\n\t\t\t\t\t\t\tsharedPackedObjectMap[sharedValues[i]] = i\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet sharedStructuresLength = sharedStructures.length\n\t\t\t\tif (sharedStructuresLength > maxSharedStructures && !isSequential)\n\t\t\t\t\tsharedStructuresLength = maxSharedStructures\n\t\t\t\tif (!sharedStructures.transitions) {\n\t\t\t\t\t// rebuild our structure transitions\n\t\t\t\t\tsharedStructures.transitions = Object.create(null)\n\t\t\t\t\tfor (let i = 0; i < sharedStructuresLength; i++) {\n\t\t\t\t\t\tlet keys = sharedStructures[i]\n\t\t\t\t\t\t//console.log('shared struct keys:', keys)\n\t\t\t\t\t\tif (!keys)\n\t\t\t\t\t\t\tcontinue\n\t\t\t\t\t\tlet nextTransition, transition = sharedStructures.transitions\n\t\t\t\t\t\tfor (let j = 0, l = keys.length; j < l; j++) {\n\t\t\t\t\t\t\tif (transition[RECORD_SYMBOL] === undefined)\n\t\t\t\t\t\t\t\ttransition[RECORD_SYMBOL] = i\n\t\t\t\t\t\t\tlet key = keys[j]\n\t\t\t\t\t\t\tnextTransition = transition[key]\n\t\t\t\t\t\t\tif (!nextTransition) {\n\t\t\t\t\t\t\t\tnextTransition = transition[key] = Object.create(null)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttransition = nextTransition\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttransition[RECORD_SYMBOL] = i | 0x100000\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!isSequential)\n\t\t\t\t\tsharedStructures.nextId = sharedStructuresLength\n\t\t\t}\n\t\t\tif (hasSharedUpdate)\n\t\t\t\thasSharedUpdate = false\n\t\t\tstructures = sharedStructures || []\n\t\t\tpackedObjectMap = sharedPackedObjectMap\n\t\t\tif (options.pack) {\n\t\t\t\tlet packedValues = new Map()\n\t\t\t\tpackedValues.values = []\n\t\t\t\tpackedValues.encoder = encoder\n\t\t\t\tpackedValues.maxValues = options.maxPrivatePackedValues || (sharedPackedObjectMap ? 16 : Infinity)\n\t\t\t\tpackedValues.objectMap = sharedPackedObjectMap || false\n\t\t\t\tpackedValues.samplingPackedValues = samplingPackedValues\n\t\t\t\tfindRepetitiveStrings(value, packedValues)\n\t\t\t\tif (packedValues.values.length > 0) {\n\t\t\t\t\ttarget[position++] = 0xd8 // one-byte tag\n\t\t\t\t\ttarget[position++] = 51 // tag 51 for packed shared structures https://www.potaroo.net/ietf/ids/draft-ietf-cbor-packed-03.txt\n\t\t\t\t\twriteArrayHeader(4)\n\t\t\t\t\tlet valuesArray = packedValues.values\n\t\t\t\t\tencode(valuesArray)\n\t\t\t\t\twriteArrayHeader(0) // prefixes\n\t\t\t\t\twriteArrayHeader(0) // suffixes\n\t\t\t\t\tpackedObjectMap = Object.create(sharedPackedObjectMap || null)\n\t\t\t\t\tfor (let i = 0, l = valuesArray.length; i < l; i++) {\n\t\t\t\t\t\tpackedObjectMap[valuesArray[i]] = i\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthrowOnIterable = encodeOptions & THROW_ON_ITERABLE;\n\t\t\ttry {\n\t\t\t\tif (throwOnIterable)\n\t\t\t\t\treturn;\n\t\t\t\tencode(value)\n\t\t\t\tif (bundledStrings) {\n\t\t\t\t\twriteBundles(start, encode)\n\t\t\t\t}\n\t\t\t\tencoder.offset = position // update the offset so next serialization doesn't write over our buffer, but can continue writing to same buffer sequentially\n\t\t\t\tif (referenceMap && referenceMap.idsToInsert) {\n\t\t\t\t\tposition += referenceMap.idsToInsert.length * 2\n\t\t\t\t\tif (position > safeEnd)\n\t\t\t\t\t\tmakeRoom(position)\n\t\t\t\t\tencoder.offset = position\n\t\t\t\t\tlet serialized = insertIds(target.subarray(start, position), referenceMap.idsToInsert)\n\t\t\t\t\treferenceMap = null\n\t\t\t\t\treturn serialized\n\t\t\t\t}\n\t\t\t\tif (encodeOptions & REUSE_BUFFER_MODE) {\n\t\t\t\t\ttarget.start = start\n\t\t\t\t\ttarget.end = position\n\t\t\t\t\treturn target\n\t\t\t\t}\n\t\t\t\treturn target.subarray(start, position) // position can change if we call encode again in saveShared, so we get the buffer now\n\t\t\t} finally {\n\t\t\t\tif (sharedStructures) {\n\t\t\t\t\tif (serializationsSinceTransitionRebuild < 10)\n\t\t\t\t\t\tserializationsSinceTransitionRebuild++\n\t\t\t\t\tif (sharedStructures.length > maxSharedStructures)\n\t\t\t\t\t\tsharedStructures.length = maxSharedStructures\n\t\t\t\t\tif (transitionsCount > 10000) {\n\t\t\t\t\t\t// force a rebuild occasionally after a lot of transitions so it can get cleaned up\n\t\t\t\t\t\tsharedStructures.transitions = null\n\t\t\t\t\t\tserializationsSinceTransitionRebuild = 0\n\t\t\t\t\t\ttransitionsCount = 0\n\t\t\t\t\t\tif (recordIdsToRemove.length > 0)\n\t\t\t\t\t\t\trecordIdsToRemove = []\n\t\t\t\t\t} else if (recordIdsToRemove.length > 0 && !isSequential) {\n\t\t\t\t\t\tfor (let i = 0, l = recordIdsToRemove.length; i < l; i++) {\n\t\t\t\t\t\t\trecordIdsToRemove[i][RECORD_SYMBOL] = undefined\n\t\t\t\t\t\t}\n\t\t\t\t\t\trecordIdsToRemove = []\n\t\t\t\t\t\t//sharedStructures.nextId = maxSharedStructures\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (hasSharedUpdate && encoder.saveShared) {\n\t\t\t\t\tif (encoder.structures.length > maxSharedStructures) {\n\t\t\t\t\t\tencoder.structures = encoder.structures.slice(0, maxSharedStructures)\n\t\t\t\t\t}\n\t\t\t\t\t// we can't rely on start/end with REUSE_BUFFER_MODE since they will (probably) change when we save\n\t\t\t\t\tlet returnBuffer = target.subarray(start, position)\n\t\t\t\t\tif (encoder.updateSharedData() === false)\n\t\t\t\t\t\treturn encoder.encode(value) // re-encode if it fails\n\t\t\t\t\treturn returnBuffer\n\t\t\t\t}\n\t\t\t\tif (encodeOptions & RESET_BUFFER_MODE)\n\t\t\t\t\tposition = start\n\t\t\t}\n\t\t}\n\t\tthis.findCommonStringsToPack = () => {\n\t\t\tsamplingPackedValues = new Map()\n\t\t\tif (!sharedPackedObjectMap)\n\t\t\t\tsharedPackedObjectMap = Object.create(null)\n\t\t\treturn (options) => {\n\t\t\t\tlet threshold = options && options.threshold || 4\n\t\t\t\tlet position = this.pack ? options.maxPrivatePackedValues || 16 : 0\n\t\t\t\tif (!sharedValues)\n\t\t\t\t\tsharedValues = this.sharedValues = []\n\t\t\t\tfor (let [ key, status ] of samplingPackedValues) {\n\t\t\t\t\tif (status.count > threshold) {\n\t\t\t\t\t\tsharedPackedObjectMap[key] = position++\n\t\t\t\t\t\tsharedValues.push(key)\n\t\t\t\t\t\thasSharedUpdate = true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\twhile (this.saveShared && this.updateSharedData() === false) {}\n\t\t\t\tsamplingPackedValues = null\n\t\t\t}\n\t\t}\n\t\tconst encode = (value) => {\n\t\t\tif (position > safeEnd)\n\t\t\t\ttarget = makeRoom(position)\n\n\t\t\tvar type = typeof value\n\t\t\tvar length\n\t\t\tif (type === 'string') {\n\t\t\t\tif (packedObjectMap) {\n\t\t\t\t\tlet packedPosition = packedObjectMap[value]\n\t\t\t\t\tif (packedPosition >= 0) {\n\t\t\t\t\t\tif (packedPosition < 16)\n\t\t\t\t\t\t\ttarget[position++] = packedPosition + 0xe0 // simple values, defined in https://www.potaroo.net/ietf/ids/draft-ietf-cbor-packed-03.txt\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\ttarget[position++] = 0xc6 // tag 6 defined in https://www.potaroo.net/ietf/ids/draft-ietf-cbor-packed-03.txt\n\t\t\t\t\t\t\tif (packedPosition & 1)\n\t\t\t\t\t\t\t\tencode((15 - packedPosition) >> 1)\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tencode((packedPosition - 16) >> 1)\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn\n/*\t\t\t\t\t\t} else if (packedStatus.serializationId != serializationId) {\n\t\t\t\t\t\t\tpackedStatus.serializationId = serializationId\n\t\t\t\t\t\t\tpackedStatus.count = 1\n\t\t\t\t\t\t\tif (options.sharedPack) {\n\t\t\t\t\t\t\t\tlet sharedCount = packedStatus.sharedCount = (packedStatus.sharedCount || 0) + 1\n\t\t\t\t\t\t\t\tif (shareCount > (options.sharedPack.threshold || 5)) {\n\t\t\t\t\t\t\t\t\tlet sharedPosition = packedStatus.position = packedStatus.nextSharedPosition\n\t\t\t\t\t\t\t\t\thasSharedUpdate = true\n\t\t\t\t\t\t\t\t\tif (sharedPosition < 16)\n\t\t\t\t\t\t\t\t\t\ttarget[position++] = sharedPosition + 0xc0\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} // else any in-doc incrementation?*/\n\t\t\t\t\t} else if (samplingPackedValues && !options.pack) {\n\t\t\t\t\t\tlet status = samplingPackedValues.get(value)\n\t\t\t\t\t\tif (status)\n\t\t\t\t\t\t\tstatus.count++\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tsamplingPackedValues.set(value, {\n\t\t\t\t\t\t\t\tcount: 1,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet strLength = value.length\n\t\t\t\tif (bundledStrings && strLength >= 4 && strLength < 0x400) {\n\t\t\t\t\tif ((bundledStrings.size += strLength) > MAX_BUNDLE_SIZE) {\n\t\t\t\t\t\tlet extStart\n\t\t\t\t\t\tlet maxBytes = (bundledStrings[0] ? bundledStrings[0].length * 3 + bundledStrings[1].length : 0) + 10\n\t\t\t\t\t\tif (position + maxBytes > safeEnd)\n\t\t\t\t\t\t\ttarget = makeRoom(position + maxBytes)\n\t\t\t\t\t\ttarget[position++] = 0xd9 // tag 16-bit\n\t\t\t\t\t\ttarget[position++] = 0xdf // tag 0xdff9\n\t\t\t\t\t\ttarget[position++] = 0xf9\n\t\t\t\t\t\t// TODO: If we only have one bundle with any string data, only write one string bundle\n\t\t\t\t\t\ttarget[position++] = bundledStrings.position ? 0x84 : 0x82 // array of 4 or 2 elements depending on if we write bundles\n\t\t\t\t\t\ttarget[position++] = 0x1a // 32-bit unsigned int\n\t\t\t\t\t\textStart = position - start\n\t\t\t\t\t\tposition += 4 // reserve for writing bundle reference\n\t\t\t\t\t\tif (bundledStrings.position) {\n\t\t\t\t\t\t\twriteBundles(start, encode) // write the last bundles\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbundledStrings = ['', ''] // create new ones\n\t\t\t\t\t\tbundledStrings.size = 0\n\t\t\t\t\t\tbundledStrings.position = extStart\n\t\t\t\t\t}\n\t\t\t\t\tlet twoByte = hasNonLatin.test(value)\n\t\t\t\t\tbundledStrings[twoByte ? 0 : 1] += value\n\t\t\t\t\ttarget[position++] = twoByte ? 0xce : 0xcf\n\t\t\t\t\tencode(strLength);\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tlet headerSize\n\t\t\t\t// first we estimate the header size, so we can write to the correct location\n\t\t\t\tif (strLength < 0x20) {\n\t\t\t\t\theaderSize = 1\n\t\t\t\t} else if (strLength < 0x100) {\n\t\t\t\t\theaderSize = 2\n\t\t\t\t} else if (strLength < 0x10000) {\n\t\t\t\t\theaderSize = 3\n\t\t\t\t} else {\n\t\t\t\t\theaderSize = 5\n\t\t\t\t}\n\t\t\t\tlet maxBytes = strLength * 3\n\t\t\t\tif (position + maxBytes > safeEnd)\n\t\t\t\t\ttarget = makeRoom(position + maxBytes)\n\n\t\t\t\tif (strLength < 0x40 || !encodeUtf8) {\n\t\t\t\t\tlet i, c1, c2, strPosition = position + headerSize\n\t\t\t\t\tfor (i = 0; i < strLength; i++) {\n\t\t\t\t\t\tc1 = value.charCodeAt(i)\n\t\t\t\t\t\tif (c1 < 0x80) {\n\t\t\t\t\t\t\ttarget[strPosition++] = c1\n\t\t\t\t\t\t} else if (c1 < 0x800) {\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 >> 6 | 0xc0\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 & 0x3f | 0x80\n\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t(c1 & 0xfc00) === 0xd800 &&\n\t\t\t\t\t\t\t((c2 = value.charCodeAt(i + 1)) & 0xfc00) === 0xdc00\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tc1 = 0x10000 + ((c1 & 0x03ff) << 10) + (c2 & 0x03ff)\n\t\t\t\t\t\t\ti++\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 >> 18 | 0xf0\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 >> 12 & 0x3f | 0x80\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 >> 6 & 0x3f | 0x80\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 & 0x3f | 0x80\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 >> 12 | 0xe0\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 >> 6 & 0x3f | 0x80\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 & 0x3f | 0x80\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlength = strPosition - position - headerSize\n\t\t\t\t} else {\n\t\t\t\t\tlength = encodeUtf8(value, position + headerSize, maxBytes)\n\t\t\t\t}\n\n\t\t\t\tif (length < 0x18) {\n\t\t\t\t\ttarget[position++] = 0x60 | length\n\t\t\t\t} else if (length < 0x100) {\n\t\t\t\t\tif (headerSize < 2) {\n\t\t\t\t\t\ttarget.copyWithin(position + 2, position + 1, position + 1 + length)\n\t\t\t\t\t}\n\t\t\t\t\ttarget[position++] = 0x78\n\t\t\t\t\ttarget[position++] = length\n\t\t\t\t} else if (length < 0x10000) {\n\t\t\t\t\tif (headerSize < 3) {\n\t\t\t\t\t\ttarget.copyWithin(position + 3, position + 2, position + 2 + length)\n\t\t\t\t\t}\n\t\t\t\t\ttarget[position++] = 0x79\n\t\t\t\t\ttarget[position++] = length >> 8\n\t\t\t\t\ttarget[position++] = length & 0xff\n\t\t\t\t} else {\n\t\t\t\t\tif (headerSize < 5) {\n\t\t\t\t\t\ttarget.copyWithin(position + 5, position + 3, position + 3 + length)\n\t\t\t\t\t}\n\t\t\t\t\ttarget[position++] = 0x7a\n\t\t\t\t\ttargetView.setUint32(position, length)\n\t\t\t\t\tposition += 4\n\t\t\t\t}\n\t\t\t\tposition += length\n\t\t\t} else if (type === 'number') {\n\t\t\t\tif (!this.alwaysUseFloat && value >>> 0 === value) {// positive integer, 32-bit or less\n\t\t\t\t\t// positive uint\n\t\t\t\t\tif (value < 0x18) {\n\t\t\t\t\t\ttarget[position++] = value\n\t\t\t\t\t} else if (value < 0x100) {\n\t\t\t\t\t\ttarget[position++] = 0x18\n\t\t\t\t\t\ttarget[position++] = value\n\t\t\t\t\t} else if (value < 0x10000) {\n\t\t\t\t\t\ttarget[position++] = 0x19\n\t\t\t\t\t\ttarget[position++] = value >> 8\n\t\t\t\t\t\ttarget[position++] = value & 0xff\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttarget[position++] = 0x1a\n\t\t\t\t\t\ttargetView.setUint32(position, value)\n\t\t\t\t\t\tposition += 4\n\t\t\t\t\t}\n\t\t\t\t} else if (!this.alwaysUseFloat && value >> 0 === value) { // negative integer\n\t\t\t\t\tif (value >= -0x18) {\n\t\t\t\t\t\ttarget[position++] = 0x1f - value\n\t\t\t\t\t} else if (value >= -0x100) {\n\t\t\t\t\t\ttarget[position++] = 0x38\n\t\t\t\t\t\ttarget[position++] = ~value\n\t\t\t\t\t} else if (value >= -0x10000) {\n\t\t\t\t\t\ttarget[position++] = 0x39\n\t\t\t\t\t\ttargetView.setUint16(position, ~value)\n\t\t\t\t\t\tposition += 2\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttarget[position++] = 0x3a\n\t\t\t\t\t\ttargetView.setUint32(position, ~value)\n\t\t\t\t\t\tposition += 4\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet useFloat32\n\t\t\t\t\tif ((useFloat32 = this.useFloat32) > 0 && value < 0x100000000 && value >= -0x80000000) {\n\t\t\t\t\t\ttarget[position++] = 0xfa\n\t\t\t\t\t\ttargetView.setFloat32(position, value)\n\t\t\t\t\t\tlet xShifted\n\t\t\t\t\t\tif (useFloat32 < 4 ||\n\t\t\t\t\t\t\t\t// this checks for rounding of numbers that were encoded in 32-bit float to nearest significant decimal digit that could be preserved\n\t\t\t\t\t\t\t\t((xShifted = value * mult10[((target[position] & 0x7f) << 1) | (target[position + 1] >> 7)]) >> 0) === xShifted) {\n\t\t\t\t\t\t\tposition += 4\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t} else\n\t\t\t\t\t\t\tposition-- // move back into position for writing a double\n\t\t\t\t\t}\n\t\t\t\t\ttarget[position++] = 0xfb\n\t\t\t\t\ttargetView.setFloat64(position, value)\n\t\t\t\t\tposition += 8\n\t\t\t\t}\n\t\t\t} else if (type === 'object') {\n\t\t\t\tif (!value)\n\t\t\t\t\ttarget[position++] = 0xf6\n\t\t\t\telse {\n\t\t\t\t\tif (referenceMap) {\n\t\t\t\t\t\tlet referee = referenceMap.get(value)\n\t\t\t\t\t\tif (referee) {\n\t\t\t\t\t\t\ttarget[position++] = 0xd8\n\t\t\t\t\t\t\ttarget[position++] = 29 // http://cbor.schmorp.de/value-sharing\n\t\t\t\t\t\t\ttarget[position++] = 0x19 // 16-bit uint\n\t\t\t\t\t\t\tif (!referee.references) {\n\t\t\t\t\t\t\t\tlet idsToInsert = referenceMap.idsToInsert || (referenceMap.idsToInsert = [])\n\t\t\t\t\t\t\t\treferee.references = []\n\t\t\t\t\t\t\t\tidsToInsert.push(referee)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treferee.references.push(position - start)\n\t\t\t\t\t\t\tposition += 2 // TODO: also support 32-bit\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t} else \n\t\t\t\t\t\t\treferenceMap.set(value, { offset: position - start })\n\t\t\t\t\t}\n\t\t\t\t\tlet constructor = value.constructor\n\t\t\t\t\tif (constructor === Object) {\n\t\t\t\t\t\twriteObject(value, true)\n\t\t\t\t\t} else if (constructor === Array) {\n\t\t\t\t\t\tlength = value.length\n\t\t\t\t\t\tif (length < 0x18) {\n\t\t\t\t\t\t\ttarget[position++] = 0x80 | length\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twriteArrayHeader(length)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\t\t\tencode(value[i])\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (constructor === Map) {\n\t\t\t\t\t\tif (this.mapsAsObjects ? this.useTag259ForMaps !== false : this.useTag259ForMaps) {\n\t\t\t\t\t\t\t// use Tag 259 (https://github.com/shanewholloway/js-cbor-codec/blob/master/docs/CBOR-259-spec--explicit-maps.md) for maps if the user wants it that way\n\t\t\t\t\t\t\ttarget[position++] = 0xd9\n\t\t\t\t\t\t\ttarget[position++] = 1\n\t\t\t\t\t\t\ttarget[position++] = 3\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlength = value.size\n\t\t\t\t\t\tif (length < 0x18) {\n\t\t\t\t\t\t\ttarget[position++] = 0xa0 | length\n\t\t\t\t\t\t} else if (length < 0x100) {\n\t\t\t\t\t\t\ttarget[position++] = 0xb8\n\t\t\t\t\t\t\ttarget[position++] = length\n\t\t\t\t\t\t} else if (length < 0x10000) {\n\t\t\t\t\t\t\ttarget[position++] = 0xb9\n\t\t\t\t\t\t\ttarget[position++] = length >> 8\n\t\t\t\t\t\t\ttarget[position++] = length & 0xff\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttarget[position++] = 0xba\n\t\t\t\t\t\t\ttargetView.setUint32(position, length)\n\t\t\t\t\t\t\tposition += 4\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (encoder.keyMap) { \n\t\t\t\t\t\t\tfor (let [ key, entryValue ] of value) {\n\t\t\t\t\t\t\t\tencode(encoder.encodeKey(key))\n\t\t\t\t\t\t\t\tencode(entryValue)\n\t\t\t\t\t\t\t} \n\t\t\t\t\t\t} else { \n\t\t\t\t\t\t\tfor (let [ key, entryValue ] of value) {\n\t\t\t\t\t\t\t\tencode(key) \n\t\t\t\t\t\t\t\tencode(entryValue)\n\t\t\t\t\t\t\t} \t\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (let i = 0, l = extensions.length; i < l; i++) {\n\t\t\t\t\t\t\tlet extensionClass = extensionClasses[i]\n\t\t\t\t\t\t\tif (value instanceof extensionClass) {\n\t\t\t\t\t\t\t\tlet extension = extensions[i]\n\t\t\t\t\t\t\t\tlet tag = extension.tag\n\t\t\t\t\t\t\t\tif (tag == undefined)\n\t\t\t\t\t\t\t\t\ttag = extension.getTag && extension.getTag.call(this, value)\n\t\t\t\t\t\t\t\tif (tag < 0x18) {\n\t\t\t\t\t\t\t\t\ttarget[position++] = 0xc0 | tag\n\t\t\t\t\t\t\t\t} else if (tag < 0x100) {\n\t\t\t\t\t\t\t\t\ttarget[position++] = 0xd8\n\t\t\t\t\t\t\t\t\ttarget[position++] = tag\n\t\t\t\t\t\t\t\t} else if (tag < 0x10000) {\n\t\t\t\t\t\t\t\t\ttarget[position++] = 0xd9\n\t\t\t\t\t\t\t\t\ttarget[position++] = tag >> 8\n\t\t\t\t\t\t\t\t\ttarget[position++] = tag & 0xff\n\t\t\t\t\t\t\t\t} else if (tag > -1) {\n\t\t\t\t\t\t\t\t\ttarget[position++] = 0xda\n\t\t\t\t\t\t\t\t\ttargetView.setUint32(position, tag)\n\t\t\t\t\t\t\t\t\tposition += 4\n\t\t\t\t\t\t\t\t} // else undefined, don't write tag\n\t\t\t\t\t\t\t\textension.encode.call(this, value, encode, makeRoom)\n\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (value[Symbol.iterator]) {\n\t\t\t\t\t\t\tif (throwOnIterable) {\n\t\t\t\t\t\t\t\tlet error = new Error('Iterable should be serialized as iterator')\n\t\t\t\t\t\t\t\terror.iteratorNotHandled = true;\n\t\t\t\t\t\t\t\tthrow error;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttarget[position++] = 0x9f // indefinite length array\n\t\t\t\t\t\t\tfor (let entry of value) {\n\t\t\t\t\t\t\t\tencode(entry)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttarget[position++] = 0xff // stop-code\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (value[Symbol.asyncIterator] || isBlob(value)) {\n\t\t\t\t\t\t\tlet error = new Error('Iterable/blob should be serialized as iterator')\n\t\t\t\t\t\t\terror.iteratorNotHandled = true;\n\t\t\t\t\t\t\tthrow error;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (this.useToJSON && value.toJSON) {\n\t\t\t\t\t\t\tconst json = value.toJSON()\n\t\t\t\t\t\t\t// if for some reason value.toJSON returns itself it'll loop forever\n\t\t\t\t\t\t\tif (json !== value)\n\t\t\t\t\t\t\t\treturn encode(json)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// no extension found, write as object\n\t\t\t\t\t\twriteObject(value, !value.hasOwnProperty) // if it doesn't have hasOwnProperty, don't do hasOwnProperty checks\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (type === 'boolean') {\n\t\t\t\ttarget[position++] = value ? 0xf5 : 0xf4\n\t\t\t} else if (type === 'bigint') {\n\t\t\t\tif (value < (BigInt(1)<<BigInt(64)) && value >= 0) {\n\t\t\t\t\t// use an unsigned int as long as it fits\n\t\t\t\t\ttarget[position++] = 0x1b\n\t\t\t\t\ttargetView.setBigUint64(position, value)\n\t\t\t\t} else if (value > -(BigInt(1)<<BigInt(64)) && value < 0) {\n\t\t\t\t\t// if we can fit an unsigned int, use that\n\t\t\t\t\ttarget[position++] = 0x3b\n\t\t\t\t\ttargetView.setBigUint64(position, -value - BigInt(1))\n\t\t\t\t} else {\n\t\t\t\t\t// overflow\n\t\t\t\t\tif (this.largeBigIntToFloat) {\n\t\t\t\t\t\ttarget[position++] = 0xfb\n\t\t\t\t\t\ttargetView.setFloat64(position, Number(value))\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new RangeError(value + ' was too large to fit in CBOR 64-bit integer format, set largeBigIntToFloat to convert to float-64')\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tposition += 8\n\t\t\t} else if (type === 'undefined') {\n\t\t\t\ttarget[position++] = 0xf7\n\t\t\t} else {\n\t\t\t\tthrow new Error('Unknown type: ' + type)\n\t\t\t}\n\t\t}\n\n\t\tconst writeObject = this.useRecords === false ? this.variableMapSize ? (object) => {\n\t\t\t// this method is slightly slower, but generates \"preferred serialization\" (optimally small for smaller objects)\n\t\t\tlet keys = Object.keys(object)\n\t\t\tlet vals = Object.values(object)\n\t\t\tlet length = keys.length\n\t\t\tif (length < 0x18) {\n\t\t\t\ttarget[position++] = 0xa0 | length\n\t\t\t} else if (length < 0x100) {\n\t\t\t\ttarget[position++] = 0xb8\n\t\t\t\ttarget[position++] = length\n\t\t\t} else if (length < 0x10000) {\n\t\t\t\ttarget[position++] = 0xb9\n\t\t\t\ttarget[position++] = length >> 8\n\t\t\t\ttarget[position++] = length & 0xff\n\t\t\t} else {\n\t\t\t\ttarget[position++] = 0xba\n\t\t\t\ttargetView.setUint32(position, length)\n\t\t\t\tposition += 4\n\t\t\t}\n\t\t\tlet key\n\t\t\tif (encoder.keyMap) { \n\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\tencode(encoder.encodeKey(keys[i]))\n\t\t\t\t\tencode(vals[i])\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\tencode(keys[i])\n\t\t\t\t\tencode(vals[i])\n\t\t\t\t}\n\t\t\t}\n\t\t} :\n\t\t(object, safePrototype) => {\n\t\t\ttarget[position++] = 0xb9 // always use map 16, so we can preallocate and set the length afterwards\n\t\t\tlet objectOffset = position - start\n\t\t\tposition += 2\n\t\t\tlet size = 0\n\t\t\tif (encoder.keyMap) { \n\t\t\t\tfor (let key in object) if (safePrototype || object.hasOwnProperty(key)) {\n\t\t\t\t\tencode(encoder.encodeKey(key))\n\t\t\t\t\tencode(object[key])\n\t\t\t\t\tsize++\n\t\t\t\t}\n\t\t\t} else { \n\t\t\t\tfor (let key in object) if (safePrototype || object.hasOwnProperty(key)) {\n\t\t\t\t\t\tencode(key)\n\t\t\t\t\t\tencode(object[key])\n\t\t\t\t\tsize++\n\t\t\t\t}\n\t\t\t}\n\t\t\ttarget[objectOffset++ + start] = size >> 8\n\t\t\ttarget[objectOffset + start] = size & 0xff\n\t\t} :\n\t\t(object, safePrototype) => {\n\t\t\tlet nextTransition, transition = structures.transitions || (structures.transitions = Object.create(null))\n\t\t\tlet newTransitions = 0\n\t\t\tlet length = 0\n\t\t\tlet parentRecordId\n\t\t\tlet keys\n\t\t\tif (this.keyMap) {\n\t\t\t\tkeys = Object.keys(object).map(k => this.encodeKey(k))\n\t\t\t\tlength = keys.length\n\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\tlet key = keys[i]\n\t\t\t\t\tnextTransition = transition[key]\n\t\t\t\t\tif (!nextTransition) {\n\t\t\t\t\t\tnextTransition = transition[key] = Object.create(null)\n\t\t\t\t\t\tnewTransitions++\n\t\t\t\t\t}\n\t\t\t\t\ttransition = nextTransition\n\t\t\t\t}\t\t\t\t\n\t\t\t} else {\n\t\t\t\tfor (let key in object) if (safePrototype || object.hasOwnProperty(key)) {\n\t\t\t\t\tnextTransition = transition[key]\n\t\t\t\t\tif (!nextTransition) {\n\t\t\t\t\t\tif (transition[RECORD_SYMBOL] & 0x100000) {// this indicates it is a brancheable/extendable terminal node, so we will use this record id and extend it\n\t\t\t\t\t\t\tparentRecordId = transition[RECORD_SYMBOL] & 0xffff\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnextTransition = transition[key] = Object.create(null)\n\t\t\t\t\t\tnewTransitions++\n\t\t\t\t\t}\n\t\t\t\t\ttransition = nextTransition\n\t\t\t\t\tlength++\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet recordId = transition[RECORD_SYMBOL]\n\t\t\tif (recordId !== undefined) {\n\t\t\t\trecordId &= 0xffff\n\t\t\t\ttarget[position++] = 0xd9\n\t\t\t\ttarget[position++] = (recordId >> 8) | 0xe0\n\t\t\t\ttarget[position++] = recordId & 0xff\n\t\t\t} else {\n\t\t\t\tif (!keys)\n\t\t\t\t\tkeys = transition.__keys__ || (transition.__keys__ = Object.keys(object))\n\t\t\t\tif (parentRecordId === undefined) {\n\t\t\t\t\trecordId = structures.nextId++\n\t\t\t\t\tif (!recordId) {\n\t\t\t\t\t\trecordId = 0\n\t\t\t\t\t\tstructures.nextId = 1\n\t\t\t\t\t}\n\t\t\t\t\tif (recordId >= MAX_STRUCTURES) {// cycle back around\n\t\t\t\t\t\tstructures.nextId = (recordId = maxSharedStructures) + 1\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\trecordId = parentRecordId\n\t\t\t\t}\n\t\t\t\tstructures[recordId] = keys\n\t\t\t\tif (recordId < maxSharedStructures) {\n\t\t\t\t\ttarget[position++] = 0xd9\n\t\t\t\t\ttarget[position++] = (recordId >> 8) | 0xe0\n\t\t\t\t\ttarget[position++] = recordId & 0xff\n\t\t\t\t\ttransition = structures.transitions\n\t\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\t\tif (transition[RECORD_SYMBOL] === undefined || (transition[RECORD_SYMBOL] & 0x100000))\n\t\t\t\t\t\t\ttransition[RECORD_SYMBOL] = recordId\n\t\t\t\t\t\ttransition = transition[keys[i]]\n\t\t\t\t\t}\n\t\t\t\t\ttransition[RECORD_SYMBOL] = recordId | 0x100000 // indicates it is a extendable terminal\n\t\t\t\t\thasSharedUpdate = true\n\t\t\t\t} else {\n\t\t\t\t\ttransition[RECORD_SYMBOL] = recordId\n\t\t\t\t\ttargetView.setUint32(position, 0xd9dfff00) // tag two byte, then record definition id\n\t\t\t\t\tposition += 3\n\t\t\t\t\tif (newTransitions)\n\t\t\t\t\t\ttransitionsCount += serializationsSinceTransitionRebuild * newTransitions\n\t\t\t\t\t// record the removal of the id, we can maintain our shared structure\n\t\t\t\t\tif (recordIdsToRemove.length >= MAX_STRUCTURES - maxSharedStructures)\n\t\t\t\t\t\trecordIdsToRemove.shift()[RECORD_SYMBOL] = undefined // we are cycling back through, and have to remove old ones\n\t\t\t\t\trecordIdsToRemove.push(transition)\n\t\t\t\t\twriteArrayHeader(length + 2)\n\t\t\t\t\tencode(0xe000 + recordId)\n\t\t\t\t\tencode(keys)\n\t\t\t\t\tif (safePrototype === null) return; // special exit for iterator\n\t\t\t\t\tfor (let key in object)\n\t\t\t\t\t\tif (safePrototype || object.hasOwnProperty(key))\n\t\t\t\t\t\t\tencode(object[key])\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (length < 0x18) { // write the array header\n\t\t\t\ttarget[position++] = 0x80 | length\n\t\t\t} else {\n\t\t\t\twriteArrayHeader(length)\n\t\t\t}\n\t\t\tif (safePrototype === null) return; // special exit for iterator\n\t\t\tfor (let key in object)\n\t\t\t\tif (safePrototype || object.hasOwnProperty(key))\n\t\t\t\t\tencode(object[key])\n\t\t}\n\t\tconst makeRoom = (end) => {\n\t\t\tlet newSize\n\t\t\tif (end > 0x1000000) {\n\t\t\t\t// special handling for really large buffers\n\t\t\t\tif ((end - start) > MAX_BUFFER_SIZE)\n\t\t\t\t\tthrow new Error('Encoded buffer would be larger than maximum buffer size')\n\t\t\t\tnewSize = Math.min(MAX_BUFFER_SIZE,\n\t\t\t\t\tMath.round(Math.max((end - start) * (end > 0x4000000 ? 1.25 : 2), 0x400000) / 0x1000) * 0x1000)\n\t\t\t} else // faster handling for smaller buffers\n\t\t\t\tnewSize = ((Math.max((end - start) << 2, target.length - 1) >> 12) + 1) << 12\n\t\t\tlet newBuffer = new ByteArrayAllocate(newSize)\n\t\t\ttargetView = new DataView(newBuffer.buffer, 0, newSize)\n\t\t\tif (target.copy)\n\t\t\t\ttarget.copy(newBuffer, 0, start, end)\n\t\t\telse\n\t\t\t\tnewBuffer.set(target.slice(start, end))\n\t\t\tposition -= start\n\t\t\tstart = 0\n\t\t\tsafeEnd = newBuffer.length - 10\n\t\t\treturn target = newBuffer\n\t\t}\n\t\tlet chunkThreshold = 100;\n\t\tlet continuedChunkThreshold = 1000;\n\t\tthis.encodeAsIterable = function(value, options) {\n\t\t\treturn startEncoding(value, options, encodeObjectAsIterable);\n\t\t}\n\t\tthis.encodeAsAsyncIterable = function(value, options) {\n\t\t\treturn startEncoding(value, options, encodeObjectAsAsyncIterable);\n\t\t}\n\n\t\tfunction* encodeObjectAsIterable(object, iterateProperties, finalIterable) {\n\t\t\tlet constructor = object.constructor;\n\t\t\tif (constructor === Object) {\n\t\t\t\tlet useRecords = encoder.useRecords !== false;\n\t\t\t\tif (useRecords)\n\t\t\t\t\twriteObject(object, null); // write the record identifier\n\t\t\t\telse\n\t\t\t\t\twriteEntityLength(Object.keys(object).length, 0xa0);\n\t\t\t\tfor (let key in object) {\n\t\t\t\t\tlet value = object[key];\n\t\t\t\t\tif (!useRecords) encode(key);\n\t\t\t\t\tif (value && typeof value === 'object') {\n\t\t\t\t\t\tif (iterateProperties[key])\n\t\t\t\t\t\t\tyield* encodeObjectAsIterable(value, iterateProperties[key]);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tyield* tryEncode(value, iterateProperties, key);\n\t\t\t\t\t} else encode(value);\n\t\t\t\t}\n\t\t\t} else if (constructor === Array) {\n\t\t\t\tlet length = object.length;\n\t\t\t\twriteArrayHeader(length);\n\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\tlet value = object[i];\n\t\t\t\t\tif (value && (typeof value === 'object' || position - start > chunkThreshold)) {\n\t\t\t\t\t\tif (iterateProperties.element)\n\t\t\t\t\t\t\tyield* encodeObjectAsIterable(value, iterateProperties.element);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tyield* tryEncode(value, iterateProperties, 'element');\n\t\t\t\t\t} else encode(value);\n\t\t\t\t}\n\t\t\t} else if (object[Symbol.iterator]) {\n\t\t\t\ttarget[position++] = 0x9f; // start indefinite array\n\t\t\t\tfor (let value of object) {\n\t\t\t\t\tif (value && (typeof value === 'object' || position - start > chunkThreshold)) {\n\t\t\t\t\t\tif (iterateProperties.element)\n\t\t\t\t\t\t\tyield* encodeObjectAsIterable(value, iterateProperties.element);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tyield* tryEncode(value, iterateProperties, 'element');\n\t\t\t\t\t} else encode(value);\n\t\t\t\t}\n\t\t\t\ttarget[position++] = 0xff; // stop byte\n\t\t\t} else if (isBlob(object)){\n\t\t\t\twriteEntityLength(object.size, 0x40); // encode as binary data\n\t\t\t\tyield target.subarray(start, position);\n\t\t\t\tyield object; // directly return blobs, they have to be encoded asynchronously\n\t\t\t\trestartEncoding();\n\t\t\t} else if (object[Symbol.asyncIterator]) {\n\t\t\t\ttarget[position++] = 0x9f; // start indefinite array\n\t\t\t\tyield target.subarray(start, position);\n\t\t\t\tyield object; // directly return async iterators, they have to be encoded asynchronously\n\t\t\t\trestartEncoding();\n\t\t\t\ttarget[position++] = 0xff; // stop byte\n\t\t\t} else {\n\t\t\t\tencode(object);\n\t\t\t}\n\t\t\tif (finalIterable && position > start) yield target.subarray(start, position);\n\t\t\telse if (position - start > chunkThreshold) {\n\t\t\t\tyield target.subarray(start, position);\n\t\t\t\trestartEncoding();\n\t\t\t}\n\t\t}\n\t\tfunction* tryEncode(value, iterateProperties, key) {\n\t\t\tlet restart = position - start;\n\t\t\ttry {\n\t\t\t\tencode(value);\n\t\t\t\tif (position - start > chunkThreshold) {\n\t\t\t\t\tyield target.subarray(start, position);\n\t\t\t\t\trestartEncoding();\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tif (error.iteratorNotHandled) {\n\t\t\t\t\titerateProperties[key] = {};\n\t\t\t\t\tposition = start + restart; // restart our position so we don't have partial data from last encode\n\t\t\t\t\tyield* encodeObjectAsIterable.call(this, value, iterateProperties[key]);\n\t\t\t\t} else throw error;\n\t\t\t}\n\t\t}\n\t\tfunction restartEncoding() {\n\t\t\tchunkThreshold = continuedChunkThreshold;\n\t\t\tencoder.encode(null, THROW_ON_ITERABLE); // restart encoding\n\t\t}\n\t\tfunction startEncoding(value, options, encodeIterable) {\n\t\t\tif (options && options.chunkThreshold) // explicitly specified chunk sizes\n\t\t\t\tchunkThreshold = continuedChunkThreshold = options.chunkThreshold;\n\t\t\telse // we start with a smaller threshold to get initial bytes sent quickly\n\t\t\t\tchunkThreshold = 100;\n\t\t\tif (value && typeof value === 'object') {\n\t\t\t\tencoder.encode(null, THROW_ON_ITERABLE); // start encoding\n\t\t\t\treturn encodeIterable(value, encoder.iterateProperties || (encoder.iterateProperties = {}), true);\n\t\t\t}\n\t\t\treturn [encoder.encode(value)];\n\t\t}\n\n\t\tasync function* encodeObjectAsAsyncIterable(value, iterateProperties) {\n\t\t\tfor (let encodedValue of encodeObjectAsIterable(value, iterateProperties, true)) {\n\t\t\t\tlet constructor = encodedValue.constructor;\n\t\t\t\tif (constructor === ByteArray || constructor === Uint8Array)\n\t\t\t\t\tyield encodedValue;\n\t\t\t\telse if (isBlob(encodedValue)) {\n\t\t\t\t\tlet reader = encodedValue.stream().getReader();\n\t\t\t\t\tlet next;\n\t\t\t\t\twhile (!(next = await reader.read()).done) {\n\t\t\t\t\t\tyield next.value;\n\t\t\t\t\t}\n\t\t\t\t} else if (encodedValue[Symbol.asyncIterator]) {\n\t\t\t\t\tfor await (let asyncValue of encodedValue) {\n\t\t\t\t\t\trestartEncoding();\n\t\t\t\t\t\tif (asyncValue)\n\t\t\t\t\t\t\tyield* encodeObjectAsAsyncIterable(asyncValue, iterateProperties.async || (iterateProperties.async = {}));\n\t\t\t\t\t\telse yield encoder.encode(asyncValue);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tyield encodedValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tuseBuffer(buffer) {\n\t\t// this means we are finished using our own buffer and we can write over it safely\n\t\ttarget = buffer\n\t\ttargetView = new DataView(target.buffer, target.byteOffset, target.byteLength)\n\t\tposition = 0\n\t}\n\tclearSharedData() {\n\t\tif (this.structures)\n\t\t\tthis.structures = []\n\t\tif (this.sharedValues)\n\t\t\tthis.sharedValues = undefined\n\t}\n\tupdateSharedData() {\n\t\tlet lastVersion = this.sharedVersion || 0\n\t\tthis.sharedVersion = lastVersion + 1\n\t\tlet structuresCopy = this.structures.slice(0)\n\t\tlet sharedData = new SharedData(structuresCopy, this.sharedValues, this.sharedVersion)\n\t\tlet saveResults = this.saveShared(sharedData,\n\t\t\t\texistingShared => (existingShared && existingShared.version || 0) == lastVersion)\n\t\tif (saveResults === false) {\n\t\t\t// get updated structures and try again if the update failed\n\t\t\tsharedData = this.getShared() || {}\n\t\t\tthis.structures = sharedData.structures || []\n\t\t\tthis.sharedValues = sharedData.packedValues\n\t\t\tthis.sharedVersion = sharedData.version\n\t\t\tthis.structures.nextId = this.structures.length\n\t\t} else {\n\t\t\t// restore structures\n\t\t\tstructuresCopy.forEach((structure, i) => this.structures[i] = structure)\n\t\t}\n\t\t// saveShared may fail to write and reload, or may have reloaded to check compatibility and overwrite saved data, either way load the correct shared data\n\t\treturn saveResults\n\t}\n}\nfunction writeEntityLength(length, majorValue) {\n\tif (length < 0x18)\n\t\ttarget[position++] = majorValue | length\n\telse if (length < 0x100) {\n\t\ttarget[position++] = majorValue | 0x18\n\t\ttarget[position++] = length\n\t} else if (length < 0x10000) {\n\t\ttarget[position++] = majorValue | 0x19\n\t\ttarget[position++] = length >> 8\n\t\ttarget[position++] = length & 0xff\n\t} else {\n\t\ttarget[position++] = majorValue | 0x1a\n\t\ttargetView.setUint32(position, length)\n\t\tposition += 4\n\t}\n\n}\nclass SharedData {\n\tconstructor(structures, values, version) {\n\t\tthis.structures = structures\n\t\tthis.packedValues = values\n\t\tthis.version = version\n\t}\n}\n\nfunction writeArrayHeader(length) {\n\tif (length < 0x18)\n\t\ttarget[position++] = 0x80 | length\n\telse if (length < 0x100) {\n\t\ttarget[position++] = 0x98\n\t\ttarget[position++] = length\n\t} else if (length < 0x10000) {\n\t\ttarget[position++] = 0x99\n\t\ttarget[position++] = length >> 8\n\t\ttarget[position++] = length & 0xff\n\t} else {\n\t\ttarget[position++] = 0x9a\n\t\ttargetView.setUint32(position, length)\n\t\tposition += 4\n\t}\n}\n\nconst BlobConstructor = typeof Blob === 'undefined' ? function(){} : Blob;\nfunction isBlob(object) {\n\tif (object instanceof BlobConstructor)\n\t\treturn true;\n\tlet tag = object[Symbol.toStringTag];\n\treturn tag === 'Blob' || tag === 'File';\n}\nfunction findRepetitiveStrings(value, packedValues) {\n\tswitch(typeof value) {\n\t\tcase 'string':\n\t\t\tif (value.length > 3) {\n\t\t\t\tif (packedValues.objectMap[value] > -1 || packedValues.values.length >= packedValues.maxValues)\n\t\t\t\t\treturn\n\t\t\t\tlet packedStatus = packedValues.get(value)\n\t\t\t\tif (packedStatus) {\n\t\t\t\t\tif (++packedStatus.count == 2) {\n\t\t\t\t\t\tpackedValues.values.push(value)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tpackedValues.set(value, {\n\t\t\t\t\t\tcount: 1,\n\t\t\t\t\t})\n\t\t\t\t\tif (packedValues.samplingPackedValues) {\n\t\t\t\t\t\tlet status = packedValues.samplingPackedValues.get(value)\n\t\t\t\t\t\tif (status)\n\t\t\t\t\t\t\tstatus.count++\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tpackedValues.samplingPackedValues.set(value, {\n\t\t\t\t\t\t\t\tcount: 1,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'object':\n\t\t\tif (value) {\n\t\t\t\tif (value instanceof Array) {\n\t\t\t\t\tfor (let i = 0, l = value.length; i < l; i++) {\n\t\t\t\t\t\tfindRepetitiveStrings(value[i], packedValues)\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tlet includeKeys = !packedValues.encoder.useRecords\n\t\t\t\t\tfor (var key in value) {\n\t\t\t\t\t\tif (value.hasOwnProperty(key)) {\n\t\t\t\t\t\t\tif (includeKeys)\n\t\t\t\t\t\t\t\tfindRepetitiveStrings(key, packedValues)\n\t\t\t\t\t\t\tfindRepetitiveStrings(value[key], packedValues)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'function': console.log(value)\n\t}\n}\nconst isLittleEndianMachine = new Uint8Array(new Uint16Array([1]).buffer)[0] == 1\nextensionClasses = [ Date, Set, Error, RegExp, Tag, ArrayBuffer,\n\tUint8Array, Uint8ClampedArray, Uint16Array, Uint32Array,\n\ttypeof BigUint64Array == 'undefined' ? function() {} : BigUint64Array, Int8Array, Int16Array, Int32Array,\n\ttypeof BigInt64Array == 'undefined' ? function() {} : BigInt64Array,\n\tFloat32Array, Float64Array, SharedData ]\n\n//Object.getPrototypeOf(Uint8Array.prototype).constructor /*TypedArray*/\nextensions = [{ // Date\n\ttag: 1,\n\tencode(date, encode) {\n\t\tlet seconds = date.getTime() / 1000\n\t\tif ((this.useTimestamp32 || date.getMilliseconds() === 0) && seconds >= 0 && seconds < 0x100000000) {\n\t\t\t// Timestamp 32\n\t\t\ttarget[position++] = 0x1a\n\t\t\ttargetView.setUint32(position, seconds)\n\t\t\tposition += 4\n\t\t} else {\n\t\t\t// Timestamp float64\n\t\t\ttarget[position++] = 0xfb\n\t\t\ttargetView.setFloat64(position, seconds)\n\t\t\tposition += 8\n\t\t}\n\t}\n}, { // Set\n\ttag: 258, // https://github.com/input-output-hk/cbor-sets-spec/blob/master/CBOR_SETS.md\n\tencode(set, encode) {\n\t\tlet array = Array.from(set)\n\t\tencode(array)\n\t}\n}, { // Error\n\ttag: 27, // http://cbor.schmorp.de/generic-object\n\tencode(error, encode) {\n\t\tencode([ error.name, error.message ])\n\t}\n}, { // RegExp\n\ttag: 27, // http://cbor.schmorp.de/generic-object\n\tencode(regex, encode) {\n\t\tencode([ 'RegExp', regex.source, regex.flags ])\n\t}\n}, { // Tag\n\tgetTag(tag) {\n\t\treturn tag.tag\n\t},\n\tencode(tag, encode) {\n\t\tencode(tag.value)\n\t}\n}, { // ArrayBuffer\n\tencode(arrayBuffer, encode, makeRoom) {\n\t\twriteBuffer(arrayBuffer, makeRoom)\n\t}\n}, { // Uint8Array\n\tgetTag(typedArray) {\n\t\tif (typedArray.constructor === Uint8Array) {\n\t\t\tif (this.tagUint8Array || hasNodeBuffer && this.tagUint8Array !== false)\n\t\t\t\treturn 64;\n\t\t} // else no tag\n\t},\n\tencode(typedArray, encode, makeRoom) {\n\t\twriteBuffer(typedArray, makeRoom)\n\t}\n},\n\ttypedArrayEncoder(68, 1),\n\ttypedArrayEncoder(69, 2),\n\ttypedArrayEncoder(70, 4),\n\ttypedArrayEncoder(71, 8),\n\ttypedArrayEncoder(72, 1),\n\ttypedArrayEncoder(77, 2),\n\ttypedArrayEncoder(78, 4),\n\ttypedArrayEncoder(79, 8),\n\ttypedArrayEncoder(85, 4),\n\ttypedArrayEncoder(86, 8),\n{\n\tencode(sharedData, encode) { // write SharedData\n\t\tlet packedValues = sharedData.packedValues || []\n\t\tlet sharedStructures = sharedData.structures || []\n\t\tif (packedValues.values.length > 0) {\n\t\t\ttarget[position++] = 0xd8 // one-byte tag\n\t\t\ttarget[position++] = 51 // tag 51 for packed shared structures https://www.potaroo.net/ietf/ids/draft-ietf-cbor-packed-03.txt\n\t\t\twriteArrayHeader(4)\n\t\t\tlet valuesArray = packedValues.values\n\t\t\tencode(valuesArray)\n\t\t\twriteArrayHeader(0) // prefixes\n\t\t\twriteArrayHeader(0) // suffixes\n\t\t\tpackedObjectMap = Object.create(sharedPackedObjectMap || null)\n\t\t\tfor (let i = 0, l = valuesArray.length; i < l; i++) {\n\t\t\t\tpackedObjectMap[valuesArray[i]] = i\n\t\t\t}\n\t\t}\n\t\tif (sharedStructures) {\n\t\t\ttargetView.setUint32(position, 0xd9dffe00)\n\t\t\tposition += 3\n\t\t\tlet definitions = sharedStructures.slice(0)\n\t\t\tdefinitions.unshift(0xe000)\n\t\t\tdefinitions.push(new Tag(sharedData.version, 0x53687264))\n\t\t\tencode(definitions)\n\t\t} else\n\t\t\tencode(new Tag(sharedData.version, 0x53687264))\n\t\t}\n\t}]\nfunction typedArrayEncoder(tag, size) {\n\tif (!isLittleEndianMachine && size > 1)\n\t\ttag -= 4 // the big endian equivalents are 4 less\n\treturn {\n\t\ttag: tag,\n\t\tencode: function writeExtBuffer(typedArray, encode) {\n\t\t\tlet length = typedArray.byteLength\n\t\t\tlet offset = typedArray.byteOffset || 0\n\t\t\tlet buffer = typedArray.buffer || typedArray\n\t\t\tencode(hasNodeBuffer ? Buffer.from(buffer, offset, length) :\n\t\t\t\tnew Uint8Array(buffer, offset, length))\n\t\t}\n\t}\n}\nfunction writeBuffer(buffer, makeRoom) {\n\tlet length = buffer.byteLength\n\tif (length < 0x18) {\n\t\ttarget[position++] = 0x40 + length\n\t} else if (length < 0x100) {\n\t\ttarget[position++] = 0x58\n\t\ttarget[position++] = length\n\t} else if (length < 0x10000) {\n\t\ttarget[position++] = 0x59\n\t\ttarget[position++] = length >> 8\n\t\ttarget[position++] = length & 0xff\n\t} else {\n\t\ttarget[position++] = 0x5a\n\t\ttargetView.setUint32(position, length)\n\t\tposition += 4\n\t}\n\tif (position + length >= target.length) {\n\t\tmakeRoom(position + length)\n\t}\n\t// if it is already a typed array (has an ArrayBuffer), use that, but if it is an ArrayBuffer itself,\n\t// must wrap it to set it.\n\ttarget.set(buffer.buffer ? buffer : new Uint8Array(buffer), position)\n\tposition += length\n}\n\nfunction insertIds(serialized, idsToInsert) {\n\t// insert the ids that need to be referenced for structured clones\n\tlet nextId\n\tlet distanceToMove = idsToInsert.length * 2\n\tlet lastEnd = serialized.length - distanceToMove\n\tidsToInsert.sort((a, b) => a.offset > b.offset ? 1 : -1)\n\tfor (let id = 0; id < idsToInsert.length; id++) {\n\t\tlet referee = idsToInsert[id]\n\t\treferee.id = id\n\t\tfor (let position of referee.references) {\n\t\t\tserialized[position++] = id >> 8\n\t\t\tserialized[position] = id & 0xff\n\t\t}\n\t}\n\twhile (nextId = idsToInsert.pop()) {\n\t\tlet offset = nextId.offset\n\t\tserialized.copyWithin(offset + distanceToMove, offset, lastEnd)\n\t\tdistanceToMove -= 2\n\t\tlet position = offset + distanceToMove\n\t\tserialized[position++] = 0xd8\n\t\tserialized[position++] = 28 // http://cbor.schmorp.de/value-sharing\n\t\tlastEnd = offset\n\t}\n\treturn serialized\n}\nfunction writeBundles(start, encode) {\n\ttargetView.setUint32(bundledStrings.position + start, position - bundledStrings.position - start + 1) // the offset to bundle\n\tlet writeStrings = bundledStrings\n\tbundledStrings = null\n\tencode(writeStrings[0])\n\tencode(writeStrings[1])\n}\n\nexport function addExtension(extension) {\n\tif (extension.Class) {\n\t\tif (!extension.encode)\n\t\t\tthrow new Error('Extension has no encode function')\n\t\textensionClasses.unshift(extension.Class)\n\t\textensions.unshift(extension)\n\t}\n\tdecodeAddExtension(extension)\n}\nlet defaultEncoder = new Encoder({ useRecords: false })\nexport const encode = defaultEncoder.encode\nexport const encodeAsIterable = defaultEncoder.encodeAsIterable\nexport const encodeAsAsyncIterable = defaultEncoder.encodeAsAsyncIterable\nexport { FLOAT32_OPTIONS } from './decode.js'\nimport { FLOAT32_OPTIONS } from './decode.js'\nexport const { NEVER, ALWAYS, DECIMAL_ROUND, DECIMAL_FIT } = FLOAT32_OPTIONS\nexport const REUSE_BUFFER_MODE = 512\nexport const RESET_BUFFER_MODE = 1024\nexport const THROW_ON_ITERABLE = 2048\n\n\n","export class BinaryPackChunker {\n\treadonly chunkedMTU = 16300; // The original 60000 bytes setting does not work when sending data from Firefox to Chrome, which is \"cut off\" after 16384 bytes and delivered individually.\n\n\t// Binary stuff\n\n\tprivate _dataCount: number = 1;\n\n\tchunk = (\n\t\tblob: ArrayBuffer,\n\t): { __peerData: number; n: number; total: number; data: Uint8Array }[] => {\n\t\tconst chunks = [];\n\t\tconst size = blob.byteLength;\n\t\tconst total = Math.ceil(size / this.chunkedMTU);\n\n\t\tlet index = 0;\n\t\tlet start = 0;\n\n\t\twhile (start < size) {\n\t\t\tconst end = Math.min(size, start + this.chunkedMTU);\n\t\t\tconst b = blob.slice(start, end);\n\n\t\t\tconst chunk = {\n\t\t\t\t__peerData: this._dataCount,\n\t\t\t\tn: index,\n\t\t\t\tdata: b,\n\t\t\t\ttotal,\n\t\t\t};\n\n\t\t\tchunks.push(chunk);\n\n\t\t\tstart = end;\n\t\t\tindex++;\n\t\t}\n\n\t\tthis._dataCount++;\n\n\t\treturn chunks;\n\t};\n}\n\nexport function concatArrayBuffers(bufs: Uint8Array[]) {\n\tlet size = 0;\n\tfor (const buf of bufs) {\n\t\tsize += buf.byteLength;\n\t}\n\tconst result = new Uint8Array(size);\n\tlet offset = 0;\n\tfor (const buf of bufs) {\n\t\tresult.set(buf, offset);\n\t\toffset += buf.byteLength;\n\t}\n\treturn result;\n}\n","import webRTCAdapter_import from \"webrtc-adapter\";\n\nconst webRTCAdapter: typeof webRTCAdapter_import =\n\t//@ts-ignore\n\twebRTCAdapter_import.default || webRTCAdapter_import;\n\nexport const Supports = new (class {\n\treadonly isIOS = [\"iPad\", \"iPhone\", \"iPod\"].includes(navigator.platform);\n\treadonly supportedBrowsers = [\"firefox\", \"chrome\", \"safari\"];\n\n\treadonly minFirefoxVersion = 59;\n\treadonly minChromeVersion = 72;\n\treadonly minSafariVersion = 605;\n\n\tisWebRTCSupported(): boolean {\n\t\treturn typeof RTCPeerConnection !== \"undefined\";\n\t}\n\n\tisBrowserSupported(): boolean {\n\t\tconst browser = this.getBrowser();\n\t\tconst version = this.getVersion();\n\n\t\tconst validBrowser = this.supportedBrowsers.includes(browser);\n\n\t\tif (!validBrowser) return false;\n\n\t\tif (browser === \"chrome\") return version >= this.minChromeVersion;\n\t\tif (browser === \"firefox\") return version >= this.minFirefoxVersion;\n\t\tif (browser === \"safari\")\n\t\t\treturn !this.isIOS && version >= this.minSafariVersion;\n\n\t\treturn false;\n\t}\n\n\tgetBrowser(): string {\n\t\treturn webRTCAdapter.browserDetails.browser;\n\t}\n\n\tgetVersion(): number {\n\t\treturn webRTCAdapter.browserDetails.version || 0;\n\t}\n\n\tisUnifiedPlanSupported(): boolean {\n\t\tconst browser = this.getBrowser();\n\t\tconst version = webRTCAdapter.browserDetails.version || 0;\n\n\t\tif (browser === \"chrome\" && version < this.minChromeVersion) return false;\n\t\tif (browser === \"firefox\" && version >= this.minFirefoxVersion) return true;\n\t\tif (\n\t\t\t!window.RTCRtpTransceiver ||\n\t\t\t!(\"currentDirection\" in RTCRtpTransceiver.prototype)\n\t\t)\n\t\t\treturn false;\n\n\t\tlet tempPc: RTCPeerConnection;\n\t\tlet supported = false;\n\n\t\ttry {\n\t\t\ttempPc = new RTCPeerConnection();\n\t\t\ttempPc.addTransceiver(\"audio\");\n\t\t\tsupported = true;\n\t\t} catch (e) {\n\t\t} finally {\n\t\t\tif (tempPc) {\n\t\t\t\ttempPc.close();\n\t\t\t}\n\t\t}\n\n\t\treturn supported;\n\t}\n\n\ttoString(): string {\n\t\treturn `Supports:\n    browser:${this.getBrowser()}\n    version:${this.getVersion()}\n    isIOS:${this.isIOS}\n    isWebRTCSupported:${this.isWebRTCSupported()}\n    isBrowserSupported:${this.isBrowserSupported()}\n    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`;\n\t}\n})();\n","export const validateId = (id: string): boolean => {\n\t// Allow empty ids\n\treturn !id || /^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(id);\n};\n","export const randomToken = () => Math.random().toString(36).slice(2);\n","import { BinaryPackChunker } from \"./dataconnection/BufferedConnection/binaryPackChunker\";\nimport * as BinaryPack from \"peerjs-js-binarypack\";\nimport { Supports } from \"./supports\";\nimport { validateId } from \"./utils/validateId\";\nimport { randomToken } from \"./utils/randomToken\";\n\nexport interface UtilSupportsObj {\n\t/**\n\t * The current browser.\n\t * This property can be useful in determining whether two peers can connect.\n\t *\n\t * ```ts\n\t * if (util.browser === 'firefox') {\n\t *  // OK to peer with Firefox peers.\n\t * }\n\t * ```\n\t *\n\t * `util.browser` can currently have the values\n\t * `'firefox', 'chrome', 'safari', 'edge', 'Not a supported browser.', 'Not a browser.' (unknown WebRTC-compatible agent).\n\t */\n\tbrowser: boolean;\n\twebRTC: boolean;\n\t/**\n\t * True if the current browser supports media streams and PeerConnection.\n\t */\n\taudioVideo: boolean;\n\t/**\n\t * True if the current browser supports DataChannel and PeerConnection.\n\t */\n\tdata: boolean;\n\tbinaryBlob: boolean;\n\t/**\n\t * True if the current browser supports reliable DataChannels.\n\t */\n\treliable: boolean;\n}\n\nconst DEFAULT_CONFIG = {\n\ticeServers: [\n\t\t{ urls: \"stun:stun.l.google.com:19302\" },\n\t\t{\n\t\t\turls: [\n\t\t\t\t\"turn:eu-0.turn.peerjs.com:3478\",\n\t\t\t\t\"turn:us-0.turn.peerjs.com:3478\",\n\t\t\t],\n\t\t\tusername: \"peerjs\",\n\t\t\tcredential: \"peerjsp\",\n\t\t},\n\t],\n\tsdpSemantics: \"unified-plan\",\n};\n\nexport class Util extends BinaryPackChunker {\n\tnoop(): void {}\n\n\treadonly CLOUD_HOST = \"0.peerjs.com\";\n\treadonly CLOUD_PORT = 443;\n\n\t// Browsers that need chunking:\n\treadonly chunkedBrowsers = { Chrome: 1, chrome: 1 };\n\n\t// Returns browser-agnostic default config\n\treadonly defaultConfig = DEFAULT_CONFIG;\n\n\treadonly browser = Supports.getBrowser();\n\treadonly browserVersion = Supports.getVersion();\n\n\tpack = BinaryPack.pack;\n\tunpack = BinaryPack.unpack;\n\n\t/**\n\t * A hash of WebRTC features mapped to booleans that correspond to whether the feature is supported by the current browser.\n\t *\n\t * :::caution\n\t * Only the properties documented here are guaranteed to be present on `util.supports`\n\t * :::\n\t */\n\treadonly supports = (function () {\n\t\tconst supported: UtilSupportsObj = {\n\t\t\tbrowser: Supports.isBrowserSupported(),\n\t\t\twebRTC: Supports.isWebRTCSupported(),\n\t\t\taudioVideo: false,\n\t\t\tdata: false,\n\t\t\tbinaryBlob: false,\n\t\t\treliable: false,\n\t\t};\n\n\t\tif (!supported.webRTC) return supported;\n\n\t\tlet pc: RTCPeerConnection;\n\n\t\ttry {\n\t\t\tpc = new RTCPeerConnection(DEFAULT_CONFIG);\n\n\t\t\tsupported.audioVideo = true;\n\n\t\t\tlet dc: RTCDataChannel;\n\n\t\t\ttry {\n\t\t\t\tdc = pc.createDataChannel(\"_PEERJSTEST\", { ordered: true });\n\t\t\t\tsupported.data = true;\n\t\t\t\tsupported.reliable = !!dc.ordered;\n\n\t\t\t\t// Binary test\n\t\t\t\ttry {\n\t\t\t\t\tdc.binaryType = \"blob\";\n\t\t\t\t\tsupported.binaryBlob = !Supports.isIOS;\n\t\t\t\t} catch (e) {}\n\t\t\t} catch (e) {\n\t\t\t} finally {\n\t\t\t\tif (dc) {\n\t\t\t\t\tdc.close();\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t} finally {\n\t\t\tif (pc) {\n\t\t\t\tpc.close();\n\t\t\t}\n\t\t}\n\n\t\treturn supported;\n\t})();\n\n\t// Ensure alphanumeric ids\n\tvalidateId = validateId;\n\trandomToken = randomToken;\n\n\tblobToArrayBuffer(\n\t\tblob: Blob,\n\t\tcb: (arg: ArrayBuffer | null) => void,\n\t): FileReader {\n\t\tconst fr = new FileReader();\n\n\t\tfr.onload = function (evt) {\n\t\t\tif (evt.target) {\n\t\t\t\tcb(evt.target.result as ArrayBuffer);\n\t\t\t}\n\t\t};\n\n\t\tfr.readAsArrayBuffer(blob);\n\n\t\treturn fr;\n\t}\n\n\tbinaryStringToArrayBuffer(binary: string): ArrayBuffer | SharedArrayBuffer {\n\t\tconst byteArray = new Uint8Array(binary.length);\n\n\t\tfor (let i = 0; i < binary.length; i++) {\n\t\t\tbyteArray[i] = binary.charCodeAt(i) & 0xff;\n\t\t}\n\n\t\treturn byteArray.buffer;\n\t}\n\tisSecure(): boolean {\n\t\treturn location.protocol === \"https:\";\n\t}\n}\n\n/**\n * Provides a variety of helpful utilities.\n *\n * :::caution\n * Only the utilities documented here are guaranteed to be present on `util`.\n * Undocumented utilities can be removed without warning.\n * We don't consider these to be breaking changes.\n * :::\n */\nexport const util = new Util();\n","const LOG_PREFIX = \"PeerJS: \";\n\n/*\nPrints log messages depending on the debug level passed in. Defaults to 0.\n0  Prints no logs.\n1  Prints only errors.\n2  Prints errors and warnings.\n3  Prints all logs.\n*/\nexport enum LogLevel {\n\t/**\n\t * Prints no logs.\n\t */\n\tDisabled,\n\t/**\n\t * Prints only errors.\n\t */\n\tErrors,\n\t/**\n\t * Prints errors and warnings.\n\t */\n\tWarnings,\n\t/**\n\t * Prints all logs.\n\t */\n\tAll,\n}\n\nclass Logger {\n\tprivate _logLevel = LogLevel.Disabled;\n\n\tget logLevel(): LogLevel {\n\t\treturn this._logLevel;\n\t}\n\n\tset logLevel(logLevel: LogLevel) {\n\t\tthis._logLevel = logLevel;\n\t}\n\n\tlog(...args: any[]) {\n\t\tif (this._logLevel >= LogLevel.All) {\n\t\t\tthis._print(LogLevel.All, ...args);\n\t\t}\n\t}\n\n\twarn(...args: any[]) {\n\t\tif (this._logLevel >= LogLevel.Warnings) {\n\t\t\tthis._print(LogLevel.Warnings, ...args);\n\t\t}\n\t}\n\n\terror(...args: any[]) {\n\t\tif (this._logLevel >= LogLevel.Errors) {\n\t\t\tthis._print(LogLevel.Errors, ...args);\n\t\t}\n\t}\n\n\tsetLogFunction(fn: (logLevel: LogLevel, ..._: any[]) => void): void {\n\t\tthis._print = fn;\n\t}\n\n\tprivate _print(logLevel: LogLevel, ...rest: any[]): void {\n\t\tconst copy = [LOG_PREFIX, ...rest];\n\n\t\tfor (const i in copy) {\n\t\t\tif (copy[i] instanceof Error) {\n\t\t\t\tcopy[i] = \"(\" + copy[i].name + \") \" + copy[i].message;\n\t\t\t}\n\t\t}\n\n\t\tif (logLevel >= LogLevel.All) {\n\t\t\tconsole.log(...copy);\n\t\t} else if (logLevel >= LogLevel.Warnings) {\n\t\t\tconsole.warn(\"WARNING\", ...copy);\n\t\t} else if (logLevel >= LogLevel.Errors) {\n\t\t\tconsole.error(\"ERROR\", ...copy);\n\t\t}\n\t}\n}\n\nexport default new Logger();\n","'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","export enum ConnectionType {\n\tData = \"data\",\n\tMedia = \"media\",\n}\n\nexport enum PeerErrorType {\n\t/**\n\t * The client's browser does not support some or all WebRTC features that you are trying to use.\n\t */\n\tBrowserIncompatible = \"browser-incompatible\",\n\t/**\n\t * You've already disconnected this peer from the server and can no longer make any new connections on it.\n\t */\n\tDisconnected = \"disconnected\",\n\t/**\n\t * The ID passed into the Peer constructor contains illegal characters.\n\t */\n\tInvalidID = \"invalid-id\",\n\t/**\n\t * The API key passed into the Peer constructor contains illegal characters or is not in the system (cloud server only).\n\t */\n\tInvalidKey = \"invalid-key\",\n\t/**\n\t * Lost or cannot establish a connection to the signalling server.\n\t */\n\tNetwork = \"network\",\n\t/**\n\t * The peer you're trying to connect to does not exist.\n\t */\n\tPeerUnavailable = \"peer-unavailable\",\n\t/**\n\t * PeerJS is being used securely, but the cloud server does not support SSL. Use a custom PeerServer.\n\t */\n\tSslUnavailable = \"ssl-unavailable\",\n\t/**\n\t * Unable to reach the server.\n\t */\n\tServerError = \"server-error\",\n\t/**\n\t * An error from the underlying socket.\n\t */\n\tSocketError = \"socket-error\",\n\t/**\n\t * The underlying socket closed unexpectedly.\n\t */\n\tSocketClosed = \"socket-closed\",\n\t/**\n\t * The ID passed into the Peer constructor is already taken.\n\t *\n\t * :::caution\n\t * This error is not fatal if your peer has open peer-to-peer connections.\n\t * This can happen if you attempt to {@apilink Peer.reconnect} a peer that has been disconnected from the server,\n\t * but its old ID has now been taken.\n\t * :::\n\t */\n\tUnavailableID = \"unavailable-id\",\n\t/**\n\t * Native WebRTC errors.\n\t */\n\tWebRTC = \"webrtc\",\n}\n\nexport enum BaseConnectionErrorType {\n\tNegotiationFailed = \"negotiation-failed\",\n\tConnectionClosed = \"connection-closed\",\n}\n\nexport enum DataConnectionErrorType {\n\tNotOpenYet = \"not-open-yet\",\n\tMessageToBig = \"message-too-big\",\n}\n\nexport enum SerializationType {\n\tBinary = \"binary\",\n\tBinaryUTF8 = \"binary-utf8\",\n\tJSON = \"json\",\n\tNone = \"raw\",\n}\n\nexport enum SocketEventType {\n\tMessage = \"message\",\n\tDisconnected = \"disconnected\",\n\tError = \"error\",\n\tClose = \"close\",\n}\n\nexport enum ServerMessageType {\n\tHeartbeat = \"HEARTBEAT\",\n\tCandidate = \"CANDIDATE\",\n\tOffer = \"OFFER\",\n\tAnswer = \"ANSWER\",\n\tOpen = \"OPEN\", // The connection to the server is open.\n\tError = \"ERROR\", // Server error.\n\tIdTaken = \"ID-TAKEN\", // The selected ID is taken.\n\tInvalidKey = \"INVALID-KEY\", // The given API key cannot be found.\n\tLeave = \"LEAVE\", // Another peer has closed its connection to this peer.\n\tExpire = \"EXPIRE\", // The offer sent to a peer has expired without response.\n}\n","{\n\t\"name\": \"peerjs\",\n\t\"version\": \"1.5.1\",\n\t\"keywords\": [\n\t\t\"peerjs\",\n\t\t\"webrtc\",\n\t\t\"p2p\",\n\t\t\"rtc\"\n\t],\n\t\"description\": \"PeerJS client\",\n\t\"homepage\": \"https://peerjs.com\",\n\t\"bugs\": {\n\t\t\"url\": \"https://github.com/peers/peerjs/issues\"\n\t},\n\t\"repository\": {\n\t\t\"type\": \"git\",\n\t\t\"url\": \"https://github.com/peers/peerjs\"\n\t},\n\t\"license\": \"MIT\",\n\t\"contributors\": [\n\t\t\"Michelle Bu <michelle@michellebu.com>\",\n\t\t\"afrokick <devbyru@gmail.com>\",\n\t\t\"ericz <really.ez@gmail.com>\",\n\t\t\"Jairo <kidandcat@gmail.com>\",\n\t\t\"Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>\",\n\t\t\"Jairo Caro-Accino Viciana <jairo@galax.be>\",\n\t\t\"Carlos Caballero <carlos.caballero.gonzalez@gmail.com>\",\n\t\t\"hc <hheennrryy@gmail.com>\",\n\t\t\"Muhammad Asif <capripio@gmail.com>\",\n\t\t\"PrashoonB <prashoonbhattacharjee@gmail.com>\",\n\t\t\"Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>\",\n\t\t\"akotynski <aleksanderkotbury@gmail.com>\",\n\t\t\"lmb <i@lmb.io>\",\n\t\t\"Jairooo <jairocaro@msn.com>\",\n\t\t\"Moritz Stckler <moritz.stueckler@gmail.com>\",\n\t\t\"Simon <crydotsnakegithub@gmail.com>\",\n\t\t\"Denis Lukov <denismassters@gmail.com>\",\n\t\t\"Philipp Hancke <fippo@andyet.net>\",\n\t\t\"Hans Oksendahl <hansoksendahl@gmail.com>\",\n\t\t\"Jess <jessachandler@gmail.com>\",\n\t\t\"khankuan <khankuan@gmail.com>\",\n\t\t\"DUODVK <kurmanov.work@gmail.com>\",\n\t\t\"XiZhao <kwang1imsa@gmail.com>\",\n\t\t\"Matthias Lohr <matthias@lohr.me>\",\n\t\t\"=frank tree <=frnktrb@googlemail.com>\",\n\t\t\"Andre Eckardt <aeckardt@outlook.com>\",\n\t\t\"Chris Cowan <agentme49@gmail.com>\",\n\t\t\"Alex Chuev <alex@chuev.com>\",\n\t\t\"alxnull <alxnull@e.mail.de>\",\n\t\t\"Yemel Jardi <angel.jardi@gmail.com>\",\n\t\t\"Ben Parnell <benjaminparnell.94@gmail.com>\",\n\t\t\"Benny Lichtner <bennlich@gmail.com>\",\n\t\t\"fresheneesz <bitetrudpublic@gmail.com>\",\n\t\t\"bob.barstead@exaptive.com <bob.barstead@exaptive.com>\",\n\t\t\"chandika <chandika@gmail.com>\",\n\t\t\"emersion <contact@emersion.fr>\",\n\t\t\"Christopher Van <cvan@users.noreply.github.com>\",\n\t\t\"eddieherm <edhermoso@gmail.com>\",\n\t\t\"Eduardo Pinho <enet4mikeenet@gmail.com>\",\n\t\t\"Evandro Zanatta <ezanatta@tray.net.br>\",\n\t\t\"Gardner Bickford <gardner@users.noreply.github.com>\",\n\t\t\"Gian Luca <gianluca.cecchi@cynny.com>\",\n\t\t\"PatrickJS <github@gdi2290.com>\",\n\t\t\"jonnyf <github@jonathanfoss.co.uk>\",\n\t\t\"Hizkia Felix <hizkifw@gmail.com>\",\n\t\t\"Hristo Oskov <hristo.oskov@gmail.com>\",\n\t\t\"Isaac Madwed <i.madwed@gmail.com>\",\n\t\t\"Ilya Konanykhin <ilya.konanykhin@gmail.com>\",\n\t\t\"jasonbarry <jasbarry@me.com>\",\n\t\t\"Jonathan Burke <jonathan.burke.1311@googlemail.com>\",\n\t\t\"Josh Hamit <josh.hamit@gmail.com>\",\n\t\t\"Jordan Austin <jrax86@gmail.com>\",\n\t\t\"Joel Wetzell <jwetzell@yahoo.com>\",\n\t\t\"xizhao <kevin.wang@cloudera.com>\",\n\t\t\"Alberto Torres <kungfoobar@gmail.com>\",\n\t\t\"Jonathan Mayol <mayoljonathan@gmail.com>\",\n\t\t\"Jefferson Felix <me@jsfelix.dev>\",\n\t\t\"Rolf Erik Lekang <me@rolflekang.com>\",\n\t\t\"Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>\",\n\t\t\"Pepijn de Vos <pepijndevos@gmail.com>\",\n\t\t\"JooYoung <qkdlql@naver.com>\",\n\t\t\"Tobias Speicher <rootcommander@gmail.com>\",\n\t\t\"Steve Blaurock <sblaurock@gmail.com>\",\n\t\t\"Kyrylo Shegeda <shegeda@ualberta.ca>\",\n\t\t\"Diwank Singh Tomer <singh@diwank.name>\",\n\t\t\"Soren Balko <Soeren.Balko@gmail.com>\",\n\t\t\"Arpit Solanki <solankiarpit1997@gmail.com>\",\n\t\t\"Yuki Ito <yuki@gnnk.net>\",\n\t\t\"Artur Zayats <zag2art@gmail.com>\"\n\t],\n\t\"funding\": {\n\t\t\"type\": \"opencollective\",\n\t\t\"url\": \"https://opencollective.com/peer\"\n\t},\n\t\"collective\": {\n\t\t\"type\": \"opencollective\",\n\t\t\"url\": \"https://opencollective.com/peer\"\n\t},\n\t\"files\": [\n\t\t\"dist/*\"\n\t],\n\t\"sideEffects\": [\n\t\t\"lib/global.ts\",\n\t\t\"lib/supports.ts\"\n\t],\n\t\"main\": \"dist/bundler.cjs\",\n\t\"module\": \"dist/bundler.mjs\",\n\t\"browser-minified\": \"dist/peerjs.min.js\",\n\t\"browser-unminified\": \"dist/peerjs.js\",\n\t\"browser-minified-cbor\": \"dist/serializer.cbor.mjs\",\n\t\"browser-minified-msgpack\": \"dist/serializer.msgpack.mjs\",\n\t\"types\": \"dist/types.d.ts\",\n\t\"engines\": {\n\t\t\"node\": \">= 14\"\n\t},\n\t\"targets\": {\n\t\t\"types\": {\n\t\t\t\"source\": \"lib/exports.ts\"\n\t\t},\n\t\t\"main\": {\n\t\t\t\"source\": \"lib/exports.ts\",\n\t\t\t\"sourceMap\": {\n\t\t\t\t\"inlineSources\": true\n\t\t\t}\n\t\t},\n\t\t\"module\": {\n\t\t\t\"source\": \"lib/exports.ts\",\n\t\t\t\"includeNodeModules\": [\n\t\t\t\t\"eventemitter3\"\n\t\t\t],\n\t\t\t\"sourceMap\": {\n\t\t\t\t\"inlineSources\": true\n\t\t\t}\n\t\t},\n\t\t\"browser-minified\": {\n\t\t\t\"context\": \"browser\",\n\t\t\t\"outputFormat\": \"global\",\n\t\t\t\"optimize\": true,\n\t\t\t\"engines\": {\n\t\t\t\t\"browsers\": \"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15\"\n\t\t\t},\n\t\t\t\"source\": \"lib/global.ts\"\n\t\t},\n\t\t\"browser-unminified\": {\n\t\t\t\"context\": \"browser\",\n\t\t\t\"outputFormat\": \"global\",\n\t\t\t\"optimize\": false,\n\t\t\t\"engines\": {\n\t\t\t\t\"browsers\": \"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15\"\n\t\t\t},\n\t\t\t\"source\": \"lib/global.ts\"\n\t\t},\n\t\t\"browser-minified-cbor\": {\n\t\t\t\"context\": \"browser\",\n\t\t\t\"outputFormat\": \"esmodule\",\n\t\t\t\"isLibrary\": true,\n\t\t\t\"optimize\": true,\n\t\t\t\"engines\": {\n\t\t\t\t\"browsers\": \"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15\"\n\t\t\t},\n\t\t\t\"source\": \"lib/dataconnection/StreamConnection/Cbor.ts\"\n\t\t},\n\t\t\"browser-minified-msgpack\": {\n\t\t\t\"context\": \"browser\",\n\t\t\t\"outputFormat\": \"esmodule\",\n\t\t\t\"isLibrary\": true,\n\t\t\t\"optimize\": true,\n\t\t\t\"engines\": {\n\t\t\t\t\"browsers\": \"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15\"\n\t\t\t},\n\t\t\t\"source\": \"lib/dataconnection/StreamConnection/MsgPack.ts\"\n\t\t}\n\t},\n\t\"scripts\": {\n\t\t\"contributors\": \"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\\"chore(contributors): update and sort contributors list\\\"\",\n\t\t\"check\": \"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit\",\n\t\t\"watch\": \"parcel watch\",\n\t\t\"build\": \"rm -rf dist && parcel build\",\n\t\t\"prepublishOnly\": \"npm run build\",\n\t\t\"test\": \"jest\",\n\t\t\"test:watch\": \"jest --watch\",\n\t\t\"coverage\": \"jest --coverage --collectCoverageFrom=\\\"./lib/**\\\"\",\n\t\t\"format\": \"prettier --write .\",\n\t\t\"format:check\": \"prettier --check .\",\n\t\t\"semantic-release\": \"semantic-release\",\n\t\t\"e2e\": \"wdio run e2e/wdio.local.conf.ts\",\n\t\t\"e2e:bstack\": \"wdio run e2e/wdio.bstack.conf.ts\"\n\t},\n\t\"devDependencies\": {\n\t\t\"@parcel/config-default\": \"^2.9.3\",\n\t\t\"@parcel/packager-ts\": \"^2.9.3\",\n\t\t\"@parcel/transformer-typescript-tsc\": \"^2.9.3\",\n\t\t\"@parcel/transformer-typescript-types\": \"^2.9.3\",\n\t\t\"@semantic-release/changelog\": \"^6.0.1\",\n\t\t\"@semantic-release/git\": \"^10.0.1\",\n\t\t\"@swc/core\": \"^1.3.27\",\n\t\t\"@swc/jest\": \"^0.2.24\",\n\t\t\"@types/jasmine\": \"^4.3.4\",\n\t\t\"@wdio/browserstack-service\": \"^8.11.2\",\n\t\t\"@wdio/cli\": \"^8.11.2\",\n\t\t\"@wdio/globals\": \"^8.11.2\",\n\t\t\"@wdio/jasmine-framework\": \"^8.11.2\",\n\t\t\"@wdio/local-runner\": \"^8.11.2\",\n\t\t\"@wdio/spec-reporter\": \"^8.11.2\",\n\t\t\"@wdio/types\": \"^8.10.4\",\n\t\t\"http-server\": \"^14.1.1\",\n\t\t\"jest\": \"^29.3.1\",\n\t\t\"jest-environment-jsdom\": \"^29.3.1\",\n\t\t\"mock-socket\": \"^9.0.0\",\n\t\t\"parcel\": \"^2.9.3\",\n\t\t\"prettier\": \"^3.0.0\",\n\t\t\"semantic-release\": \"^21.0.0\",\n\t\t\"ts-node\": \"^10.9.1\",\n\t\t\"typescript\": \"^5.0.0\",\n\t\t\"wdio-geckodriver-service\": \"^5.0.1\"\n\t},\n\t\"dependencies\": {\n\t\t\"@msgpack/msgpack\": \"^2.8.0\",\n\t\t\"cbor-x\": \"^1.5.3\",\n\t\t\"eventemitter3\": \"^4.0.7\",\n\t\t\"peerjs-js-binarypack\": \"^2.0.0\",\n\t\t\"webrtc-adapter\": \"^8.0.0\"\n\t},\n\t\"alias\": {\n\t\t\"process\": false,\n\t\t\"buffer\": false\n\t}\n}\n","import { EventEmitter } from \"eventemitter3\";\nimport logger from \"./logger\";\nimport { ServerMessageType, SocketEventType } from \"./enums\";\nimport { version } from \"../package.json\";\n\n/**\n * An abstraction on top of WebSockets to provide fastest\n * possible connection for peers.\n */\nexport class Socket extends EventEmitter {\n\tprivate _disconnected: boolean = true;\n\tprivate _id?: string;\n\tprivate _messagesQueue: Array<object> = [];\n\tprivate _socket?: WebSocket;\n\tprivate _wsPingTimer?: any;\n\tprivate readonly _baseUrl: string;\n\n\tconstructor(\n\t\tsecure: any,\n\t\thost: string,\n\t\tport: number,\n\t\tpath: string,\n\t\tkey: string,\n\t\tprivate readonly pingInterval: number = 5000,\n\t) {\n\t\tsuper();\n\n\t\tconst wsProtocol = secure ? \"wss://\" : \"ws://\";\n\n\t\tthis._baseUrl = wsProtocol + host + \":\" + port + path + \"peerjs?key=\" + key;\n\t}\n\n\tstart(id: string, token: string): void {\n\t\tthis._id = id;\n\n\t\tconst wsUrl = `${this._baseUrl}&id=${id}&token=${token}`;\n\n\t\tif (!!this._socket || !this._disconnected) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._socket = new WebSocket(wsUrl + \"&version=\" + version);\n\t\tthis._disconnected = false;\n\n\t\tthis._socket.onmessage = (event) => {\n\t\t\tlet data;\n\n\t\t\ttry {\n\t\t\t\tdata = JSON.parse(event.data);\n\t\t\t\tlogger.log(\"Server message received:\", data);\n\t\t\t} catch (e) {\n\t\t\t\tlogger.log(\"Invalid server message\", event.data);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.emit(SocketEventType.Message, data);\n\t\t};\n\n\t\tthis._socket.onclose = (event) => {\n\t\t\tif (this._disconnected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.log(\"Socket closed.\", event);\n\n\t\t\tthis._cleanup();\n\t\t\tthis._disconnected = true;\n\n\t\t\tthis.emit(SocketEventType.Disconnected);\n\t\t};\n\n\t\t// Take care of the queue of connections if necessary and make sure Peer knows\n\t\t// socket is open.\n\t\tthis._socket.onopen = () => {\n\t\t\tif (this._disconnected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._sendQueuedMessages();\n\n\t\t\tlogger.log(\"Socket open\");\n\n\t\t\tthis._scheduleHeartbeat();\n\t\t};\n\t}\n\n\tprivate _scheduleHeartbeat(): void {\n\t\tthis._wsPingTimer = setTimeout(() => {\n\t\t\tthis._sendHeartbeat();\n\t\t}, this.pingInterval);\n\t}\n\n\tprivate _sendHeartbeat(): void {\n\t\tif (!this._wsOpen()) {\n\t\t\tlogger.log(`Cannot send heartbeat, because socket closed`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst message = JSON.stringify({ type: ServerMessageType.Heartbeat });\n\n\t\tthis._socket!.send(message);\n\n\t\tthis._scheduleHeartbeat();\n\t}\n\n\t/** Is the websocket currently open? */\n\tprivate _wsOpen(): boolean {\n\t\treturn !!this._socket && this._socket.readyState === 1;\n\t}\n\n\t/** Send queued messages. */\n\tprivate _sendQueuedMessages(): void {\n\t\t//Create copy of queue and clear it,\n\t\t//because send method push the message back to queue if smth will go wrong\n\t\tconst copiedQueue = [...this._messagesQueue];\n\t\tthis._messagesQueue = [];\n\n\t\tfor (const message of copiedQueue) {\n\t\t\tthis.send(message);\n\t\t}\n\t}\n\n\t/** Exposed send for DC & Peer. */\n\tsend(data: any): void {\n\t\tif (this._disconnected) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If we didn't get an ID yet, we can't yet send anything so we should queue\n\t\t// up these messages.\n\t\tif (!this._id) {\n\t\t\tthis._messagesQueue.push(data);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!data.type) {\n\t\t\tthis.emit(SocketEventType.Error, \"Invalid message\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._wsOpen()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst message = JSON.stringify(data);\n\n\t\tthis._socket!.send(message);\n\t}\n\n\tclose(): void {\n\t\tif (this._disconnected) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._cleanup();\n\n\t\tthis._disconnected = true;\n\t}\n\n\tprivate _cleanup(): void {\n\t\tif (this._socket) {\n\t\t\tthis._socket.onopen =\n\t\t\t\tthis._socket.onmessage =\n\t\t\t\tthis._socket.onclose =\n\t\t\t\t\tnull;\n\t\t\tthis._socket.close();\n\t\t\tthis._socket = undefined;\n\t\t}\n\n\t\tclearTimeout(this._wsPingTimer!);\n\t}\n}\n","import logger from \"./logger\";\nimport type { MediaConnection } from \"./mediaconnection\";\nimport type { DataConnection } from \"./dataconnection/DataConnection\";\nimport {\n\tBaseConnectionErrorType,\n\tConnectionType,\n\tPeerErrorType,\n\tServerMessageType,\n} from \"./enums\";\nimport type { BaseConnection, BaseConnectionEvents } from \"./baseconnection\";\nimport type { ValidEventTypes } from \"eventemitter3\";\n\n/**\n * Manages all negotiations between Peers.\n */\nexport class Negotiator<\n\tEvents extends ValidEventTypes,\n\tConnectionType extends BaseConnection<Events | BaseConnectionEvents>,\n> {\n\tconstructor(readonly connection: ConnectionType) {}\n\n\t/** Returns a PeerConnection object set up correctly (for data, media). */\n\tstartConnection(options: any) {\n\t\tconst peerConnection = this._startPeerConnection();\n\n\t\t// Set the connection's PC.\n\t\tthis.connection.peerConnection = peerConnection;\n\n\t\tif (this.connection.type === ConnectionType.Media && options._stream) {\n\t\t\tthis._addTracksToConnection(options._stream, peerConnection);\n\t\t}\n\n\t\t// What do we need to do now?\n\t\tif (options.originator) {\n\t\t\tconst dataConnection = this.connection;\n\n\t\t\tconst config: RTCDataChannelInit = { ordered: !!options.reliable };\n\n\t\t\tconst dataChannel = peerConnection.createDataChannel(\n\t\t\t\tdataConnection.label,\n\t\t\t\tconfig,\n\t\t\t);\n\t\t\tdataConnection._initializeDataChannel(dataChannel);\n\n\t\t\tvoid this._makeOffer();\n\t\t} else {\n\t\t\tvoid this.handleSDP(\"OFFER\", options.sdp);\n\t\t}\n\t}\n\n\t/** Start a PC. */\n\tprivate _startPeerConnection(): RTCPeerConnection {\n\t\tlogger.log(\"Creating RTCPeerConnection.\");\n\n\t\tconst peerConnection = new RTCPeerConnection(\n\t\t\tthis.connection.provider.options.config,\n\t\t);\n\n\t\tthis._setupListeners(peerConnection);\n\n\t\treturn peerConnection;\n\t}\n\n\t/** Set up various WebRTC listeners. */\n\tprivate _setupListeners(peerConnection: RTCPeerConnection) {\n\t\tconst peerId = this.connection.peer;\n\t\tconst connectionId = this.connection.connectionId;\n\t\tconst connectionType = this.connection.type;\n\t\tconst provider = this.connection.provider;\n\n\t\t// ICE CANDIDATES.\n\t\tlogger.log(\"Listening for ICE candidates.\");\n\n\t\tpeerConnection.onicecandidate = (evt) => {\n\t\t\tif (!evt.candidate || !evt.candidate.candidate) return;\n\n\t\t\tlogger.log(`Received ICE candidates for ${peerId}:`, evt.candidate);\n\n\t\t\tprovider.socket.send({\n\t\t\t\ttype: ServerMessageType.Candidate,\n\t\t\t\tpayload: {\n\t\t\t\t\tcandidate: evt.candidate,\n\t\t\t\t\ttype: connectionType,\n\t\t\t\t\tconnectionId: connectionId,\n\t\t\t\t},\n\t\t\t\tdst: peerId,\n\t\t\t});\n\t\t};\n\n\t\tpeerConnection.oniceconnectionstatechange = () => {\n\t\t\tswitch (peerConnection.iceConnectionState) {\n\t\t\t\tcase \"failed\":\n\t\t\t\t\tlogger.log(\n\t\t\t\t\t\t\"iceConnectionState is failed, closing connections to \" + peerId,\n\t\t\t\t\t);\n\t\t\t\t\tthis.connection.emitError(\n\t\t\t\t\t\tBaseConnectionErrorType.NegotiationFailed,\n\t\t\t\t\t\t\"Negotiation of connection to \" + peerId + \" failed.\",\n\t\t\t\t\t);\n\t\t\t\t\tthis.connection.close();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"closed\":\n\t\t\t\t\tlogger.log(\n\t\t\t\t\t\t\"iceConnectionState is closed, closing connections to \" + peerId,\n\t\t\t\t\t);\n\t\t\t\t\tthis.connection.emitError(\n\t\t\t\t\t\tBaseConnectionErrorType.ConnectionClosed,\n\t\t\t\t\t\t\"Connection to \" + peerId + \" closed.\",\n\t\t\t\t\t);\n\t\t\t\t\tthis.connection.close();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"disconnected\":\n\t\t\t\t\tlogger.log(\n\t\t\t\t\t\t\"iceConnectionState changed to disconnected on the connection with \" +\n\t\t\t\t\t\t\tpeerId,\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"completed\":\n\t\t\t\t\tpeerConnection.onicecandidate = () => {};\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tthis.connection.emit(\n\t\t\t\t\"iceStateChanged\",\n\t\t\t\tpeerConnection.iceConnectionState,\n\t\t\t);\n\t\t};\n\n\t\t// DATACONNECTION.\n\t\tlogger.log(\"Listening for data channel\");\n\t\t// Fired between offer and answer, so options should already be saved\n\t\t// in the options hash.\n\t\tpeerConnection.ondatachannel = (evt) => {\n\t\t\tlogger.log(\"Received data channel\");\n\n\t\t\tconst dataChannel = evt.channel;\n\t\t\tconst connection = <DataConnection>(\n\t\t\t\tprovider.getConnection(peerId, connectionId)\n\t\t\t);\n\n\t\t\tconnection._initializeDataChannel(dataChannel);\n\t\t};\n\n\t\t// MEDIACONNECTION.\n\t\tlogger.log(\"Listening for remote stream\");\n\n\t\tpeerConnection.ontrack = (evt) => {\n\t\t\tlogger.log(\"Received remote stream\");\n\n\t\t\tconst stream = evt.streams[0];\n\t\t\tconst connection = provider.getConnection(peerId, connectionId);\n\n\t\t\tif (connection.type === ConnectionType.Media) {\n\t\t\t\tconst mediaConnection = <MediaConnection>connection;\n\n\t\t\t\tthis._addStreamToMediaConnection(stream, mediaConnection);\n\t\t\t}\n\t\t};\n\t}\n\n\tcleanup(): void {\n\t\tlogger.log(\"Cleaning up PeerConnection to \" + this.connection.peer);\n\n\t\tconst peerConnection = this.connection.peerConnection;\n\n\t\tif (!peerConnection) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.connection.peerConnection = null;\n\n\t\t//unsubscribe from all PeerConnection's events\n\t\tpeerConnection.onicecandidate =\n\t\t\tpeerConnection.oniceconnectionstatechange =\n\t\t\tpeerConnection.ondatachannel =\n\t\t\tpeerConnection.ontrack =\n\t\t\t\t() => {};\n\n\t\tconst peerConnectionNotClosed = peerConnection.signalingState !== \"closed\";\n\t\tlet dataChannelNotClosed = false;\n\n\t\tconst dataChannel = this.connection.dataChannel;\n\n\t\tif (dataChannel) {\n\t\t\tdataChannelNotClosed =\n\t\t\t\t!!dataChannel.readyState && dataChannel.readyState !== \"closed\";\n\t\t}\n\n\t\tif (peerConnectionNotClosed || dataChannelNotClosed) {\n\t\t\tpeerConnection.close();\n\t\t}\n\t}\n\n\tprivate async _makeOffer(): Promise<void> {\n\t\tconst peerConnection = this.connection.peerConnection;\n\t\tconst provider = this.connection.provider;\n\n\t\ttry {\n\t\t\tconst offer = await peerConnection.createOffer(\n\t\t\t\tthis.connection.options.constraints,\n\t\t\t);\n\n\t\t\tlogger.log(\"Created offer.\");\n\n\t\t\tif (\n\t\t\t\tthis.connection.options.sdpTransform &&\n\t\t\t\ttypeof this.connection.options.sdpTransform === \"function\"\n\t\t\t) {\n\t\t\t\toffer.sdp =\n\t\t\t\t\tthis.connection.options.sdpTransform(offer.sdp) || offer.sdp;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tawait peerConnection.setLocalDescription(offer);\n\n\t\t\t\tlogger.log(\n\t\t\t\t\t\"Set localDescription:\",\n\t\t\t\t\toffer,\n\t\t\t\t\t`for:${this.connection.peer}`,\n\t\t\t\t);\n\n\t\t\t\tlet payload: any = {\n\t\t\t\t\tsdp: offer,\n\t\t\t\t\ttype: this.connection.type,\n\t\t\t\t\tconnectionId: this.connection.connectionId,\n\t\t\t\t\tmetadata: this.connection.metadata,\n\t\t\t\t};\n\n\t\t\t\tif (this.connection.type === ConnectionType.Data) {\n\t\t\t\t\tconst dataConnection = <DataConnection>(<unknown>this.connection);\n\n\t\t\t\t\tpayload = {\n\t\t\t\t\t\t...payload,\n\t\t\t\t\t\tlabel: dataConnection.label,\n\t\t\t\t\t\treliable: dataConnection.reliable,\n\t\t\t\t\t\tserialization: dataConnection.serialization,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tprovider.socket.send({\n\t\t\t\t\ttype: ServerMessageType.Offer,\n\t\t\t\t\tpayload,\n\t\t\t\t\tdst: this.connection.peer,\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\t// TODO: investigate why _makeOffer is being called from the answer\n\t\t\t\tif (\n\t\t\t\t\terr !=\n\t\t\t\t\t\"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer\"\n\t\t\t\t) {\n\t\t\t\t\tprovider.emitError(PeerErrorType.WebRTC, err);\n\t\t\t\t\tlogger.log(\"Failed to setLocalDescription, \", err);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err_1) {\n\t\t\tprovider.emitError(PeerErrorType.WebRTC, err_1);\n\t\t\tlogger.log(\"Failed to createOffer, \", err_1);\n\t\t}\n\t}\n\n\tprivate async _makeAnswer(): Promise<void> {\n\t\tconst peerConnection = this.connection.peerConnection;\n\t\tconst provider = this.connection.provider;\n\n\t\ttry {\n\t\t\tconst answer = await peerConnection.createAnswer();\n\t\t\tlogger.log(\"Created answer.\");\n\n\t\t\tif (\n\t\t\t\tthis.connection.options.sdpTransform &&\n\t\t\t\ttypeof this.connection.options.sdpTransform === \"function\"\n\t\t\t) {\n\t\t\t\tanswer.sdp =\n\t\t\t\t\tthis.connection.options.sdpTransform(answer.sdp) || answer.sdp;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tawait peerConnection.setLocalDescription(answer);\n\n\t\t\t\tlogger.log(\n\t\t\t\t\t`Set localDescription:`,\n\t\t\t\t\tanswer,\n\t\t\t\t\t`for:${this.connection.peer}`,\n\t\t\t\t);\n\n\t\t\t\tprovider.socket.send({\n\t\t\t\t\ttype: ServerMessageType.Answer,\n\t\t\t\t\tpayload: {\n\t\t\t\t\t\tsdp: answer,\n\t\t\t\t\t\ttype: this.connection.type,\n\t\t\t\t\t\tconnectionId: this.connection.connectionId,\n\t\t\t\t\t},\n\t\t\t\t\tdst: this.connection.peer,\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\tprovider.emitError(PeerErrorType.WebRTC, err);\n\t\t\t\tlogger.log(\"Failed to setLocalDescription, \", err);\n\t\t\t}\n\t\t} catch (err_1) {\n\t\t\tprovider.emitError(PeerErrorType.WebRTC, err_1);\n\t\t\tlogger.log(\"Failed to create answer, \", err_1);\n\t\t}\n\t}\n\n\t/** Handle an SDP. */\n\tasync handleSDP(type: string, sdp: any): Promise<void> {\n\t\tsdp = new RTCSessionDescription(sdp);\n\t\tconst peerConnection = this.connection.peerConnection;\n\t\tconst provider = this.connection.provider;\n\n\t\tlogger.log(\"Setting remote description\", sdp);\n\n\t\tconst self = this;\n\n\t\ttry {\n\t\t\tawait peerConnection.setRemoteDescription(sdp);\n\t\t\tlogger.log(`Set remoteDescription:${type} for:${this.connection.peer}`);\n\t\t\tif (type === \"OFFER\") {\n\t\t\t\tawait self._makeAnswer();\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tprovider.emitError(PeerErrorType.WebRTC, err);\n\t\t\tlogger.log(\"Failed to setRemoteDescription, \", err);\n\t\t}\n\t}\n\n\t/** Handle a candidate. */\n\tasync handleCandidate(ice: RTCIceCandidate) {\n\t\tlogger.log(`handleCandidate:`, ice);\n\n\t\ttry {\n\t\t\tawait this.connection.peerConnection.addIceCandidate(ice);\n\t\t\tlogger.log(`Added ICE candidate for:${this.connection.peer}`);\n\t\t} catch (err) {\n\t\t\tthis.connection.provider.emitError(PeerErrorType.WebRTC, err);\n\t\t\tlogger.log(\"Failed to handleCandidate, \", err);\n\t\t}\n\t}\n\n\tprivate _addTracksToConnection(\n\t\tstream: MediaStream,\n\t\tpeerConnection: RTCPeerConnection,\n\t): void {\n\t\tlogger.log(`add tracks from stream ${stream.id} to peer connection`);\n\n\t\tif (!peerConnection.addTrack) {\n\t\t\treturn logger.error(\n\t\t\t\t`Your browser does't support RTCPeerConnection#addTrack. Ignored.`,\n\t\t\t);\n\t\t}\n\n\t\tstream.getTracks().forEach((track) => {\n\t\t\tpeerConnection.addTrack(track, stream);\n\t\t});\n\t}\n\n\tprivate _addStreamToMediaConnection(\n\t\tstream: MediaStream,\n\t\tmediaConnection: MediaConnection,\n\t): void {\n\t\tlogger.log(\n\t\t\t`add stream ${stream.id} to media connection ${mediaConnection.connectionId}`,\n\t\t);\n\n\t\tmediaConnection.addStream(stream);\n\t}\n}\n","import { EventEmitter } from \"eventemitter3\";\nimport logger from \"./logger\";\n\nexport interface EventsWithError<ErrorType extends string> {\n\terror: (error: PeerError<`${ErrorType}`>) => void;\n}\n\nexport class EventEmitterWithError<\n\tErrorType extends string,\n\tEvents extends EventsWithError<ErrorType>,\n> extends EventEmitter<Events, never> {\n\t/**\n\t * Emits a typed error message.\n\t *\n\t * @internal\n\t */\n\temitError(type: ErrorType, err: string | Error): void {\n\t\tlogger.error(\"Error:\", err);\n\n\t\t// @ts-ignore\n\t\tthis.emit(\"error\", new PeerError<`${ErrorType}`>(`${type}`, err));\n\t}\n}\n/**\n * A PeerError is emitted whenever an error occurs.\n * It always has a `.type`, which can be used to identify the error.\n */\nexport class PeerError<T extends string> extends Error {\n\t/**\n\t * @internal\n\t */\n\tconstructor(type: T, err: Error | string) {\n\t\tif (typeof err === \"string\") {\n\t\t\tsuper(err);\n\t\t} else {\n\t\t\tsuper();\n\t\t\tObject.assign(this, err);\n\t\t}\n\n\t\tthis.type = type;\n\t}\n\n\tpublic type: T;\n}\n","import type { Peer } from \"./peer\";\nimport type { ServerMessage } from \"./servermessage\";\nimport type { ConnectionType } from \"./enums\";\nimport { BaseConnectionErrorType } from \"./enums\";\nimport {\n\tEventEmitterWithError,\n\ttype EventsWithError,\n\tPeerError,\n} from \"./peerError\";\nimport type { ValidEventTypes } from \"eventemitter3\";\n\nexport interface BaseConnectionEvents<\n\tErrorType extends string = BaseConnectionErrorType,\n> extends EventsWithError<ErrorType> {\n\t/**\n\t * Emitted when either you or the remote peer closes the connection.\n\t *\n\t * ```ts\n\t * connection.on('close', () => { ... });\n\t * ```\n\t */\n\tclose: () => void;\n\t/**\n\t * ```ts\n\t * connection.on('error', (error) => { ... });\n\t * ```\n\t */\n\terror: (error: PeerError<`${ErrorType}`>) => void;\n\ticeStateChanged: (state: RTCIceConnectionState) => void;\n}\n\nexport abstract class BaseConnection<\n\tSubClassEvents extends ValidEventTypes,\n\tErrorType extends string = never,\n> extends EventEmitterWithError<\n\tErrorType | BaseConnectionErrorType,\n\tSubClassEvents & BaseConnectionEvents<BaseConnectionErrorType | ErrorType>\n> {\n\tprotected _open = false;\n\n\t/**\n\t * Any type of metadata associated with the connection,\n\t * passed in by whoever initiated the connection.\n\t */\n\treadonly metadata: any;\n\tconnectionId: string;\n\n\tpeerConnection: RTCPeerConnection;\n\tdataChannel: RTCDataChannel;\n\n\tabstract get type(): ConnectionType;\n\n\t/**\n\t * The optional label passed in or assigned by PeerJS when the connection was initiated.\n\t */\n\tlabel: string;\n\n\t/**\n\t * Whether the media connection is active (e.g. your call has been answered).\n\t * You can check this if you want to set a maximum wait time for a one-sided call.\n\t */\n\tget open() {\n\t\treturn this._open;\n\t}\n\n\tprotected constructor(\n\t\t/**\n\t\t * The ID of the peer on the other end of this connection.\n\t\t */\n\t\treadonly peer: string,\n\t\tpublic provider: Peer,\n\t\treadonly options: any,\n\t) {\n\t\tsuper();\n\n\t\tthis.metadata = options.metadata;\n\t}\n\n\tabstract close(): void;\n\n\t/**\n\t * @internal\n\t */\n\tabstract handleMessage(message: ServerMessage): void;\n\n\t/**\n\t * Called by the Negotiator when the DataChannel is ready.\n\t * @internal\n\t * */\n\tabstract _initializeDataChannel(dc: RTCDataChannel): void;\n}\n","import { util } from \"./util\";\nimport logger from \"./logger\";\nimport { Negotiator } from \"./negotiator\";\nimport { ConnectionType, ServerMessageType } from \"./enums\";\nimport type { Peer } from \"./peer\";\nimport { BaseConnection, type BaseConnectionEvents } from \"./baseconnection\";\nimport type { ServerMessage } from \"./servermessage\";\nimport type { AnswerOption } from \"./optionInterfaces\";\n\nexport interface MediaConnectionEvents extends BaseConnectionEvents<never> {\n\t/**\n\t * Emitted when a connection to the PeerServer is established.\n\t *\n\t * ```ts\n\t * mediaConnection.on('stream', (stream) => { ... });\n\t * ```\n\t */\n\tstream: (stream: MediaStream) => void;\n\t/**\n\t * Emitted when the auxiliary data channel is established.\n\t * After this event, hanging up will close the connection cleanly on the remote peer.\n\t * @beta\n\t */\n\twillCloseOnRemote: () => void;\n}\n\n/**\n * Wraps WebRTC's media streams.\n * To get one, use {@apilink Peer.call} or listen for the {@apilink PeerEvents | `call`} event.\n */\nexport class MediaConnection extends BaseConnection<MediaConnectionEvents> {\n\tprivate static readonly ID_PREFIX = \"mc_\";\n\treadonly label: string;\n\n\tprivate _negotiator: Negotiator<MediaConnectionEvents, this>;\n\tprivate _localStream: MediaStream;\n\tprivate _remoteStream: MediaStream;\n\n\t/**\n\t * For media connections, this is always 'media'.\n\t */\n\tget type() {\n\t\treturn ConnectionType.Media;\n\t}\n\n\tget localStream(): MediaStream {\n\t\treturn this._localStream;\n\t}\n\n\tget remoteStream(): MediaStream {\n\t\treturn this._remoteStream;\n\t}\n\n\tconstructor(peerId: string, provider: Peer, options: any) {\n\t\tsuper(peerId, provider, options);\n\n\t\tthis._localStream = this.options._stream;\n\t\tthis.connectionId =\n\t\t\tthis.options.connectionId ||\n\t\t\tMediaConnection.ID_PREFIX + util.randomToken();\n\n\t\tthis._negotiator = new Negotiator(this);\n\n\t\tif (this._localStream) {\n\t\t\tthis._negotiator.startConnection({\n\t\t\t\t_stream: this._localStream,\n\t\t\t\toriginator: true,\n\t\t\t});\n\t\t}\n\t}\n\n\t/** Called by the Negotiator when the DataChannel is ready. */\n\toverride _initializeDataChannel(dc: RTCDataChannel): void {\n\t\tthis.dataChannel = dc;\n\n\t\tthis.dataChannel.onopen = () => {\n\t\t\tlogger.log(`DC#${this.connectionId} dc connection success`);\n\t\t\tthis.emit(\"willCloseOnRemote\");\n\t\t};\n\n\t\tthis.dataChannel.onclose = () => {\n\t\t\tlogger.log(`DC#${this.connectionId} dc closed for:`, this.peer);\n\t\t\tthis.close();\n\t\t};\n\t}\n\taddStream(remoteStream) {\n\t\tlogger.log(\"Receiving stream\", remoteStream);\n\n\t\tthis._remoteStream = remoteStream;\n\t\tsuper.emit(\"stream\", remoteStream); // Should we call this `open`?\n\t}\n\n\t/**\n\t * @internal\n\t */\n\thandleMessage(message: ServerMessage): void {\n\t\tconst type = message.type;\n\t\tconst payload = message.payload;\n\n\t\tswitch (message.type) {\n\t\t\tcase ServerMessageType.Answer:\n\t\t\t\t// Forward to negotiator\n\t\t\t\tvoid this._negotiator.handleSDP(type, payload.sdp);\n\t\t\t\tthis._open = true;\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Candidate:\n\t\t\t\tvoid this._negotiator.handleCandidate(payload.candidate);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tlogger.warn(`Unrecognized message type:${type} from peer:${this.peer}`);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n     * When receiving a {@apilink PeerEvents | `call`} event on a peer, you can call\n     * `answer` on the media connection provided by the callback to accept the call\n     * and optionally send your own media stream.\n\n     *\n     * @param stream A WebRTC media stream.\n     * @param options\n     * @returns\n     */\n\tanswer(stream?: MediaStream, options: AnswerOption = {}): void {\n\t\tif (this._localStream) {\n\t\t\tlogger.warn(\n\t\t\t\t\"Local stream already exists on this MediaConnection. Are you answering a call twice?\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._localStream = stream;\n\n\t\tif (options && options.sdpTransform) {\n\t\t\tthis.options.sdpTransform = options.sdpTransform;\n\t\t}\n\n\t\tthis._negotiator.startConnection({\n\t\t\t...this.options._payload,\n\t\t\t_stream: stream,\n\t\t});\n\t\t// Retrieve lost messages stored because PeerConnection not set up.\n\t\tconst messages = this.provider._getMessages(this.connectionId);\n\n\t\tfor (const message of messages) {\n\t\t\tthis.handleMessage(message);\n\t\t}\n\n\t\tthis._open = true;\n\t}\n\n\t/**\n\t * Exposed functionality for users.\n\t */\n\n\t/**\n\t * Closes the media connection.\n\t */\n\tclose(): void {\n\t\tif (this._negotiator) {\n\t\t\tthis._negotiator.cleanup();\n\t\t\tthis._negotiator = null;\n\t\t}\n\n\t\tthis._localStream = null;\n\t\tthis._remoteStream = null;\n\n\t\tif (this.provider) {\n\t\t\tthis.provider._removeConnection(this);\n\n\t\t\tthis.provider = null;\n\t\t}\n\n\t\tif (this.options && this.options._stream) {\n\t\t\tthis.options._stream = null;\n\t\t}\n\n\t\tif (!this.open) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._open = false;\n\n\t\tsuper.emit(\"close\");\n\t}\n}\n","import { util } from \"./util\";\nimport logger from \"./logger\";\nimport type { PeerJSOption } from \"./optionInterfaces\";\nimport { version } from \"../package.json\";\n\nexport class API {\n\tconstructor(private readonly _options: PeerJSOption) {}\n\n\tprivate _buildRequest(method: string): Promise<Response> {\n\t\tconst protocol = this._options.secure ? \"https\" : \"http\";\n\t\tconst { host, port, path, key } = this._options;\n\t\tconst url = new URL(`${protocol}://${host}:${port}${path}${key}/${method}`);\n\t\t// TODO: Why timestamp, why random?\n\t\turl.searchParams.set(\"ts\", `${Date.now()}${Math.random()}`);\n\t\turl.searchParams.set(\"version\", version);\n\t\treturn fetch(url.href, {\n\t\t\treferrerPolicy: this._options.referrerPolicy,\n\t\t});\n\t}\n\n\t/** Get a unique ID from the server via XHR and initialize with it. */\n\tasync retrieveId(): Promise<string> {\n\t\ttry {\n\t\t\tconst response = await this._buildRequest(\"id\");\n\n\t\t\tif (response.status !== 200) {\n\t\t\t\tthrow new Error(`Error. Status:${response.status}`);\n\t\t\t}\n\n\t\t\treturn response.text();\n\t\t} catch (error) {\n\t\t\tlogger.error(\"Error retrieving ID\", error);\n\n\t\t\tlet pathError = \"\";\n\n\t\t\tif (\n\t\t\t\tthis._options.path === \"/\" &&\n\t\t\t\tthis._options.host !== util.CLOUD_HOST\n\t\t\t) {\n\t\t\t\tpathError =\n\t\t\t\t\t\" If you passed in a `path` to your self-hosted PeerServer, \" +\n\t\t\t\t\t\"you'll also need to pass in that same path when creating a new \" +\n\t\t\t\t\t\"Peer.\";\n\t\t\t}\n\n\t\t\tthrow new Error(\"Could not get an ID from the server.\" + pathError);\n\t\t}\n\t}\n\n\t/** @deprecated */\n\tasync listAllPeers(): Promise<any[]> {\n\t\ttry {\n\t\t\tconst response = await this._buildRequest(\"peers\");\n\n\t\t\tif (response.status !== 200) {\n\t\t\t\tif (response.status === 401) {\n\t\t\t\t\tlet helpfulError = \"\";\n\n\t\t\t\t\tif (this._options.host === util.CLOUD_HOST) {\n\t\t\t\t\t\thelpfulError =\n\t\t\t\t\t\t\t\"It looks like you're using the cloud server. You can email \" +\n\t\t\t\t\t\t\t\"team@peerjs.com to enable peer listing for your API key.\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\thelpfulError =\n\t\t\t\t\t\t\t\"You need to enable `allow_discovery` on your self-hosted \" +\n\t\t\t\t\t\t\t\"PeerServer to use this feature.\";\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\"It doesn't look like you have permission to list peers IDs. \" +\n\t\t\t\t\t\t\thelpfulError,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthrow new Error(`Error. Status:${response.status}`);\n\t\t\t}\n\n\t\t\treturn response.json();\n\t\t} catch (error) {\n\t\t\tlogger.error(\"Error retrieving list peers\", error);\n\n\t\t\tthrow new Error(\"Could not get list peers from the server.\" + error);\n\t\t}\n\t}\n}\n","import logger from \"../logger\";\nimport { Negotiator } from \"../negotiator\";\nimport {\n\tBaseConnectionErrorType,\n\tConnectionType,\n\tDataConnectionErrorType,\n\tServerMessageType,\n} from \"../enums\";\nimport type { Peer } from \"../peer\";\nimport { BaseConnection, type BaseConnectionEvents } from \"../baseconnection\";\nimport type { ServerMessage } from \"../servermessage\";\nimport type { EventsWithError } from \"../peerError\";\nimport { randomToken } from \"../utils/randomToken\";\n\nexport interface DataConnectionEvents\n\textends EventsWithError<DataConnectionErrorType | BaseConnectionErrorType>,\n\t\tBaseConnectionEvents<DataConnectionErrorType | BaseConnectionErrorType> {\n\t/**\n\t * Emitted when data is received from the remote peer.\n\t */\n\tdata: (data: unknown) => void;\n\t/**\n\t * Emitted when the connection is established and ready-to-use.\n\t */\n\topen: () => void;\n}\n\n/**\n * Wraps a DataChannel between two Peers.\n */\nexport abstract class DataConnection extends BaseConnection<\n\tDataConnectionEvents,\n\tDataConnectionErrorType\n> {\n\tprotected static readonly ID_PREFIX = \"dc_\";\n\tprotected static readonly MAX_BUFFERED_AMOUNT = 8 * 1024 * 1024;\n\n\tprivate _negotiator: Negotiator<DataConnectionEvents, this>;\n\tabstract readonly serialization: string;\n\treadonly reliable: boolean;\n\n\tpublic get type() {\n\t\treturn ConnectionType.Data;\n\t}\n\n\tconstructor(peerId: string, provider: Peer, options: any) {\n\t\tsuper(peerId, provider, options);\n\n\t\tthis.connectionId =\n\t\t\tthis.options.connectionId || DataConnection.ID_PREFIX + randomToken();\n\n\t\tthis.label = this.options.label || this.connectionId;\n\t\tthis.reliable = !!this.options.reliable;\n\n\t\tthis._negotiator = new Negotiator(this);\n\n\t\tthis._negotiator.startConnection(\n\t\t\tthis.options._payload || {\n\t\t\t\toriginator: true,\n\t\t\t\treliable: this.reliable,\n\t\t\t},\n\t\t);\n\t}\n\n\t/** Called by the Negotiator when the DataChannel is ready. */\n\toverride _initializeDataChannel(dc: RTCDataChannel): void {\n\t\tthis.dataChannel = dc;\n\n\t\tthis.dataChannel.onopen = () => {\n\t\t\tlogger.log(`DC#${this.connectionId} dc connection success`);\n\t\t\tthis._open = true;\n\t\t\tthis.emit(\"open\");\n\t\t};\n\n\t\tthis.dataChannel.onmessage = (e) => {\n\t\t\tlogger.log(`DC#${this.connectionId} dc onmessage:`, e.data);\n\t\t\t// this._handleDataMessage(e);\n\t\t};\n\n\t\tthis.dataChannel.onclose = () => {\n\t\t\tlogger.log(`DC#${this.connectionId} dc closed for:`, this.peer);\n\t\t\tthis.close();\n\t\t};\n\t}\n\n\t/**\n\t * Exposed functionality for users.\n\t */\n\n\t/** Allows user to close connection. */\n\tclose(options?: { flush?: boolean }): void {\n\t\tif (options?.flush) {\n\t\t\tthis.send({\n\t\t\t\t__peerData: {\n\t\t\t\t\ttype: \"close\",\n\t\t\t\t},\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tif (this._negotiator) {\n\t\t\tthis._negotiator.cleanup();\n\t\t\tthis._negotiator = null;\n\t\t}\n\n\t\tif (this.provider) {\n\t\t\tthis.provider._removeConnection(this);\n\n\t\t\tthis.provider = null;\n\t\t}\n\n\t\tif (this.dataChannel) {\n\t\t\tthis.dataChannel.onopen = null;\n\t\t\tthis.dataChannel.onmessage = null;\n\t\t\tthis.dataChannel.onclose = null;\n\t\t\tthis.dataChannel = null;\n\t\t}\n\n\t\tif (!this.open) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._open = false;\n\n\t\tsuper.emit(\"close\");\n\t}\n\n\tprotected abstract _send(data: any, chunked: boolean): void | Promise<void>;\n\n\t/** Allows user to send data. */\n\tpublic send(data: any, chunked = false) {\n\t\tif (!this.open) {\n\t\t\tthis.emitError(\n\t\t\t\tDataConnectionErrorType.NotOpenYet,\n\t\t\t\t\"Connection is not open. You should listen for the `open` event before sending messages.\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\treturn this._send(data, chunked);\n\t}\n\n\tasync handleMessage(message: ServerMessage) {\n\t\tconst payload = message.payload;\n\n\t\tswitch (message.type) {\n\t\t\tcase ServerMessageType.Answer:\n\t\t\t\tawait this._negotiator.handleSDP(message.type, payload.sdp);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Candidate:\n\t\t\t\tawait this._negotiator.handleCandidate(payload.candidate);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tlogger.warn(\n\t\t\t\t\t\"Unrecognized message type:\",\n\t\t\t\t\tmessage.type,\n\t\t\t\t\t\"from peer:\",\n\t\t\t\t\tthis.peer,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n","import logger from \"../../logger\";\nimport { DataConnection } from \"../DataConnection\";\n\nexport abstract class BufferedConnection extends DataConnection {\n\tprivate _buffer: any[] = [];\n\tprivate _bufferSize = 0;\n\tprivate _buffering = false;\n\n\tpublic get bufferSize(): number {\n\t\treturn this._bufferSize;\n\t}\n\n\tpublic override _initializeDataChannel(dc: RTCDataChannel) {\n\t\tsuper._initializeDataChannel(dc);\n\t\tthis.dataChannel.binaryType = \"arraybuffer\";\n\t\tthis.dataChannel.addEventListener(\"message\", (e) =>\n\t\t\tthis._handleDataMessage(e),\n\t\t);\n\t}\n\n\tprotected abstract _handleDataMessage(e: MessageEvent): void;\n\n\tprotected _bufferedSend(msg: ArrayBuffer): void {\n\t\tif (this._buffering || !this._trySend(msg)) {\n\t\t\tthis._buffer.push(msg);\n\t\t\tthis._bufferSize = this._buffer.length;\n\t\t}\n\t}\n\n\t// Returns true if the send succeeds.\n\tprivate _trySend(msg: ArrayBuffer): boolean {\n\t\tif (!this.open) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.dataChannel.bufferedAmount > DataConnection.MAX_BUFFERED_AMOUNT) {\n\t\t\tthis._buffering = true;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis._buffering = false;\n\t\t\t\tthis._tryBuffer();\n\t\t\t}, 50);\n\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tthis.dataChannel.send(msg);\n\t\t} catch (e) {\n\t\t\tlogger.error(`DC#:${this.connectionId} Error when sending:`, e);\n\t\t\tthis._buffering = true;\n\n\t\t\tthis.close();\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t// Try to send the first message in the buffer.\n\tprivate _tryBuffer(): void {\n\t\tif (!this.open) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._buffer.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst msg = this._buffer[0];\n\n\t\tif (this._trySend(msg)) {\n\t\t\tthis._buffer.shift();\n\t\t\tthis._bufferSize = this._buffer.length;\n\t\t\tthis._tryBuffer();\n\t\t}\n\t}\n\n\tpublic override close(options?: { flush?: boolean }) {\n\t\tif (options?.flush) {\n\t\t\tthis.send({\n\t\t\t\t__peerData: {\n\t\t\t\t\ttype: \"close\",\n\t\t\t\t},\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tthis._buffer = [];\n\t\tthis._bufferSize = 0;\n\t\tsuper.close();\n\t}\n}\n","import { BinaryPackChunker, concatArrayBuffers } from \"./binaryPackChunker\";\nimport logger from \"../../logger\";\nimport type { Peer } from \"../../peer\";\nimport { BufferedConnection } from \"./BufferedConnection\";\nimport { SerializationType } from \"../../enums\";\nimport { pack, type Packable, unpack } from \"peerjs-js-binarypack\";\n\nexport class BinaryPack extends BufferedConnection {\n\tprivate readonly chunker = new BinaryPackChunker();\n\treadonly serialization = SerializationType.Binary;\n\n\tprivate _chunkedData: {\n\t\t[id: number]: {\n\t\t\tdata: Uint8Array[];\n\t\t\tcount: number;\n\t\t\ttotal: number;\n\t\t};\n\t} = {};\n\n\tpublic override close(options?: { flush?: boolean }) {\n\t\tsuper.close(options);\n\t\tthis._chunkedData = {};\n\t}\n\n\tconstructor(peerId: string, provider: Peer, options: any) {\n\t\tsuper(peerId, provider, options);\n\t}\n\n\t// Handles a DataChannel message.\n\tprotected override _handleDataMessage({ data }: { data: Uint8Array }): void {\n\t\tconst deserializedData = unpack(data);\n\n\t\t// PeerJS specific message\n\t\tconst peerData = deserializedData[\"__peerData\"];\n\t\tif (peerData) {\n\t\t\tif (peerData.type === \"close\") {\n\t\t\t\tthis.close();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Chunked data -- piece things back together.\n\t\t\t// @ts-ignore\n\t\t\tthis._handleChunk(deserializedData);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.emit(\"data\", deserializedData);\n\t}\n\n\tprivate _handleChunk(data: {\n\t\t__peerData: number;\n\t\tn: number;\n\t\ttotal: number;\n\t\tdata: ArrayBuffer;\n\t}): void {\n\t\tconst id = data.__peerData;\n\t\tconst chunkInfo = this._chunkedData[id] || {\n\t\t\tdata: [],\n\t\t\tcount: 0,\n\t\t\ttotal: data.total,\n\t\t};\n\n\t\tchunkInfo.data[data.n] = new Uint8Array(data.data);\n\t\tchunkInfo.count++;\n\t\tthis._chunkedData[id] = chunkInfo;\n\n\t\tif (chunkInfo.total === chunkInfo.count) {\n\t\t\t// Clean up before making the recursive call to `_handleDataMessage`.\n\t\t\tdelete this._chunkedData[id];\n\n\t\t\t// We've received all the chunks--time to construct the complete data.\n\t\t\t// const data = new Blob(chunkInfo.data);\n\t\t\tconst data = concatArrayBuffers(chunkInfo.data);\n\t\t\tthis._handleDataMessage({ data });\n\t\t}\n\t}\n\n\tprotected override _send(\n\t\tdata: Packable,\n\t\tchunked: boolean,\n\t): void | Promise<void> {\n\t\tif (data instanceof Blob) {\n\t\t\treturn data.arrayBuffer().then((buffer) => {\n\t\t\t\tthis._send(buffer, chunked);\n\t\t\t});\n\t\t}\n\t\tconst blob = pack(data);\n\n\t\tif (!chunked && blob.byteLength > this.chunker.chunkedMTU) {\n\t\t\tthis._sendChunks(blob);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._bufferedSend(blob);\n\t}\n\n\tprivate _sendChunks(blob: ArrayBuffer) {\n\t\tconst blobs = this.chunker.chunk(blob);\n\t\tlogger.log(`DC#${this.connectionId} Try to send ${blobs.length} chunks...`);\n\n\t\tfor (const blob of blobs) {\n\t\t\tthis.send(blob, true);\n\t\t}\n\t}\n}\n","import { BufferedConnection } from \"./BufferedConnection\";\nimport { SerializationType } from \"../../enums\";\n\nexport class Raw extends BufferedConnection {\n\treadonly serialization = SerializationType.None;\n\n\tprotected _handleDataMessage({ data }) {\n\t\tsuper.emit(\"data\", data);\n\t}\n\n\toverride _send(data, _chunked) {\n\t\tthis._bufferedSend(data);\n\t}\n}\n","import { BufferedConnection } from \"./BufferedConnection\";\nimport { DataConnectionErrorType, SerializationType } from \"../../enums\";\nimport { util } from \"../../util\";\n\nexport class Json extends BufferedConnection {\n\treadonly serialization = SerializationType.JSON;\n\tprivate readonly encoder = new TextEncoder();\n\tprivate readonly decoder = new TextDecoder();\n\n\tstringify: (data: any) => string = JSON.stringify;\n\tparse: (data: string) => any = JSON.parse;\n\n\t// Handles a DataChannel message.\n\tprotected override _handleDataMessage({ data }: { data: Uint8Array }): void {\n\t\tconst deserializedData = this.parse(this.decoder.decode(data));\n\n\t\t// PeerJS specific message\n\t\tconst peerData = deserializedData[\"__peerData\"];\n\t\tif (peerData && peerData.type === \"close\") {\n\t\t\tthis.close();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.emit(\"data\", deserializedData);\n\t}\n\n\toverride _send(data, _chunked) {\n\t\tconst encodedData = this.encoder.encode(this.stringify(data));\n\t\tif (encodedData.byteLength >= util.chunkedMTU) {\n\t\t\tthis.emitError(\n\t\t\t\tDataConnectionErrorType.MessageToBig,\n\t\t\t\t\"Message too big for JSON channel\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\tthis._bufferedSend(encodedData);\n\t}\n}\n","import { util } from \"./util\";\nimport logger, { LogLevel } from \"./logger\";\nimport { Socket } from \"./socket\";\nimport { MediaConnection } from \"./mediaconnection\";\nimport type { DataConnection } from \"./dataconnection/DataConnection\";\nimport {\n\tConnectionType,\n\tPeerErrorType,\n\tServerMessageType,\n\tSocketEventType,\n} from \"./enums\";\nimport type { ServerMessage } from \"./servermessage\";\nimport { API } from \"./api\";\nimport type {\n\tCallOption,\n\tPeerConnectOption,\n\tPeerJSOption,\n} from \"./optionInterfaces\";\nimport { BinaryPack } from \"./dataconnection/BufferedConnection/BinaryPack\";\nimport { Raw } from \"./dataconnection/BufferedConnection/Raw\";\nimport { Json } from \"./dataconnection/BufferedConnection/Json\";\n\nimport { EventEmitterWithError, PeerError } from \"./peerError\";\n\nclass PeerOptions implements PeerJSOption {\n\t/**\n\t * Prints log messages depending on the debug level passed in.\n\t */\n\tdebug?: LogLevel;\n\t/**\n\t * Server host. Defaults to `0.peerjs.com`.\n\t * Also accepts `'/'` to signify relative hostname.\n\t */\n\thost?: string;\n\t/**\n\t * Server port. Defaults to `443`.\n\t */\n\tport?: number;\n\t/**\n\t * The path where your self-hosted PeerServer is running. Defaults to `'/'`\n\t */\n\tpath?: string;\n\t/**\n\t * API key for the PeerServer.\n\t * This is not used anymore.\n\t * @deprecated\n\t */\n\tkey?: string;\n\ttoken?: string;\n\t/**\n\t * Configuration hash passed to RTCPeerConnection.\n\t * This hash contains any custom ICE/TURN server configuration.\n\t *\n\t * Defaults to {@apilink util.defaultConfig}\n\t */\n\tconfig?: any;\n\t/**\n\t * Set to true `true` if you're using TLS.\n\t * :::danger\n\t * If possible *always use TLS*\n\t * :::\n\t */\n\tsecure?: boolean;\n\tpingInterval?: number;\n\treferrerPolicy?: ReferrerPolicy;\n\tlogFunction?: (logLevel: LogLevel, ...rest: any[]) => void;\n\tserializers?: SerializerMapping;\n}\n\nexport { type PeerOptions };\n\nexport interface SerializerMapping {\n\t[key: string]: new (\n\t\tpeerId: string,\n\t\tprovider: Peer,\n\t\toptions: any,\n\t) => DataConnection;\n}\n\nexport interface PeerEvents {\n\t/**\n\t * Emitted when a connection to the PeerServer is established.\n\t *\n\t * You may use the peer before this is emitted, but messages to the server will be queued. <code>id</code> is the brokering ID of the peer (which was either provided in the constructor or assigned by the server).<span class='tip'>You should not wait for this event before connecting to other peers if connection speed is important.</span>\n\t */\n\topen: (id: string) => void;\n\t/**\n\t * Emitted when a new data connection is established from a remote peer.\n\t */\n\tconnection: (dataConnection: DataConnection) => void;\n\t/**\n\t * Emitted when a remote peer attempts to call you.\n\t */\n\tcall: (mediaConnection: MediaConnection) => void;\n\t/**\n\t * Emitted when the peer is destroyed and can no longer accept or create any new connections.\n\t */\n\tclose: () => void;\n\t/**\n\t * Emitted when the peer is disconnected from the signalling server\n\t */\n\tdisconnected: (currentId: string) => void;\n\t/**\n\t * Errors on the peer are almost always fatal and will destroy the peer.\n\t *\n\t * Errors from the underlying socket and PeerConnections are forwarded here.\n\t */\n\terror: (error: PeerError<`${PeerErrorType}`>) => void;\n}\n/**\n * A peer who can initiate connections with other peers.\n */\nexport class Peer extends EventEmitterWithError<PeerErrorType, PeerEvents> {\n\tprivate static readonly DEFAULT_KEY = \"peerjs\";\n\n\tprotected readonly _serializers: SerializerMapping = {\n\t\traw: Raw,\n\t\tjson: Json,\n\t\tbinary: BinaryPack,\n\t\t\"binary-utf8\": BinaryPack,\n\n\t\tdefault: BinaryPack,\n\t};\n\tprivate readonly _options: PeerOptions;\n\tprivate readonly _api: API;\n\tprivate readonly _socket: Socket;\n\n\tprivate _id: string | null = null;\n\tprivate _lastServerId: string | null = null;\n\n\t// States.\n\tprivate _destroyed = false; // Connections have been killed\n\tprivate _disconnected = false; // Connection to PeerServer killed but P2P connections still active\n\tprivate _open = false; // Sockets and such are not yet open.\n\tprivate readonly _connections: Map<\n\t\tstring,\n\t\t(DataConnection | MediaConnection)[]\n\t> = new Map(); // All connections for this peer.\n\tprivate readonly _lostMessages: Map<string, ServerMessage[]> = new Map(); // src => [list of messages]\n\t/**\n\t * The brokering ID of this peer\n\t *\n\t * If no ID was specified in {@apilink Peer | the constructor},\n\t * this will be `undefined` until the {@apilink PeerEvents | `open`} event is emitted.\n\t */\n\tget id() {\n\t\treturn this._id;\n\t}\n\n\tget options() {\n\t\treturn this._options;\n\t}\n\n\tget open() {\n\t\treturn this._open;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tget socket() {\n\t\treturn this._socket;\n\t}\n\n\t/**\n\t * A hash of all connections associated with this peer, keyed by the remote peer's ID.\n\t * @deprecated\n\t * Return type will change from Object to Map<string,[]>\n\t */\n\tget connections(): Object {\n\t\tconst plainConnections = Object.create(null);\n\n\t\tfor (const [k, v] of this._connections) {\n\t\t\tplainConnections[k] = v;\n\t\t}\n\n\t\treturn plainConnections;\n\t}\n\n\t/**\n\t * true if this peer and all of its connections can no longer be used.\n\t */\n\tget destroyed() {\n\t\treturn this._destroyed;\n\t}\n\t/**\n\t * false if there is an active connection to the PeerServer.\n\t */\n\tget disconnected() {\n\t\treturn this._disconnected;\n\t}\n\n\t/**\n\t * A peer can connect to other peers and listen for connections.\n\t */\n\tconstructor();\n\n\t/**\n\t * A peer can connect to other peers and listen for connections.\n\t * @param options for specifying details about PeerServer\n\t */\n\tconstructor(options: PeerOptions);\n\n\t/**\n\t * A peer can connect to other peers and listen for connections.\n\t * @param id Other peers can connect to this peer using the provided ID.\n\t *     If no ID is given, one will be generated by the brokering server.\n\t * The ID must start and end with an alphanumeric character (lower or upper case character or a digit). In the middle of the ID spaces, dashes (-) and underscores (_) are allowed. Use {@apilink PeerOptions.metadata } to send identifying information.\n\t * @param options for specifying details about PeerServer\n\t */\n\tconstructor(id: string, options?: PeerOptions);\n\n\tconstructor(id?: string | PeerOptions, options?: PeerOptions) {\n\t\tsuper();\n\n\t\tlet userId: string | undefined;\n\n\t\t// Deal with overloading\n\t\tif (id && id.constructor == Object) {\n\t\t\toptions = id as PeerOptions;\n\t\t} else if (id) {\n\t\t\tuserId = id.toString();\n\t\t}\n\n\t\t// Configurize options\n\t\toptions = {\n\t\t\tdebug: 0, // 1: Errors, 2: Warnings, 3: All logs\n\t\t\thost: util.CLOUD_HOST,\n\t\t\tport: util.CLOUD_PORT,\n\t\t\tpath: \"/\",\n\t\t\tkey: Peer.DEFAULT_KEY,\n\t\t\ttoken: util.randomToken(),\n\t\t\tconfig: util.defaultConfig,\n\t\t\treferrerPolicy: \"strict-origin-when-cross-origin\",\n\t\t\tserializers: {},\n\t\t\t...options,\n\t\t};\n\t\tthis._options = options;\n\t\tthis._serializers = { ...this._serializers, ...this.options.serializers };\n\n\t\t// Detect relative URL host.\n\t\tif (this._options.host === \"/\") {\n\t\t\tthis._options.host = window.location.hostname;\n\t\t}\n\n\t\t// Set path correctly.\n\t\tif (this._options.path) {\n\t\t\tif (this._options.path[0] !== \"/\") {\n\t\t\t\tthis._options.path = \"/\" + this._options.path;\n\t\t\t}\n\t\t\tif (this._options.path[this._options.path.length - 1] !== \"/\") {\n\t\t\t\tthis._options.path += \"/\";\n\t\t\t}\n\t\t}\n\n\t\t// Set whether we use SSL to same as current host\n\t\tif (\n\t\t\tthis._options.secure === undefined &&\n\t\t\tthis._options.host !== util.CLOUD_HOST\n\t\t) {\n\t\t\tthis._options.secure = util.isSecure();\n\t\t} else if (this._options.host == util.CLOUD_HOST) {\n\t\t\tthis._options.secure = true;\n\t\t}\n\t\t// Set a custom log function if present\n\t\tif (this._options.logFunction) {\n\t\t\tlogger.setLogFunction(this._options.logFunction);\n\t\t}\n\n\t\tlogger.logLevel = this._options.debug || 0;\n\n\t\tthis._api = new API(options);\n\t\tthis._socket = this._createServerConnection();\n\n\t\t// Sanity checks\n\t\t// Ensure WebRTC supported\n\t\tif (!util.supports.audioVideo && !util.supports.data) {\n\t\t\tthis._delayedAbort(\n\t\t\t\tPeerErrorType.BrowserIncompatible,\n\t\t\t\t\"The current browser does not support WebRTC\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\t// Ensure alphanumeric id\n\t\tif (!!userId && !util.validateId(userId)) {\n\t\t\tthis._delayedAbort(PeerErrorType.InvalidID, `ID \"${userId}\" is invalid`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (userId) {\n\t\t\tthis._initialize(userId);\n\t\t} else {\n\t\t\tthis._api\n\t\t\t\t.retrieveId()\n\t\t\t\t.then((id) => this._initialize(id))\n\t\t\t\t.catch((error) => this._abort(PeerErrorType.ServerError, error));\n\t\t}\n\t}\n\n\tprivate _createServerConnection(): Socket {\n\t\tconst socket = new Socket(\n\t\t\tthis._options.secure,\n\t\t\tthis._options.host!,\n\t\t\tthis._options.port!,\n\t\t\tthis._options.path!,\n\t\t\tthis._options.key!,\n\t\t\tthis._options.pingInterval,\n\t\t);\n\n\t\tsocket.on(SocketEventType.Message, (data: ServerMessage) => {\n\t\t\tthis._handleMessage(data);\n\t\t});\n\n\t\tsocket.on(SocketEventType.Error, (error: string) => {\n\t\t\tthis._abort(PeerErrorType.SocketError, error);\n\t\t});\n\n\t\tsocket.on(SocketEventType.Disconnected, () => {\n\t\t\tif (this.disconnected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.emitError(PeerErrorType.Network, \"Lost connection to server.\");\n\t\t\tthis.disconnect();\n\t\t});\n\n\t\tsocket.on(SocketEventType.Close, () => {\n\t\t\tif (this.disconnected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._abort(\n\t\t\t\tPeerErrorType.SocketClosed,\n\t\t\t\t\"Underlying socket is already closed.\",\n\t\t\t);\n\t\t});\n\n\t\treturn socket;\n\t}\n\n\t/** Initialize a connection with the server. */\n\tprivate _initialize(id: string): void {\n\t\tthis._id = id;\n\t\tthis.socket.start(id, this._options.token!);\n\t}\n\n\t/** Handles messages from the server. */\n\tprivate _handleMessage(message: ServerMessage): void {\n\t\tconst type = message.type;\n\t\tconst payload = message.payload;\n\t\tconst peerId = message.src;\n\n\t\tswitch (type) {\n\t\t\tcase ServerMessageType.Open: // The connection to the server is open.\n\t\t\t\tthis._lastServerId = this.id;\n\t\t\t\tthis._open = true;\n\t\t\t\tthis.emit(\"open\", this.id);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Error: // Server error.\n\t\t\t\tthis._abort(PeerErrorType.ServerError, payload.msg);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.IdTaken: // The selected ID is taken.\n\t\t\t\tthis._abort(PeerErrorType.UnavailableID, `ID \"${this.id}\" is taken`);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.InvalidKey: // The given API key cannot be found.\n\t\t\t\tthis._abort(\n\t\t\t\t\tPeerErrorType.InvalidKey,\n\t\t\t\t\t`API KEY \"${this._options.key}\" is invalid`,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Leave: // Another peer has closed its connection to this peer.\n\t\t\t\tlogger.log(`Received leave message from ${peerId}`);\n\t\t\t\tthis._cleanupPeer(peerId);\n\t\t\t\tthis._connections.delete(peerId);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Expire: // The offer sent to a peer has expired without response.\n\t\t\t\tthis.emitError(\n\t\t\t\t\tPeerErrorType.PeerUnavailable,\n\t\t\t\t\t`Could not connect to peer ${peerId}`,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Offer: {\n\t\t\t\t// we should consider switching this to CALL/CONNECT, but this is the least breaking option.\n\t\t\t\tconst connectionId = payload.connectionId;\n\t\t\t\tlet connection = this.getConnection(peerId, connectionId);\n\n\t\t\t\tif (connection) {\n\t\t\t\t\tconnection.close();\n\t\t\t\t\tlogger.warn(\n\t\t\t\t\t\t`Offer received for existing Connection ID:${connectionId}`,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Create a new connection.\n\t\t\t\tif (payload.type === ConnectionType.Media) {\n\t\t\t\t\tconst mediaConnection = new MediaConnection(peerId, this, {\n\t\t\t\t\t\tconnectionId: connectionId,\n\t\t\t\t\t\t_payload: payload,\n\t\t\t\t\t\tmetadata: payload.metadata,\n\t\t\t\t\t});\n\t\t\t\t\tconnection = mediaConnection;\n\t\t\t\t\tthis._addConnection(peerId, connection);\n\t\t\t\t\tthis.emit(\"call\", mediaConnection);\n\t\t\t\t} else if (payload.type === ConnectionType.Data) {\n\t\t\t\t\tconst dataConnection = new this._serializers[payload.serialization](\n\t\t\t\t\t\tpeerId,\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconnectionId: connectionId,\n\t\t\t\t\t\t\t_payload: payload,\n\t\t\t\t\t\t\tmetadata: payload.metadata,\n\t\t\t\t\t\t\tlabel: payload.label,\n\t\t\t\t\t\t\tserialization: payload.serialization,\n\t\t\t\t\t\t\treliable: payload.reliable,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tconnection = dataConnection;\n\n\t\t\t\t\tthis._addConnection(peerId, connection);\n\t\t\t\t\tthis.emit(\"connection\", dataConnection);\n\t\t\t\t} else {\n\t\t\t\t\tlogger.warn(`Received malformed connection type:${payload.type}`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Find messages.\n\t\t\t\tconst messages = this._getMessages(connectionId);\n\t\t\t\tfor (const message of messages) {\n\t\t\t\t\tconnection.handleMessage(message);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault: {\n\t\t\t\tif (!payload) {\n\t\t\t\t\tlogger.warn(\n\t\t\t\t\t\t`You received a malformed message from ${peerId} of type ${type}`,\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst connectionId = payload.connectionId;\n\t\t\t\tconst connection = this.getConnection(peerId, connectionId);\n\n\t\t\t\tif (connection && connection.peerConnection) {\n\t\t\t\t\t// Pass it on.\n\t\t\t\t\tconnection.handleMessage(message);\n\t\t\t\t} else if (connectionId) {\n\t\t\t\t\t// Store for possible later use\n\t\t\t\t\tthis._storeMessage(connectionId, message);\n\t\t\t\t} else {\n\t\t\t\t\tlogger.warn(\"You received an unrecognized message:\", message);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t/** Stores messages without a set up connection, to be claimed later. */\n\tprivate _storeMessage(connectionId: string, message: ServerMessage): void {\n\t\tif (!this._lostMessages.has(connectionId)) {\n\t\t\tthis._lostMessages.set(connectionId, []);\n\t\t}\n\n\t\tthis._lostMessages.get(connectionId).push(message);\n\t}\n\n\t/**\n\t * Retrieve messages from lost message store\n\t * @internal\n\t */\n\t//TODO Change it to private\n\tpublic _getMessages(connectionId: string): ServerMessage[] {\n\t\tconst messages = this._lostMessages.get(connectionId);\n\n\t\tif (messages) {\n\t\t\tthis._lostMessages.delete(connectionId);\n\t\t\treturn messages;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\t/**\n\t * Connects to the remote peer specified by id and returns a data connection.\n\t * @param peer The brokering ID of the remote peer (their {@apilink Peer.id}).\n\t * @param options for specifying details about Peer Connection\n\t */\n\tconnect(peer: string, options: PeerConnectOption = {}): DataConnection {\n\t\toptions = {\n\t\t\tserialization: \"default\",\n\t\t\t...options,\n\t\t};\n\t\tif (this.disconnected) {\n\t\t\tlogger.warn(\n\t\t\t\t\"You cannot connect to a new Peer because you called \" +\n\t\t\t\t\t\".disconnect() on this Peer and ended your connection with the \" +\n\t\t\t\t\t\"server. You can create a new Peer to reconnect, or call reconnect \" +\n\t\t\t\t\t\"on this peer if you believe its ID to still be available.\",\n\t\t\t);\n\t\t\tthis.emitError(\n\t\t\t\tPeerErrorType.Disconnected,\n\t\t\t\t\"Cannot connect to new Peer after disconnecting from server.\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst dataConnection = new this._serializers[options.serialization](\n\t\t\tpeer,\n\t\t\tthis,\n\t\t\toptions,\n\t\t);\n\t\tthis._addConnection(peer, dataConnection);\n\t\treturn dataConnection;\n\t}\n\n\t/**\n\t * Calls the remote peer specified by id and returns a media connection.\n\t * @param peer The brokering ID of the remote peer (their peer.id).\n\t * @param stream The caller's media stream\n\t * @param options Metadata associated with the connection, passed in by whoever initiated the connection.\n\t */\n\tcall(\n\t\tpeer: string,\n\t\tstream: MediaStream,\n\t\toptions: CallOption = {},\n\t): MediaConnection {\n\t\tif (this.disconnected) {\n\t\t\tlogger.warn(\n\t\t\t\t\"You cannot connect to a new Peer because you called \" +\n\t\t\t\t\t\".disconnect() on this Peer and ended your connection with the \" +\n\t\t\t\t\t\"server. You can create a new Peer to reconnect.\",\n\t\t\t);\n\t\t\tthis.emitError(\n\t\t\t\tPeerErrorType.Disconnected,\n\t\t\t\t\"Cannot connect to new Peer after disconnecting from server.\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!stream) {\n\t\t\tlogger.error(\n\t\t\t\t\"To call a peer, you must provide a stream from your browser's `getUserMedia`.\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst mediaConnection = new MediaConnection(peer, this, {\n\t\t\t...options,\n\t\t\t_stream: stream,\n\t\t});\n\t\tthis._addConnection(peer, mediaConnection);\n\t\treturn mediaConnection;\n\t}\n\n\t/** Add a data/media connection to this peer. */\n\tprivate _addConnection(\n\t\tpeerId: string,\n\t\tconnection: MediaConnection | DataConnection,\n\t): void {\n\t\tlogger.log(\n\t\t\t`add connection ${connection.type}:${connection.connectionId} to peerId:${peerId}`,\n\t\t);\n\n\t\tif (!this._connections.has(peerId)) {\n\t\t\tthis._connections.set(peerId, []);\n\t\t}\n\t\tthis._connections.get(peerId).push(connection);\n\t}\n\n\t//TODO should be private\n\t_removeConnection(connection: DataConnection | MediaConnection): void {\n\t\tconst connections = this._connections.get(connection.peer);\n\n\t\tif (connections) {\n\t\t\tconst index = connections.indexOf(connection);\n\n\t\t\tif (index !== -1) {\n\t\t\t\tconnections.splice(index, 1);\n\t\t\t}\n\t\t}\n\n\t\t//remove from lost messages\n\t\tthis._lostMessages.delete(connection.connectionId);\n\t}\n\n\t/** Retrieve a data/media connection for this peer. */\n\tgetConnection(\n\t\tpeerId: string,\n\t\tconnectionId: string,\n\t): null | DataConnection | MediaConnection {\n\t\tconst connections = this._connections.get(peerId);\n\t\tif (!connections) {\n\t\t\treturn null;\n\t\t}\n\n\t\tfor (const connection of connections) {\n\t\t\tif (connection.connectionId === connectionId) {\n\t\t\t\treturn connection;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate _delayedAbort(type: PeerErrorType, message: string | Error): void {\n\t\tsetTimeout(() => {\n\t\t\tthis._abort(type, message);\n\t\t}, 0);\n\t}\n\n\t/**\n\t * Emits an error message and destroys the Peer.\n\t * The Peer is not destroyed if it's in a disconnected state, in which case\n\t * it retains its disconnected state and its existing connections.\n\t */\n\tprivate _abort(type: PeerErrorType, message: string | Error): void {\n\t\tlogger.error(\"Aborting!\");\n\n\t\tthis.emitError(type, message);\n\n\t\tif (!this._lastServerId) {\n\t\t\tthis.destroy();\n\t\t} else {\n\t\t\tthis.disconnect();\n\t\t}\n\t}\n\n\t/**\n\t * Destroys the Peer: closes all active connections as well as the connection\n\t * to the server.\n\t *\n\t * :::caution\n\t * This cannot be undone; the respective peer object will no longer be able\n\t * to create or receive any connections, its ID will be forfeited on the server,\n\t * and all of its data and media connections will be closed.\n\t * :::\n\t */\n\tdestroy(): void {\n\t\tif (this.destroyed) {\n\t\t\treturn;\n\t\t}\n\n\t\tlogger.log(`Destroy peer with ID:${this.id}`);\n\n\t\tthis.disconnect();\n\t\tthis._cleanup();\n\n\t\tthis._destroyed = true;\n\n\t\tthis.emit(\"close\");\n\t}\n\n\t/** Disconnects every connection on this peer. */\n\tprivate _cleanup(): void {\n\t\tfor (const peerId of this._connections.keys()) {\n\t\t\tthis._cleanupPeer(peerId);\n\t\t\tthis._connections.delete(peerId);\n\t\t}\n\n\t\tthis.socket.removeAllListeners();\n\t}\n\n\t/** Closes all connections to this peer. */\n\tprivate _cleanupPeer(peerId: string): void {\n\t\tconst connections = this._connections.get(peerId);\n\n\t\tif (!connections) return;\n\n\t\tfor (const connection of connections) {\n\t\t\tconnection.close();\n\t\t}\n\t}\n\n\t/**\n\t * Disconnects the Peer's connection to the PeerServer. Does not close any\n\t *  active connections.\n\t * Warning: The peer can no longer create or accept connections after being\n\t *  disconnected. It also cannot reconnect to the server.\n\t */\n\tdisconnect(): void {\n\t\tif (this.disconnected) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentId = this.id;\n\n\t\tlogger.log(`Disconnect peer with ID:${currentId}`);\n\n\t\tthis._disconnected = true;\n\t\tthis._open = false;\n\n\t\tthis.socket.close();\n\n\t\tthis._lastServerId = currentId;\n\t\tthis._id = null;\n\n\t\tthis.emit(\"disconnected\", currentId);\n\t}\n\n\t/** Attempts to reconnect with the same ID.\n\t *\n\t * Only {@apilink Peer.disconnect | disconnected peers} can be reconnected.\n\t * Destroyed peers cannot be reconnected.\n\t * If the connection fails (as an example, if the peer's old ID is now taken),\n\t * the peer's existing connections will not close, but any associated errors events will fire.\n\t */\n\treconnect(): void {\n\t\tif (this.disconnected && !this.destroyed) {\n\t\t\tlogger.log(\n\t\t\t\t`Attempting reconnection to server with ID ${this._lastServerId}`,\n\t\t\t);\n\t\t\tthis._disconnected = false;\n\t\t\tthis._initialize(this._lastServerId!);\n\t\t} else if (this.destroyed) {\n\t\t\tthrow new Error(\n\t\t\t\t\"This peer cannot reconnect to the server. It has already been destroyed.\",\n\t\t\t);\n\t\t} else if (!this.disconnected && !this.open) {\n\t\t\t// Do nothing. We're still connecting the first time.\n\t\t\tlogger.error(\n\t\t\t\t\"In a hurry? We're still trying to make the initial connection!\",\n\t\t\t);\n\t\t} else {\n\t\t\tthrow new Error(\n\t\t\t\t`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`,\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Get a list of available peer IDs. If you're running your own server, you'll\n\t * want to set allow_discovery: true in the PeerServer options. If you're using\n\t * the cloud server, email team@peerjs.com to get the functionality enabled for\n\t * your key.\n\t */\n\tlistAllPeers(cb = (_: any[]) => {}): void {\n\t\tthis._api\n\t\t\t.listAllPeers()\n\t\t\t.then((peers) => cb(peers))\n\t\t\t.catch((error) => this._abort(PeerErrorType.ServerError, error));\n\t}\n}\n","import type { Peer } from \"../../peer.js\";\nimport { Decoder, Encoder } from \"cbor-x\";\nimport { StreamConnection } from \"./StreamConnection.js\";\n\nconst NullValue = Symbol.for(null);\n\nfunction concatUint8Array(buffer1: Uint8Array, buffer2: Uint8Array) {\n\tconst tmp = new Uint8Array(buffer1.byteLength + buffer2.byteLength);\n\ttmp.set(buffer1, 0);\n\ttmp.set(buffer2, buffer1.byteLength);\n\treturn new Uint8Array(tmp.buffer);\n}\n\nconst iterateOver = async function* (stream: ReadableStream) {\n\tconst reader = stream.getReader();\n\ttry {\n\t\twhile (true) {\n\t\t\tconst { done, value } = await reader.read();\n\t\t\tif (done) return;\n\t\t\tyield value;\n\t\t}\n\t} finally {\n\t\treader.releaseLock();\n\t}\n};\n\nexport class Cbor extends StreamConnection {\n\treadonly serialization = \"Cbor\";\n\tprivate _encoder = new Encoder();\n\tprivate _decoder = new Decoder();\n\tprivate _inc;\n\tprivate _decoderStream = new TransformStream<ArrayBuffer, unknown>({\n\t\ttransform: (abchunk, controller) => {\n\t\t\tlet chunk = new Uint8Array(abchunk);\n\t\t\tif (this._inc) {\n\t\t\t\tchunk = concatUint8Array(this._inc, chunk);\n\t\t\t\tthis._inc = null;\n\t\t\t}\n\t\t\tlet values;\n\t\t\ttry {\n\t\t\t\tvalues = this._decoder.decodeMultiple(chunk);\n\t\t\t} catch (error) {\n\t\t\t\tif (error.incomplete) {\n\t\t\t\t\tthis._inc = chunk.subarray(error.lastPosition);\n\t\t\t\t\tvalues = error.values;\n\t\t\t\t} else throw error;\n\t\t\t} finally {\n\t\t\t\tfor (let value of values || []) {\n\t\t\t\t\tif (value === null) value = NullValue;\n\t\t\t\t\tcontroller.enqueue(value);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t});\n\n\tconstructor(peerId: string, provider: Peer, options: any) {\n\t\tsuper(peerId, provider, { ...options, reliable: true });\n\n\t\tvoid this._rawReadStream.pipeTo(this._decoderStream.writable);\n\n\t\t(async () => {\n\t\t\tfor await (const msg of iterateOver(this._decoderStream.readable)) {\n\t\t\t\tif (msg.__peerData?.type === \"close\") {\n\t\t\t\t\tthis.close();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.emit(\"data\", msg);\n\t\t\t}\n\t\t})();\n\t}\n\n\tprotected override _send(data) {\n\t\treturn this.writer.write(this._encoder.encode(data));\n\t}\n}\n","<template>\n  <div class=\"chat-page flex-column\">\n    <div class=\"chat-head align-center no-shrink no-grow\">\n      <el-avatar\n        class=\"avatar\"\n        size=\"small\"\n        shape=\"square\"\n        icon=\"el-icon-user-solid\"\n      ></el-avatar>\n      {{ `${id}` }}\n    </div>\n    <div class=\"padding-x-16 chat-body limit-with flex-1\">\n      <div v-if=\"calling\" class=\"d-flex\">\n        <PeerVideo ref=\"myVideo\" />\n        <PeerVideo ref=\"remoteVideo\" />\n      </div>\n\n      <div v-else>\n        <ChatMessage\n          v-for=\"(item, idx) in currentMsgList\"\n          :message=\"item\"\n          :key=\"idx\"\n        />\n      </div>\n    </div>\n    <el-form\n      v-loading=\"loading\"\n      :inline=\"true\"\n      :model=\"formInline\"\n      ref=\"dynamicValidateForm\"\n      class=\"demo-form-inline d-flex padding-x-16 limit-with no-shrink no-grow\"\n    >\n      <el-form-item\n        prop=\"text\"\n        class=\"input-list\"\n        :rules=\"{\n          required: true,\n          trigger: 'blur',\n        }\"\n      >\n        <el-input\n          v-model=\"formInline.text\"\n          placeholder=\"Type your message...\"\n        ></el-input>\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"onSubmit('dynamicValidateForm')\"\n          >SEND</el-button\n        >\n      </el-form-item>\n    </el-form>\n    <el-upload\n      v-show=\"false\"\n      accept=\"image/*\"\n      class=\"avatar-uploader\"\n      action=\"#\"\n      :on-success=\"handleAvatarSuccess\"\n      :before-upload=\"beforeAvatarUpload\"\n    >\n      <i\n        ref=\"upload\"\n        slot=\"trigger\"\n        class=\"el-icon-plus avatar-uploader-icon\"\n      ></i>\n    </el-upload>\n    <p class=\"tool\">\n      <i class=\"el-icon-picture\" @click=\"uploadImg\"></i>\n      <!-- <i class=\"el-icon-video-camera-solid\" @click=\"call\"></i> -->\n    </p>\n  </div>\n</template>\n\n<script>\nimport { mapState, mapGetters } from \"vuex\";\nimport { Peer } from \"peerjs\";\nexport default {\n  name: \"ChatView\",\n  data() {\n    return {\n      calling: false,\n      id: this.$route.params.id,\n      formInline: { text: \"\", type: \"text\" },\n      imageUrl: \"\",\n      curMsg: {},\n      myVideo: {},\n      remoteVideo: {},\n    };\n  },\n  computed: {\n    ...mapState([\n      \"userId\",\n      \"userAarry\",\n      \"msgdata\",\n      \"currentChatTime\",\n      \"currentTalkId\",\n    ]),\n    ...mapGetters([\"currentMsgList\"]),\n    loading() {\n      if (\n        this.currentChatTime &&\n        !this.msgList.some((v) => v.currentChatTime === this.currentChatTime)\n      ) {\n        return true;\n      }\n      return false;\n    },\n    msgList() {\n      return this.msgdata[this.id] || [];\n    },\n  },\n  watch: {\n    id() {\n      this.$store.commit(\"setCurrentChatTime\", \"\");\n    },\n    userAarry(v) {\n      if (!v.includes(this.id)) {\n        this.$message.error(\"User is not online\");\n        this.$router.push(\"/\");\n      }\n    },\n  },\n  methods: {\n    image2Base64(file) {\n      return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.readAsDataURL(file);\n        reader.onload = function () {\n          resolve(this.result);\n        };\n        reader.onerror = function (error) {\n          reject(error);\n        };\n      });\n    },\n    uploadImg() {\n      this.$refs.upload.click();\n    },\n    handleAvatarSuccess() {},\n    async beforeAvatarUpload(file) {\n      const isJPG = file.type.includes(\"image/\");\n      const isLt5M = file.size / 1024 / 1024 < 5;\n\n      if (!isJPG) {\n        this.$message.error(\n          \"Avatar picture can only be JPG,PNG,JPEG,WEBP format!\"\n        );\n        return false;\n      }\n      if (!isLt5M) {\n        this.$message.error(\"Avatar picture size cannot exceed 5MB!\");\n        return false;\n      }\n      const img = await this.image2Base64(file);\n      this.sayTo(\"image\", img);\n      return false;\n    },\n    sayTo(type = \"text\", img = \"\") {\n      const currentChatTime = `${this.userId}-${new Date().getTime()}`;\n      this.curMsg = {\n        userId: this.id,\n        ...this.formInline,\n        src: img,\n        type,\n        currentChatTime,\n        isRead: false,\n      };\n      this.$store.commit(\"saveCurrentChat\", currentChatTime);\n      this.formInline.text = \"\";\n      this.socket.emit(\"say-to\", {\n        ...this.curMsg,\n      });\n    },\n    onSubmit(formName) {\n      this.$refs[formName].validate((valid) => {\n        if (!valid) return;\n        this.sayTo();\n      });\n    },\n    call() {\n      this.calling = true;\n      this.peer = new Peer(this.userId);\n      navigator.mediaDevices\n        .getUserMedia({ video: true, audio: true }) // \n        .then((stream) => {\n          this.$refs.myVideo.loadVideo(stream);\n          //  Peer\n          const call = this.peer.call(this.id, stream);\n          call.on(\"stream\", (remoteStream) => {\n            this.$refs.remoteVideo.loadVideo(remoteStream);\n          });\n        })\n        .catch((error) => {\n          console.error(\"Error accessing media devices.\", error);\n        });\n    },\n  },\n  async created() {\n    this.$store.commit(\"setSomeKey\", {\n      key: \"currentTalkId\",\n      value: this.id,\n    });\n    this.$store.commit(\"saveReadMsg\", this.id);\n  },\n  mounted() {\n    document.querySelector(\".chat-page\").style.height = `${\n      window.innerHeight - (62 + 24)\n    }px`;\n  },\n};\n</script>\n<style scoped lang=\"scss\">\n.chat-page {\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);\n  background-color: #fff;\n  position: relative;\n  .tool {\n    position: absolute;\n    left: 16px;\n    bottom: 8px;\n    font-size: 20px;\n  }\n}\n.chat-head {\n  height: 41px;\n  border-bottom: 1px solid #e4e7ed;\n  padding: 0 16px;\n  .avatar {\n    margin-right: 4px;\n    background-color: $--color-primary;\n  }\n}\n.chat-body {\n  overflow-y: auto;\n}\n.demo-form-inline {\n  width: 100%;\n  ::v-deep {\n    .el-form-item:first-child {\n      flex: 1;\n      .el-form-item__content {\n        width: 100%;\n      }\n    }\n  }\n}\n.limit-with {\n  max-width: 600px;\n}\n.input-list {\n  ::v-deep {\n    .el-form-item__content {\n      display: flex;\n      align-items: center;\n      i {\n        font-size: 22px;\n        margin: 0 8px;\n        cursor: pointer;\n      }\n      .el-input {\n        flex: 1;\n      }\n    }\n  }\n}\n</style>\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./ChatView.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./ChatView.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./ChatView.vue?vue&type=template&id=07820875&scoped=true\"\nimport script from \"./ChatView.vue?vue&type=script&lang=js\"\nexport * from \"./ChatView.vue?vue&type=script&lang=js\"\nimport style0 from \"./ChatView.vue?vue&type=style&index=0&id=07820875&prod&scoped=true&lang=scss\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"07820875\",\n  null\n  \n)\n\nexport default component.exports","/* eslint-env node */\n'use strict';\n\n// SDP helpers.\nconst SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substring(2, 12);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(line => line.trim());\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  const parts = blob.split('\\nm=');\n  return parts.map((part, index) => (index > 0 ?\n    'm=' + part : part).trim() + '\\r\\n');\n};\n\n// Returns the session description.\nSDPUtils.getDescription = function(blob) {\n  const sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// Returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  const sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(line => line.indexOf(prefix) === 0);\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\n// Input can be prefixed with a=.\nSDPUtils.parseCandidate = function(line) {\n  let parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  const candidate = {\n    foundation: parts[0],\n    component: {1: 'rtp', 2: 'rtcp'}[parts[1]] || parts[1],\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    address: parts[4], // address is an alias for ip.\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7],\n  };\n\n  for (let i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compatibility.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag. Don't overwrite.\n        if (candidate[parts[i]] === undefined) {\n          candidate[parts[i]] = parts[i + 1];\n        }\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\n// This does not include the a= prefix!\nSDPUtils.writeCandidate = function(candidate) {\n  const sdp = [];\n  sdp.push(candidate.foundation);\n\n  const component = candidate.component;\n  if (component === 'rtp') {\n    sdp.push(1);\n  } else if (component === 'rtcp') {\n    sdp.push(2);\n  } else {\n    sdp.push(component);\n  }\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.address || candidate.ip);\n  sdp.push(candidate.port);\n\n  const type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// Sample input:\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substring(14).split(' ');\n};\n\n// Parses a rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  let parts = line.substring(9).split(' ');\n  const parsed = {\n    payloadType: parseInt(parts.shift(), 10), // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generates a rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  const channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses a extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  const parts = line.substring(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1],\n    attributes: parts.slice(2).join(' '),\n  };\n};\n\n// Generates an extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n        ? '/' + headerExtension.direction\n        : '') +\n      ' ' + headerExtension.uri +\n      (headerExtension.attributes ? ' ' + headerExtension.attributes : '') +\n      '\\r\\n';\n};\n\n// Parses a fmtp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  const parsed = {};\n  let kv;\n  const parts = line.substring(line.indexOf(' ') + 1).split(';');\n  for (let j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates a fmtp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  let line = '';\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    const params = [];\n    Object.keys(codec.parameters).forEach(param => {\n      if (codec.parameters[param] !== undefined) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses a rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  const parts = line.substring(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' '),\n  };\n};\n\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  let lines = '';\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(fb => {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses a RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  const sp = line.indexOf(' ');\n  const parts = {\n    ssrc: parseInt(line.substring(7, sp), 10),\n  };\n  const colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substring(sp + 1, colon);\n    parts.value = line.substring(colon + 1);\n  } else {\n    parts.attribute = line.substring(sp + 1);\n  }\n  return parts;\n};\n\n// Parse a ssrc-group line (see RFC 5576). Sample input:\n// a=ssrc-group:semantics 12 34\nSDPUtils.parseSsrcGroup = function(line) {\n  const parts = line.substring(13).split(' ');\n  return {\n    semantics: parts.shift(),\n    ssrcs: parts.map(ssrc => parseInt(ssrc, 10)),\n  };\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// Returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  const mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substring(6);\n  }\n};\n\n// Parses a fingerprint line for DTLS-SRTP.\nSDPUtils.parseFingerprint = function(line) {\n  const parts = line.substring(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1].toUpperCase(), // the definition is upper-case in RFC 4572.\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  const lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint),\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  let sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(fp => {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n\n// Parses a=crypto lines into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#dictionary-rtcsrtpsdesparameters-members\nSDPUtils.parseCryptoLine = function(line) {\n  const parts = line.substring(9).split(' ');\n  return {\n    tag: parseInt(parts[0], 10),\n    cryptoSuite: parts[1],\n    keyParams: parts[2],\n    sessionParams: parts.slice(3),\n  };\n};\n\nSDPUtils.writeCryptoLine = function(parameters) {\n  return 'a=crypto:' + parameters.tag + ' ' +\n    parameters.cryptoSuite + ' ' +\n    (typeof parameters.keyParams === 'object'\n      ? SDPUtils.writeCryptoKeyParams(parameters.keyParams)\n      : parameters.keyParams) +\n    (parameters.sessionParams ? ' ' + parameters.sessionParams.join(' ') : '') +\n    '\\r\\n';\n};\n\n// Parses the crypto key parameters into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#rtcsrtpkeyparam*\nSDPUtils.parseCryptoKeyParams = function(keyParams) {\n  if (keyParams.indexOf('inline:') !== 0) {\n    return null;\n  }\n  const parts = keyParams.substring(7).split('|');\n  return {\n    keyMethod: 'inline',\n    keySalt: parts[0],\n    lifeTime: parts[1],\n    mkiValue: parts[2] ? parts[2].split(':')[0] : undefined,\n    mkiLength: parts[2] ? parts[2].split(':')[1] : undefined,\n  };\n};\n\nSDPUtils.writeCryptoKeyParams = function(keyParams) {\n  return keyParams.keyMethod + ':'\n    + keyParams.keySalt +\n    (keyParams.lifeTime ? '|' + keyParams.lifeTime : '') +\n    (keyParams.mkiValue && keyParams.mkiLength\n      ? '|' + keyParams.mkiValue + ':' + keyParams.mkiLength\n      : '');\n};\n\n// Extracts all SDES parameters.\nSDPUtils.getCryptoParameters = function(mediaSection, sessionpart) {\n  const lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=crypto:');\n  return lines.map(SDPUtils.parseCryptoLine);\n};\n\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  const ufrag = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-ufrag:')[0];\n  const pwd = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-pwd:')[0];\n  if (!(ufrag && pwd)) {\n    return null;\n  }\n  return {\n    usernameFragment: ufrag.substring(12),\n    password: pwd.substring(10),\n  };\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  let sdp = 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n  if (params.iceLite) {\n    sdp += 'a=ice-lite\\r\\n';\n  }\n  return sdp;\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  const description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: [],\n  };\n  const lines = SDPUtils.splitLines(mediaSection);\n  const mline = lines[0].split(' ');\n  description.profile = mline[2];\n  for (let i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    const pt = mline[i];\n    const rtpmapline = SDPUtils.matchPrefix(\n      mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      const codec = SDPUtils.parseRtpMap(rtpmapline);\n      const fmtps = SDPUtils.matchPrefix(\n        mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(line => {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  const wildcardRtcpFb = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-fb:* ')\n    .map(SDPUtils.parseRtcpFb);\n  description.codecs.forEach(codec => {\n    wildcardRtcpFb.forEach(fb=> {\n      const duplicate = codec.rtcpFeedback.find(existingFeedback => {\n        return existingFeedback.type === fb.type &&\n          existingFeedback.parameter === fb.parameter;\n      });\n      if (!duplicate) {\n        codec.rtcpFeedback.push(fb);\n      }\n    });\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  let sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' ' + (caps.profile || 'UDP/TLS/RTP/SAVPF') + ' ';\n  sdp += caps.codecs.map(codec => {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(codec => {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  let maxptime = 0;\n  caps.codecs.forEach(codec => {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(extension => {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  const encodingParameters = [];\n  const description = SDPUtils.parseRtpParameters(mediaSection);\n  const hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  const hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  const ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(parts => parts.attribute === 'cname');\n  const primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  let secondarySsrc;\n\n  const flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n    .map(line => {\n      const parts = line.substring(17).split(' ');\n      return parts.map(part => parseInt(part, 10));\n    });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(codec => {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      let encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: primarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red',\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc,\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  let bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substring(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substring(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(params => {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  const rtcpParameters = {};\n\n  // Gets the first SSRC. Note that with RTX there might be multiple\n  // SSRCs.\n  const remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(obj => obj.attribute === 'cname')[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  const rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrbute.\n  // Note that Edge does not support unmuxed RTCP.\n  const mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\nSDPUtils.writeRtcpParameters = function(rtcpParameters) {\n  let sdp = '';\n  if (rtcpParameters.reducedSize) {\n    sdp += 'a=rtcp-rsize\\r\\n';\n  }\n  if (rtcpParameters.mux) {\n    sdp += 'a=rtcp-mux\\r\\n';\n  }\n  if (rtcpParameters.ssrc !== undefined && rtcpParameters.cname) {\n    sdp += 'a=ssrc:' + rtcpParameters.ssrc +\n      ' cname:' + rtcpParameters.cname + '\\r\\n';\n  }\n  return sdp;\n};\n\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  let parts;\n  const spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substring(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  const planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(msidParts => msidParts.attribute === 'msid');\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// SCTP\n// parses draft-ietf-mmusic-sctp-sdp-26 first and falls back\n// to draft-ietf-mmusic-sctp-sdp-05\nSDPUtils.parseSctpDescription = function(mediaSection) {\n  const mline = SDPUtils.parseMLine(mediaSection);\n  const maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');\n  let maxMessageSize;\n  if (maxSizeLine.length > 0) {\n    maxMessageSize = parseInt(maxSizeLine[0].substring(19), 10);\n  }\n  if (isNaN(maxMessageSize)) {\n    maxMessageSize = 65536;\n  }\n  const sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');\n  if (sctpPort.length > 0) {\n    return {\n      port: parseInt(sctpPort[0].substring(12), 10),\n      protocol: mline.fmt,\n      maxMessageSize,\n    };\n  }\n  const sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');\n  if (sctpMapLines.length > 0) {\n    const parts = sctpMapLines[0]\n      .substring(10)\n      .split(' ');\n    return {\n      port: parseInt(parts[0], 10),\n      protocol: parts[1],\n      maxMessageSize,\n    };\n  }\n};\n\n// SCTP\n// outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers\n// support by now receiving in this format, unless we originally parsed\n// as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line\n// protocol of DTLS/SCTP -- without UDP/ or TCP/)\nSDPUtils.writeSctpDescription = function(media, sctp) {\n  let output = [];\n  if (media.protocol !== 'DTLS/SCTP') {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctp-port:' + sctp.port + '\\r\\n',\n    ];\n  } else {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\\r\\n',\n    ];\n  }\n  if (sctp.maxMessageSize !== undefined) {\n    output.push('a=max-message-size:' + sctp.maxMessageSize + '\\r\\n');\n  }\n  return output.join('');\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 22);\n};\n\n// Write boiler plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\n// sessUser is optional and defaults to 'thisisadapterortc'\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\n  let sessionId;\n  const version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  const user = sessUser || 'thisisadapterortc';\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=' + user + ' ' + sessionId + ' ' + version +\n        ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  const lines = SDPUtils.splitLines(mediaSection);\n  for (let i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substring(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  const lines = SDPUtils.splitLines(mediaSection);\n  const mline = lines[0].split(' ');\n  return mline[0].substring(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  const lines = SDPUtils.splitLines(mediaSection);\n  const parts = lines[0].substring(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' '),\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  const line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  const parts = line.substring(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5],\n  };\n};\n\n// a very naive interpretation of a valid SDP.\nSDPUtils.isValidSDP = function(blob) {\n  if (typeof blob !== 'string' || blob.length === 0) {\n    return false;\n  }\n  const lines = SDPUtils.splitLines(blob);\n  for (let i = 0; i < lines.length; i++) {\n    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\n      return false;\n    }\n    // TODO: check the modifier a bit more.\n  }\n  return true;\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n","'use strict';\nvar anObject = require('../internals/an-object');\n\n// `RegExp.prototype.flags` getter implementation\n// https://tc39.es/ecma262/#sec-get-regexp.prototype.flags\nmodule.exports = function () {\n  var that = anObject(this);\n  var result = '';\n  if (that.hasIndices) result += 'd';\n  if (that.global) result += 'g';\n  if (that.ignoreCase) result += 'i';\n  if (that.multiline) result += 'm';\n  if (that.dotAll) result += 's';\n  if (that.unicode) result += 'u';\n  if (that.unicodeSets) result += 'v';\n  if (that.sticky) result += 'y';\n  return result;\n};\n","'use strict';\nvar global = require('../internals/global');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar defineBuiltInAccessor = require('../internals/define-built-in-accessor');\nvar regExpFlags = require('../internals/regexp-flags');\nvar fails = require('../internals/fails');\n\n// babel-minify and Closure Compiler transpiles RegExp('.', 'd') -> /./d and it causes SyntaxError\nvar RegExp = global.RegExp;\nvar RegExpPrototype = RegExp.prototype;\n\nvar FORCED = DESCRIPTORS && fails(function () {\n  var INDICES_SUPPORT = true;\n  try {\n    RegExp('.', 'd');\n  } catch (error) {\n    INDICES_SUPPORT = false;\n  }\n\n  var O = {};\n  // modern V8 bug\n  var calls = '';\n  var expected = INDICES_SUPPORT ? 'dgimsy' : 'gimsy';\n\n  var addGetter = function (key, chr) {\n    // eslint-disable-next-line es/no-object-defineproperty -- safe\n    Object.defineProperty(O, key, { get: function () {\n      calls += chr;\n      return true;\n    } });\n  };\n\n  var pairs = {\n    dotAll: 's',\n    global: 'g',\n    ignoreCase: 'i',\n    multiline: 'm',\n    sticky: 'y'\n  };\n\n  if (INDICES_SUPPORT) pairs.hasIndices = 'd';\n\n  for (var key in pairs) addGetter(key, pairs[key]);\n\n  // eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\n  var result = Object.getOwnPropertyDescriptor(RegExpPrototype, 'flags').get.call(O);\n\n  return result !== expected || calls !== expected;\n});\n\n// `RegExp.prototype.flags` getter\n// https://tc39.es/ecma262/#sec-get-regexp.prototype.flags\nif (FORCED) defineBuiltInAccessor(RegExpPrototype, 'flags', {\n  configurable: true,\n  get: regExpFlags\n});\n"],"names":["render","_vm","this","_c","_self","staticClass","attrs","_v","_s","id","calling","ref","_l","currentMsgList","item","idx","key","directives","name","rawName","value","loading","expression","formInline","required","trigger","model","text","callback","$$v","$set","on","$event","onSubmit","handleAvatarSuccess","beforeAvatarUpload","slot","uploadImg","staticRenderFns","$e8379818650e2442$export$93654d4f2d6cd524","constructor","encoder","TextEncoder","_pieces","_parts","append_buffer","data","flush","push","append","length","buf","Uint8Array","toArrayBuffer","buffer","part","$e8379818650e2442$var$concatArrayBuffers","bufs","size","byteLength","result","offset","view","byteOffset","set","$0cfd7828ad59115f$export$417857010dc9287f","unpacker","$0cfd7828ad59115f$var$Unpacker","unpack","$0cfd7828ad59115f$export$2a703dbb0cb35339","packer","$0cfd7828ad59115f$export$b9ec4b114aa40074","pack","getBuffer","index","dataBuffer","dataView","type","unpack_uint8","unpack_raw","unpack_string","unpack_array","unpack_map","unpack_float","unpack_double","unpack_uint16","unpack_uint32","unpack_uint64","unpack_int8","unpack_int16","unpack_int32","unpack_int64","byte","bytes","read","uint16","uint32","uint64","uint8","Error","slice","c","code","i","str","String","fromCodePoint","objects","Array","map","sign","exp","fraction","h32","l32","hfrac","frac","j","subarray","_bufferBuilder","pack_string","Math","floor","pack_integer","pack_double","undefined","pack_array","ArrayBuffer","pack_bin","v","Date","toString","Object","startsWith","pack_object","blob","pack_uint8","pack_uint16","pack_uint32","encoded","_textEncoder","encode","ary","num","pack_int8","pack_int16","pack_int32","pack_int64","pack_uint64","log","LN2","frac0","frac1","b32","obj","keys","prop","hasOwnProperty","n","high","low","logDisabled_","deprecationWarnings_","extractVersion","uastring","expr","pos","match","parseInt","wrapPeerConnectionEvent","window","eventNameToWrap","wrapper","RTCPeerConnection","proto","prototype","nativeAddEventListener","addEventListener","nativeEventName","cb","apply","arguments","wrappedCallback","e","modifiedEvent","handleEvent","_eventMap","Map","nativeRemoveEventListener","removeEventListener","has","unwrappedCb","get","delete","defineProperty","enumerable","configurable","disableLog","bool","disableWarnings","console","deprecated","oldMethod","newMethod","warn","detectBrowser","browser","version","navigator","userAgent","mozGetUserMedia","webkitGetUserMedia","isSecureContext","webkitRTCPeerConnection","supportsUnifiedPlan","RTCRtpTransceiver","isObject","val","call","compactObject","reduce","accumulator","isObj","isEmptyObject","assign","walkStats","stats","base","resultSet","forEach","endsWith","filterStats","track","outbound","streamStatsType","filteredResult","trackStats","trackIdentifier","trackStat","trackId","logging","utils","shimGetUserMedia","browserDetails","mediaDevices","constraintsToChrome_","mandatory","optional","cc","r","ideal","exact","min","max","oldname_","prefix","charAt","toUpperCase","oc","mix","advanced","concat","shimConstraints_","constraints","func","JSON","parse","stringify","audio","remap","a","b","video","face","facingMode","getSupportedFacingModeLies","getSupportedConstraints","matches","enumerateDevices","then","devices","filter","d","kind","dev","find","some","label","toLowerCase","includes","deviceId","shimError_","PermissionDeniedError","PermissionDismissedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","TabCaptureError","ScreenCaptureError","DeviceCaptureError","message","constraint","constraintName","getUserMedia_","onSuccess","onError","getUserMedia","bind","origGetUserMedia","cs","stream","getAudioTracks","getVideoTracks","getTracks","stop","DOMException","Promise","reject","shimGetDisplayMedia","getSourceId","getDisplayMedia","sourceId","widthSpecified","width","heightSpecified","height","frameRateSpecified","frameRate","chromeMediaSource","chromeMediaSourceId","maxFrameRate","maxWidth","maxHeight","error","shimMediaStream","MediaStream","webkitMediaStream","shimOnTrack","_ontrack","f","origSetRemoteDescription","setRemoteDescription","_ontrackpoly","te","receiver","getReceivers","event","Event","transceiver","streams","dispatchEvent","shimGetSendersWithDtmf","shimSenderWithDtmf","pc","dtmf","_dtmf","createDTMFSender","_pc","getSenders","_senders","origAddTrack","addTrack","sender","origRemoveTrack","removeTrack","indexOf","splice","origAddStream","addStream","origRemoveStream","removeStream","s","RTCRtpSender","origGetSenders","senders","shimGetStats","origGetStats","getStats","selector","onSucc","onErr","fixChromeStats_","response","standardReport","reports","report","standardStats","timestamp","localcandidate","remotecandidate","names","stat","makeMapStats","successCallbackWrapper_","resolve","shimSenderReceiverGetStats","RTCRtpReceiver","origGetReceivers","receivers","srcElement","MediaStreamTrack","err","shimAddTrackRemoveTrackWithNative","getLocalStreams","_shimmedLocalStreams","streamId","alreadyExists","existingSenders","newSenders","newSender","shimAddTrackRemoveTrack","origGetLocalStreams","nativeStreams","_reverseStreams","_streams","newStream","replaceInternalStreamId","description","sdp","internalId","externalStream","internalStream","replace","RegExp","RTCSessionDescription","replaceExternalStreamId","signalingState","t","oldStream","method","nativeMethod","methodObj","args","isLegacyCall","desc","origSetLocalDescription","setLocalDescription","origLocalDescription","getOwnPropertyDescriptor","isLocal","streamid","hasTrack","shimPeerConnection","RTCIceCandidate","fixNegotiationNeeded","target","getConfiguration","sdpSemantics","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","preferredMediaSource","mediaSource","RTCTrackEvent","mozRTCPeerConnection","modernStatsTypes","inboundrtp","outboundrtp","candidatepair","nativeGetStats","shimSenderGetStats","shimReceiverGetStats","shimRemoveStream","shimRTCDataChannel","DataChannel","RTCDataChannel","shimAddTransceiver","origAddTransceiver","addTransceiver","setParametersPromises","sendEncodings","shouldPerformCheck","encodingParam","ridRegex","test","rid","TypeError","parseFloat","scaleResolutionDownBy","RangeError","maxFramerate","params","getParameters","encodings","setParameters","catch","shimGetParameters","origGetParameters","shimCreateOffer","origCreateOffer","createOffer","all","finally","shimCreateAnswer","origCreateAnswer","createAnswer","shimLocalStreamsAPI","_localStreams","_addTrack","tracks","shimRemoteStreamsAPI","getRemoteStreams","_remoteStreams","_onaddstream","_onaddstreampoly","shimCallbacksAPI","addIceCandidate","successCallback","failureCallback","options","promise","withCallback","candidate","_getUserMedia","shimConstraints","errcb","shimRTCIceServerUrls","OrigPeerConnection","pcConfig","pcConstraints","iceServers","newIceServers","server","urls","url","generateCertificate","shimTrackEventTransceiver","shimCreateOfferLegacy","offerOptions","offerToReceiveAudio","audioTransceiver","getTransceivers","direction","setDirection","offerToReceiveVideo","videoTransceiver","shimAudioContext","AudioContext","webkitAudioContext","shimRTCIceCandidate","NativeRTCIceCandidate","substring","nativeCandidate","parsedCandidate","SDPUtils","toJSON","sdpMid","sdpMLineIndex","usernameFragment","writable","shimRTCIceCandidateRelayProtocol","relayProtocol","priority","shimMaxMessageSize","_sctp","sctpInDescription","sections","shift","mediaSection","mLine","protocol","getRemoteFirefoxVersion","getCanSendMaxMessageSize","remoteIsFirefox","canSendMaxMessageSize","getMaxMessageSize","maxMessageSize","isFirefox","canSendMMS","remoteMMS","Number","POSITIVE_INFINITY","sctp","shimSendThrowTypeError","wrapDcSend","dc","origDataChannelSend","send","readyState","origCreateDataChannel","createDataChannel","dataChannel","channel","shimConnectionState","completed","checking","iceConnectionState","_onconnectionstatechange","origMethod","_connectionstatechangepoly","_lastConnectionState","connectionState","newEvent","removeExtmapAllowMixed","nativeSRD","split","line","trim","join","shimAddIceCandidateNullOrEmpty","nativeAddIceCandidate","shimParameterlessSetLocalDescription","nativeSetLocalDescription","adapterFactory","shimChrome","shimFirefox","shimSafari","adapter","commonShim","chromeShim","browserShim","firefoxShim","safariShim","decoder","src","srcEnd","TextDecoder","position","EMPTY_ARRAY","LEGACY_RECORD_INLINE_ID","RECORD_DEFINITIONS_ID","RECORD_INLINE_ID","BUNDLED_STRINGS_ID","PACKED_REFERENCE_TAG_ID","STOP_CODE","currentStructures","srcString","bundledStrings","referenceMap","packedValues","restoreMapsAsObject","strings","stringPosition","currentDecoder","srcStringStart","srcStringEnd","currentExtensions","currentExtensionRanges","defaultOptions","useRecords","mapsAsObjects","sequentialMode","inlineObjectReadThreshold","Function","Infinity","Decoder","keyMap","_keyMap","getStructures","getShared","structures","uninitialized","mapKey","k","entries","decodeKey","encodeKey","encodeKeys","rec","decodeKeys","_mapKey","res","safeKey","mapDecode","source","end","decode","saveState","clearSource","DataView","sharedValues","maxPrivatePackedValues","checkedRead","decodeMultiple","values","lastPosition","defaultDecoder","postBundlePosition","incomplete","token","majorType","getFloat16","getUint16","getFloat32","useFloat32","multiplier","mult10","getUint32","getFloat64","int64AsNumber","getBigUint64","array","Buffer","object","readBin","string","shortStringInJS","longStringInJS","readFixedString","structure","createStructureReader","readJustLength","recordDefinition","readBundleExt","loadShared","extension","handlesRead","input","Tag","packedValue","getPackedValues","isNaN","validName","readObject","compiledReader","propertyCount","next","slowReads","readStringJS","units","byte1","byte2","byte3","byte4","unit","fromCharCode","start","g","h","l","m","o","copyBuffers","f32Array","Float32Array","u8Array","byte0","exponent","NaN","abs","tag","dateString","epochSec","round","BigInt","existingStructure","isShared","restoreStructures","position0","position1","glbl","packedTable","newPackedValues","prefixes","suffixes","combine","refEntry","targetProperties","used","Set","SHARED_DATA_TAG_ID","isLittleEndianMachine","Uint16Array","typedArrays","Uint8ClampedArray","Uint32Array","BigUint64Array","Int8Array","Int16Array","Int32Array","BigInt64Array","Float64Array","typedArrayTags","registerTypedArray","TypedArray","bytesPerElement","dvMethod","BYTES_PER_ELEMENT","littleEndian","sizeShift","dv","elements","ta","bundlePosition","bundleLength","dataPosition","sharedData","updatedStructures","sharedVersion","savedSrcEnd","savedPosition","savedStringPosition","savedSrcStringStart","savedSrcStringEnd","savedSrcString","savedStrings","savedReferenceMap","savedBundledStrings","savedSrc","savedStructures","savedDecoder","savedSequentialMode","FLOAT32_OPTIONS","NEVER","ALWAYS","DECIMAL_ROUND","DECIMAL_FIT","textEncoder","extensions","extensionClasses","globalThis","hasNodeBuffer","ByteArrayAllocate","allocUnsafeSlow","ByteArray","MAX_STRUCTURES","MAX_BUFFER_SIZE","throwOnIterable","targetView","safeEnd","MAX_BUNDLE_SIZE","hasNonLatin","RECORD_SYMBOL","Symbol","Encoder","sharedStructures","hasSharedUpdate","super","encodeUtf8","utf8Write","maxBytes","encodeInto","written","hasSharedStructures","saveStructures","maxSharedStructures","isSequential","sequential","saveShared","samplingPackedValues","packedObjectMap","sharedPackedObjectMap","create","recordIdsToRemove","transitionsCount","serializationsSinceTransitionRebuild","mapEncode","encodeOptions","_mapped","REUSE_BUFFER_MODE","useSelfDescribedHeader","setUint32","structuredClone","bundleStrings","sharedStructuresLength","transitions","nextTransition","transition","nextId","maxValues","objectMap","findRepetitiveStrings","writeArrayHeader","valuesArray","THROW_ON_ITERABLE","writeBundles","idsToInsert","makeRoom","serialized","insertIds","returnBuffer","updateSharedData","RESET_BUFFER_MODE","findCommonStringsToPack","threshold","status","count","packedPosition","headerSize","strLength","extStart","twoByte","c1","c2","strPosition","charCodeAt","copyWithin","alwaysUseFloat","xShifted","setFloat32","setFloat64","setUint16","referee","references","writeObject","useTag259ForMaps","entryValue","extensionClass","getTag","iterator","iteratorNotHandled","entry","asyncIterator","isBlob","useToJSON","json","setBigUint64","largeBigIntToFloat","variableMapSize","vals","safePrototype","objectOffset","parentRecordId","newTransitions","recordId","__keys__","newSize","newBuffer","copy","chunkThreshold","continuedChunkThreshold","encodeObjectAsIterable","iterateProperties","finalIterable","writeEntityLength","tryEncode","element","restartEncoding","restart","startEncoding","encodeIterable","async","encodeObjectAsAsyncIterable","encodedValue","reader","getReader","done","asyncValue","encodeAsIterable","encodeAsAsyncIterable","useBuffer","clearSharedData","lastVersion","structuresCopy","SharedData","saveResults","existingShared","majorValue","BlobConstructor","Blob","toStringTag","packedStatus","includeKeys","typedArrayEncoder","typedArray","from","writeBuffer","distanceToMove","lastEnd","sort","pop","writeStrings","date","seconds","getTime","useTimestamp32","getMilliseconds","regex","flags","arrayBuffer","tagUint8Array","definitions","unshift","defaultEncoder","$fcbcc7538a6776d5$export$f1c5f4c9cb95390b","chunkedMTU","_dataCount","chunk","chunks","total","ceil","__peerData","$fcbcc7538a6776d5$export$52c89ebcdc4f53f2","$fb63e766cfafaab9$var$webRTCAdapter","$gCcbY$webrtcadapter","default","$fb63e766cfafaab9$export$25be9502477c137d","isWebRTCSupported","isBrowserSupported","getBrowser","getVersion","validBrowser","supportedBrowsers","minChromeVersion","minFirefoxVersion","isIOS","minSafariVersion","isUnifiedPlanSupported","tempPc","supported","close","platform","$9a84a32bf0bf36bb$export$f35f128fd59ea256","$0e5fd1585784c252$export$4e61f672936bec77","random","$4f4134156c446392$var$DEFAULT_CONFIG","username","credential","$4f4134156c446392$export$f8f26dd395d7e1bd","noop","blobToArrayBuffer","fr","FileReader","onload","evt","readAsArrayBuffer","binaryStringToArrayBuffer","binary","byteArray","isSecure","location","CLOUD_HOST","CLOUD_PORT","chunkedBrowsers","Chrome","chrome","defaultConfig","browserVersion","$gCcbY$pack","$gCcbY$unpack","supports","webRTC","audioVideo","binaryBlob","reliable","ordered","binaryType","validateId","randomToken","$4f4134156c446392$export$7debb50ef11d5e0b","$257947e92926277a$var$LOG_PREFIX","$257947e92926277a$export$243e62d78d3b544d","LogLevel","$257947e92926277a$var$Logger","logLevel","_logLevel","All","_print","Warnings","Errors","setLogFunction","fn","rest","Disabled","$257947e92926277a$export$2e2bcd8739ae039","$c4dcfd1d1ea86647$var$has","$c4dcfd1d1ea86647$var$prefix","$c4dcfd1d1ea86647$var$Events","$c4dcfd1d1ea86647$var$EE","context","once","$c4dcfd1d1ea86647$var$addListener","emitter","listener","_events","_eventsCount","$c4dcfd1d1ea86647$var$clearEvent","$c4dcfd1d1ea86647$var$EventEmitter","__proto__","eventNames","events","getOwnPropertySymbols","listeners","handlers","ee","listenerCount","emit","a1","a2","a3","a4","a5","len","removeListener","removeAllListeners","off","addListener","prefixed","EventEmitter","$c4dcfd1d1ea86647$exports","$78455e22dea96b8c$export$3157d57b4135e3bc","$78455e22dea96b8c$export$9547aaa2e39030ff","$78455e22dea96b8c$export$7974935686149686","$78455e22dea96b8c$export$49ae800c114df41d","$78455e22dea96b8c$export$89f507cf986a947","$78455e22dea96b8c$export$3b5c4a4b6354f023","$78455e22dea96b8c$export$adb4a1754da6f10d","ConnectionType","PeerErrorType","BaseConnectionErrorType","DataConnectionErrorType","SerializationType","SocketEventType","ServerMessageType","$f5f881ec4575f1fc$exports","$8f5bfa60836d261d$export$4798917dbf149b79","secure","host","port","path","pingInterval","_disconnected","_messagesQueue","wsProtocol","_baseUrl","_id","wsUrl","_socket","WebSocket","onmessage","Message","onclose","_cleanup","Disconnected","onopen","_sendQueuedMessages","_scheduleHeartbeat","_wsPingTimer","setTimeout","_sendHeartbeat","_wsOpen","Heartbeat","copiedQueue","clearTimeout","$b82fb8fc0514bfc1$export$89e6bb5ad64bf4a","connection","startConnection","peerConnection","_startPeerConnection","Media","_stream","_addTracksToConnection","originator","dataConnection","config","_initializeDataChannel","_makeOffer","handleSDP","provider","_setupListeners","peerId","peer","connectionId","connectionType","onicecandidate","socket","Candidate","payload","dst","oniceconnectionstatechange","emitError","NegotiationFailed","ConnectionClosed","ondatachannel","getConnection","ontrack","mediaConnection","_addStreamToMediaConnection","cleanup","peerConnectionNotClosed","dataChannelNotClosed","offer","sdpTransform","metadata","Data","serialization","Offer","WebRTC","err_1","_makeAnswer","answer","Answer","self","handleCandidate","ice","$23779d1881157a18$export$6a678e589c8a4542","$23779d1881157a18$export$98871882f492de82","$5045192fc6d387ba$export$23a2a68283c24d80","open","_open","$5c1d08c7c57da9a3$export$4a84e95a2324ac29","localStream","_localStream","remoteStream","_remoteStream","ID_PREFIX","_negotiator","handleMessage","_payload","messages","_getMessages","_removeConnection","_class","$abf266641927cd89$export$2c4e825dc9120f87","_options","_buildRequest","URL","searchParams","now","fetch","href","referrerPolicy","retrieveId","pathError","listAllPeers","helpfulError","$6366c4ca161bc297$export$d365f7ad9d7df9c9","chunked","_send","NotOpenYet","_class2","MAX_BUFFERED_AMOUNT","$a229bedbcaa6ca23$export$ff7c9d4c11d94e8b","bufferSize","_bufferSize","_handleDataMessage","_bufferedSend","msg","_buffering","_trySend","_buffer","bufferedAmount","_tryBuffer","$9fcfddb3ae148f88$export$f0a5a64d5bb37108","_chunkedData","chunker","Binary","deserializedData","peerData","_handleChunk","chunkInfo","_sendChunks","blobs","$bbaee3f15f714663$export$6f88fe47d32c9c94","_chunked","None","$817f931e3f9096cf$export$48880ac635f47186","encodedData","MessageToBig","$416260bce337df90$export$ecd1fc136c422448","connections","plainConnections","_connections","destroyed","_destroyed","disconnected","userId","_serializers","raw","_lastServerId","_lostMessages","debug","DEFAULT_KEY","serializers","hostname","logFunction","_api","_createServerConnection","_initialize","_abort","ServerError","_delayedAbort","InvalidID","BrowserIncompatible","_handleMessage","SocketError","Network","disconnect","Close","SocketClosed","Open","IdTaken","UnavailableID","InvalidKey","Leave","_cleanupPeer","Expire","PeerUnavailable","_addConnection","_storeMessage","connect","destroy","currentId","reconnect","_","peers","_class3","for","$route","imageUrl","curMsg","myVideo","remoteVideo","computed","mapState","mapGetters","currentChatTime","msgList","msgdata","watch","$store","commit","userAarry","$message","$router","methods","image2Base64","file","readAsDataURL","onerror","$refs","upload","click","isJPG","isLt5M","img","sayTo","isRead","formName","validate","valid","Peer","loadVideo","created","mounted","document","querySelector","style","innerHeight","component","require","localCName","generateIdentifier","splitLines","splitSections","parts","getDescription","getMediaSections","matchPrefix","parseCandidate","foundation","ip","address","relatedAddress","relatedPort","tcpType","ufrag","writeCandidate","parseIceOptions","parseRtpMap","parsed","payloadType","clockRate","channels","numChannels","writeRtpMap","codec","pt","preferredPayloadType","parseExtmap","uri","attributes","writeExtmap","headerExtension","preferredId","parseFmtp","kv","writeFmtp","parameters","param","parseRtcpFb","parameter","writeRtcpFb","lines","rtcpFeedback","fb","parseSsrcMedia","sp","ssrc","colon","attribute","parseSsrcGroup","semantics","ssrcs","getMid","mid","parseFingerprint","algorithm","getDtlsParameters","sessionpart","role","fingerprints","writeDtlsParameters","setupType","fp","parseCryptoLine","cryptoSuite","keyParams","sessionParams","writeCryptoLine","writeCryptoKeyParams","parseCryptoKeyParams","keyMethod","keySalt","lifeTime","mkiValue","mkiLength","getCryptoParameters","getIceParameters","pwd","password","writeIceParameters","iceLite","parseRtpParameters","codecs","headerExtensions","fecMechanisms","rtcp","mline","profile","rtpmapline","fmtps","wildcardRtcpFb","duplicate","existingFeedback","writeRtpDescription","caps","maxptime","parseRtpEncodingParameters","encodingParameters","hasRed","hasUlpfec","primarySsrc","secondarySsrc","flows","apt","encParam","codecPayloadType","rtx","fec","mechanism","bandwidth","maxBitrate","parseRtcpParameters","rtcpParameters","remoteSsrc","cname","rsize","reducedSize","compound","mux","writeRtcpParameters","parseMsid","spec","planB","msidParts","parseSctpDescription","parseMLine","maxSizeLine","sctpPort","fmt","sctpMapLines","writeSctpDescription","media","output","generateSessionId","substr","writeSessionBoilerplate","sessId","sessVer","sessUser","sessionId","user","getDirection","getKind","isRejected","parseOLine","sessionVersion","netType","addressType","isValidSDP","module","exports","anObject","that","hasIndices","global","ignoreCase","multiline","dotAll","unicode","unicodeSets","sticky","DESCRIPTORS","defineBuiltInAccessor","regExpFlags","fails","RegExpPrototype","FORCED","INDICES_SUPPORT","O","calls","expected","addGetter","chr","pairs"],"sourceRoot":""}