/*[
    {
        "title": "All",
        "href": "/cliphunter/categories/All"
    },
    {
        "title": "Amateur",
        "href": "/cliphunter/categories/Amateur"
    },
    {
        "title": "Anal",
        "href": "/cliphunter/categories/Anal"
    },
    {
        "title": "Asian",
        "href": "/cliphunter/categories/Asian"
    },
    {
        "title": "Ass",
        "href": "/cliphunter/categories/Ass"
    },
    {
        "title": "Babe",
        "href": "/cliphunter/categories/Babe"
    },
    {
        "title": "Big Butt",
        "href": "/cliphunter/categories/Big Butt"
    },
    {
        "title": "Big Dick",
        "href": "/cliphunter/categories/Big Dick"
    },
    {
        "title": "Big Tits",
        "href": "/cliphunter/categories/Big Tits"
    },
    {
        "title": "Black",
        "href": "/cliphunter/categories/Black"
    },
    {
        "title": "Blonde",
        "href": "/cliphunter/categories/Blonde"
    },
    {
        "title": "Blowjob",
        "href": "/cliphunter/categories/Blowjob"
    },
    {
        "title": "Brunette",
        "href": "/cliphunter/categories/Brunette"
    },
    {
        "title": "Bukkake",
        "href": "/cliphunter/categories/Bukkake"
    },
    {
        "title": "Celebrity",
        "href": "/cliphunter/categories/Celebrity"
    },
    {
        "title": "Coed",
        "href": "/cliphunter/categories/Coed"
    },
    {
        "title": "Compilation",
        "href": "/cliphunter/categories/Compilation"
    },
    {
        "title": "Couples",
        "href": "/cliphunter/categories/Couples"
    },
    {
        "title": "Creampie",
        "href": "/cliphunter/categories/Creampie"
    },
    {
        "title": "Cumshot",
        "href": "/cliphunter/categories/Cumshot"
    },
    {
        "title": "Cumshots",
        "href": "/cliphunter/categories/Cumshots"
    },
    {
        "title": "European",
        "href": "/cliphunter/categories/European"
    },
    {
        "title": "Facial",
        "href": "/cliphunter/categories/Facial"
    },
    {
        "title": "Fantasy",
        "href": "/cliphunter/categories/Fantasy"
    },
    {
        "title": "Fetish",
        "href": "/cliphunter/categories/Fetish"
    },
    {
        "title": "Fingering",
        "href": "/cliphunter/categories/Fingering"
    },
    {
        "title": "Fisting",
        "href": "/cliphunter/categories/Fisting"
    },
    {
        "title": "German",
        "href": "/cliphunter/categories/German"
    },
    {
        "title": "Group Sex",
        "href": "/cliphunter/categories/Group Sex"
    },
    {
        "title": "Hairy",
        "href": "/cliphunter/categories/Hairy"
    },
    {
        "title": "Handjob",
        "href": "/cliphunter/categories/Handjob"
    },
    {
        "title": "Hardcore",
        "href": "/cliphunter/categories/Hardcore"
    },
    {
        "title": "Hentai",
        "href": "/cliphunter/categories/Hentai"
    },
    {
        "title": "Instructional",
        "href": "/cliphunter/categories/Instructional"
    },
    {
        "title": "Interracial",
        "href": "/cliphunter/categories/Interracial"
    },
    {
        "title": "Japanese",
        "href": "/cliphunter/categories/Japanese"
    },
    {
        "title": "Large Ladies",
        "href": "/cliphunter/categories/Large Ladies"
    },
    {
        "title": "Latina",
        "href": "/cliphunter/categories/Latina"
    },
    {
        "title": "Lesbian",
        "href": "/cliphunter/categories/Lesbian"
    },
    {
        "title": "Massage",
        "href": "/cliphunter/categories/Massage"
    },
    {
        "title": "Masturbation",
        "href": "/cliphunter/categories/Masturbation"
    },
    {
        "title": "Mature",
        "href": "/cliphunter/categories/Mature"
    },
    {
        "title": "Milf",
        "href": "/cliphunter/categories/Milf"
    },
    {
        "title": "Mom",
        "href": "/cliphunter/categories/Mom"
    },
    {
        "title": "Panties",
        "href": "/cliphunter/categories/Panties"
    },
    {
        "title": "Pantyhose",
        "href": "/cliphunter/categories/Pantyhose"
    },
    {
        "title": "Pornstars",
        "href": "/cliphunter/categories/Pornstars"
    },
    {
        "title": "Public",
        "href": "/cliphunter/categories/Public"
    },
    {
        "title": "Pussy",
        "href": "/cliphunter/categories/Pussy"
    },
    {
        "title": "Reality",
        "href": "/cliphunter/categories/Reality"
    },
    {
        "title": "Redhead",
        "href": "/cliphunter/categories/Redhead"
    },
    {
        "title": "Romantic",
        "href": "/cliphunter/categories/Romantic"
    },
    {
        "title": "Shaved",
        "href": "/cliphunter/categories/Shaved"
    },
    {
        "title": "Smalltits",
        "href": "/cliphunter/categories/Smalltits"
    },
    {
        "title": "Squirting",
        "href": "/cliphunter/categories/Squirting"
    },
    {
        "title": "Striptease",
        "href": "/cliphunter/categories/Striptease"
    },
    {
        "title": "Teen",
        "href": "/cliphunter/categories/Teen"
    },
    {
        "title": "Toys",
        "href": "/cliphunter/categories/Toys"
    },
    {
        "title": "Vintage",
        "href": "/cliphunter/categories/Vintage"
    },
    {
        "title": "Voyeur",
        "href": "/cliphunter/categories/Voyeur"
    },
    {
        "title": "Webcam",
        "href": "/cliphunter/categories/Webcam"
    },
    {
        "title": "Wife",
        "href": "/cliphunter/categories/Wife"
    },
    {
        "title": "Young Old",
        "href": "/cliphunter/categories/Young Old"
    },
    {
        "title": "HD",
        "href": "/cliphunter/categories/HD"
    },

]*/
const Crawler = require("crawler");
const host='http://thudam.org'
const htmlToText = require('html-to-text');
const purHtml=function(str,s){
    if(!str) return  ''
    str=str.replace(/(<!--.*?-->)/g, '')
    str=str.replace(/href="[^"]+"/gi,'href="javascript:;"')
    str=str.replace(/\|.+/gi,'')
    str=str.replace(/Thudam.Mobi/gi,'porncvd')
    str=str.replace(/[\t\v\n\r\f]/g, "")
    str=str.replace(/]article_adlist-->/g, "")
    if(!s){
        str=htmlToText.fromString(str)
    }
    return str
}
const pup = new Crawler({
    maxConnections : 30000,
    retries:2,
    retryTimeout:600,
    encoding:null,
    // This will be called for each crawled page
    callback : function (error, res, done) {
        if(error){
            console.log(error);
        }else{
            let $ = res.$
            console.log($('title').text())
        }
        done();
    }
});
const thudam={
    async detail(uri){
        console.log(host+uri)
       let list={list:{docs:[],video:{}},meta:{}}
        return  new Promise((resolve, reject) => {
            pup.queue([{
                uri:host+uri,
                timeout:3000,
                callback: function (error, res, done) {
                    if(error){
                        console.log(error);
                    }else{
                        let $ = res.$
                        Object.assign(list.list.video,{
                            title:$('.header-title').text(),
                            img:$('[rel="image_src"]').attr('href'),
                            url:$('.openloadvideo').attr('src'),
                            href:$('[property="og:url"]').attr('content')
                        })
                        $('.movie-list-index .last-film-box-wrapper .movie-item').each(function () {
                            list.list.docs.push({
                                href:'/thudam'+$(this).attr('href').replace(/.+thudam.org/gi,''),
                                title:$(this).find('.movie-title-1').text(),
                                img:$(this).find('.lazyload').attr('data-src')
                            })
                        })
                        list.meta={
                            title:purHtml($('title').text()),
                            title_en:purHtml($('title').text()),
                            keywords:purHtml($('[name="keywords"]').attr('content')) ,
                            keywords_en:purHtml($('[name="keywords"]').attr('content')) ,
                            desc:purHtml($('[name="keywords"]').attr('content')),
                            desc_en:purHtml($('[name="keywords"]').attr('content')),
                        }
                    }
                    done();
                    resolve(list)
                }
            }]);
        })
    },
    async list(uri=host){
        let list={list:{docs:[]},meta:{}}
        //ajax=1&page=9
        console.log(host+uri.replace('ajax=1&',''))
        return  new Promise((resolve, reject) => {
            pup.queue([{
                uri:uri.indexOf(host) > -1 ? host : host+uri.replace('ajax=1&',''),
                callback: function (error, res, done) {
                    if(error){
                        console.log(error);
                    }else{
                        let $ = res.$

                        $('.movie-list-index .last-film-box-wrapper .movie-item').each(function () {
                            list.list.docs.push({
                                href:'/thudam'+$(this).attr('href').replace(/.+thudam.org/gi,''),
                                title:$(this).find('.movie-title-1').text(),
                                img:$(this).find('.lazyload').attr('data-src')
                            })
                        })
                        list.meta={
                            title:purHtml($('title').text()),
                            title_en:purHtml($('title').text()),
                            keywords:purHtml($('[name="keywords"]').attr('content')) ,
                            keywords_en:purHtml($('[name="keywords"]').attr('content')) ,
                            desc:purHtml($('[name="keywords"]').attr('content')),
                            desc_en:purHtml($('[name="keywords"]').attr('content')),
                        }
                    }
                    done();
                    resolve(list)
                }
            }]);
        })
    },
}
// thudam.detail(`${host}/xvideos/v/60086779/`).then(res =>{
//     console.log(res)
// })
module.exports = thudam;
